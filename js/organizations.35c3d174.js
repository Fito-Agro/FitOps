"use strict";(self["webpackChunkfitoagro_backoffice"]=self["webpackChunkfitoagro_backoffice"]||[]).push([[297],{6112:function(a,e,o){o.r(e),o.d(e,{default:function(){return ra}});var i=o(6768),t=o(2239),n=o(2807),r=o(4593),l=o(1606),d=o(697),s=o(3813),u=o(6756),g=o(5526),c=o(1720),m=o(9669),h=o(3948);function p(a,e,o,p,z,b){const f=(0,i.g2)("AddOrg"),_=(0,i.g2)("OrganizationsTable");return(0,i.uX)(),(0,i.Wv)(s.I,null,{default:(0,i.k6)((()=>[(0,i.bF)(u.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(g.B,{cols:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(r.J,null,{default:(0,i.k6)((()=>[(0,i.bF)(l.r,null,{default:(0,i.k6)((()=>[(0,i.eW)("Filtro")])),_:1}),(0,i.bF)(d.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(u.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(g.B,{cols:"2"},{default:(0,i.k6)((()=>[(0,i.bF)(h.W,{modelValue:z.filter.name,"onUpdate:modelValue":e[0]||(e[0]=a=>z.filter.name=a),clearable:"",label:"Nome",density:"comfortable",variant:"underlined",color:"primary"},null,8,["modelValue"])])),_:1}),(0,i.bF)(g.B,{cols:"2"},{default:(0,i.k6)((()=>[(0,i.bF)(h.W,{modelValue:z.filter.city,"onUpdate:modelValue":e[1]||(e[1]=a=>z.filter.city=a),clearable:"",density:"comfortable",variant:"underlined",color:"primary",label:"Cidade"},null,8,["modelValue"])])),_:1}),(0,i.bF)(g.B,{cols:"2"},{default:(0,i.k6)((()=>[(0,i.bF)(t.V,{clearable:"",modelValue:z.filter.organizationtype_id,"onUpdate:modelValue":e[2]||(e[2]=a=>z.filter.organizationtype_id=a),items:z.organizationtypes,"item-title":"organizationtype_name","item-value":"organizationtype_id",label:"Tipo de Organização",density:"comfortable",variant:"underlined",color:"primary",loading:z.isLoadingTypes},null,8,["modelValue","items","loading"])])),_:1}),(0,i.bF)(g.B,{cols:"2"},{default:(0,i.k6)((()=>[(0,i.bF)(n.D,{color:"secondary",icon:"",variant:"text",disabled:z.isLoadingOrgs,onClick:e[3]||(e[3]=a=>b.refreshOrgs())},{default:(0,i.k6)((()=>[(0,i.bF)(m.w,{size:"x-large"},{default:(0,i.k6)((()=>[(0,i.eW)("mdi-magnify")])),_:1})])),_:1},8,["disabled"])])),_:1}),(0,i.bF)(c.h),p.accountStore.hasRole(["Administrador"])?((0,i.uX)(),(0,i.Wv)(g.B,{key:0,cols:"2"},{default:(0,i.k6)((()=>[(0,i.bF)(f,{onRefresh:e[4]||(e[4]=a=>b.refreshOrgs())})])),_:1})):(0,i.Q3)("",!0)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),(0,i.bF)(u.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(g.B,null,{default:(0,i.k6)((()=>[(0,i.bF)(_,{organizations:z.organizations,isLoadingOrgs:z.isLoadingOrgs,hasMore:z.hasMore,onLoadMore:e[5]||(e[5]=a=>b.getOrgs()),onRefresh:e[6]||(e[6]=a=>b.refreshOrgs())},null,8,["organizations","isLoadingOrgs","hasMore"])])),_:1})])),_:1})])),_:1})}o(4114);var z=o(4232),b=o(3745),f=o(1772),_=o(1560),y=o(105),k=o(6048),F=o(1781);const v={class:"text-h6"};function O(a,e,o,t,s,m){const h=(0,i.g2)("OrgForm");return(0,i.uX)(),(0,i.Wv)(f.p,{modelValue:s.dialog,"onUpdate:modelValue":e[8]||(e[8]=a=>s.dialog=a),onAfterLeave:e[9]||(e[9]=a=>m.reset()),width:"auto"},{activator:(0,i.k6)((({props:a})=>[(0,i.bF)(n.D,(0,i.v6)({color:"success","append-icon":"mdi-plus"},a),{default:(0,i.k6)((()=>[(0,i.eW)("Nova Organização")])),_:2},1040)])),default:(0,i.k6)((({})=>[(0,i.bF)(r.J,{width:"600"},{default:(0,i.k6)((()=>[(0,i.bF)(l.r,{class:"bg-success"},{default:(0,i.k6)((()=>[(0,i.Lk)("span",v,(0,z.v_)(s.steps[s.step].title),1)])),_:1}),(0,i.bF)(k.r3,{modelValue:s.step,"onUpdate:modelValue":e[4]||(e[4]=a=>s.step=a)},{default:(0,i.k6)((()=>[(0,i.bF)(F.m,null,{default:(0,i.k6)((()=>[(0,i.bF)(d.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(_.n,{modelValue:s.steps[0].formValid,"onUpdate:modelValue":e[1]||(e[1]=a=>s.steps[0].formValid=a)},{default:(0,i.k6)((()=>[(0,i.bF)(u.L,{justify:"center"},{default:(0,i.k6)((()=>[(0,i.bF)(g.B,{cols:"8"},{default:(0,i.k6)((()=>[(0,i.bF)(y.d4,{modelValue:s.organization.organizationtype_id,"onUpdate:modelValue":e[0]||(e[0]=a=>s.organization.organizationtype_id=a),label:"Tipo de Organização",placeholder:"Selecione o tipo de organização","prepend-inner-icon":"mdi-domain","no-data-text":"Nenhum tipo encontrado",items:s.organizationtypes,"item-title":"organizationtype_name","item-value":"organizationtype_id",color:"secondary",variant:"outlined",density:"comfortable",loading:s.isLoadingTypes,disabled:s.isLoadingTypes,rules:[a=>!!a||"Campo obrigatório"]},null,8,["modelValue","items","loading","disabled","rules"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}),(0,i.bF)(F.m,null,{default:(0,i.k6)((()=>[(0,i.bF)(d.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(h,{organization:s.organization,formValid:s.steps[1].formValid,readonly:!1,"onUpdate:organization":e[2]||(e[2]=a=>s.organization=a),"onUpdate:formValid":e[3]||(e[3]=a=>s.steps[1].formValid=a)},null,8,["organization","formValid"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,i.bF)(b.S,{class:"d-flex justify-space-between"},{default:(0,i.k6)((()=>[s.step>0?((0,i.uX)(),(0,i.Wv)(n.D,{key:0,"prepend-icon":"mdi-chevron-left",variant:"tonal",onClick:e[5]||(e[5]=a=>s.step--)},{default:(0,i.k6)((()=>[(0,i.eW)(" Anterior ")])),_:1})):(0,i.Q3)("",!0),(0,i.bF)(c.h),s.step<m.lasStep?((0,i.uX)(),(0,i.Wv)(n.D,{key:1,disabled:!s.steps[s.step].formValid,"append-icon":"mdi-chevron-right",color:"secondary",variant:"tonal",onClick:e[6]||(e[6]=a=>s.step++)},{default:(0,i.k6)((()=>[(0,i.eW)(" Próximo ")])),_:1},8,["disabled"])):s.step===m.lasStep?((0,i.uX)(),(0,i.Wv)(n.D,{key:2,disabled:!s.steps[m.lasStep].formValid,color:"success",variant:"flat","append-icon":"mdi-check",loading:s.isLoading,onClick:e[7]||(e[7]=a=>m.addOrg())},{default:(0,i.k6)((()=>[(0,i.eW)(" Adicionar ")])),_:1},8,["disabled","loading"])):(0,i.Q3)("",!0)])),_:1})])),_:1})])),_:1},8,["modelValue"])}function L(a,e,o,t,n,r){return(0,i.uX)(),(0,i.Wv)(_.n,{modelValue:r.localValid,"onUpdate:modelValue":e[6]||(e[6]=a=>r.localValid=a)},{default:(0,i.k6)((()=>[(0,i.bF)(u.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(g.B,{cols:"7"},{default:(0,i.k6)((()=>[(0,i.bF)(h.W,{modelValue:r.localOrg.organization_name,"onUpdate:modelValue":e[0]||(e[0]=a=>r.localOrg.organization_name=a),modelModifiers:{trim:!0},rules:n.rules.required,label:"Nome",placeholder:"Insira o nome da organização","prepend-inner-icon":"mdi-tag-text-outline",color:"secondary",density:"compact",variant:"outlined",readonly:o.readonly},null,8,["modelValue","rules","readonly"])])),_:1}),(0,i.bF)(g.B,{cols:"5"},{default:(0,i.k6)((()=>[(0,i.bF)(h.W,{modelValue:r.localOrg.organization_nif,"onUpdate:modelValue":e[1]||(e[1]=a=>r.localOrg.organization_nif=a),modelModifiers:{trim:!0},rules:n.rules.number,label:"NIF",placeholder:"Insira o NIF da organização","prepend-inner-icon":"mdi-numeric",counter:"9",color:"secondary",density:"compact",variant:"outlined",readonly:o.readonly},null,8,["modelValue","rules","readonly"])])),_:1}),(0,i.bF)(g.B,{cols:"7"},{default:(0,i.k6)((()=>[(0,i.bF)(h.W,{modelValue:r.localOrg.organization_email,"onUpdate:modelValue":e[2]||(e[2]=a=>r.localOrg.organization_email=a),modelModifiers:{trim:!0},rules:n.rules.email,type:"email",label:"Email",placeholder:"exemplo@email.com","prepend-inner-icon":"mdi-email",color:"secondary",density:"compact",variant:"outlined",readonly:o.readonly},null,8,["modelValue","rules","readonly"])])),_:1}),(0,i.bF)(g.B,{cols:"5"},{default:(0,i.k6)((()=>[(0,i.bF)(h.W,{modelValue:r.localOrg.organization_phone,"onUpdate:modelValue":e[3]||(e[3]=a=>r.localOrg.organization_phone=a),modelModifiers:{trim:!0},rules:n.rules.number,label:"Telefone",placeholder:"900000000",prefix:"+351","prepend-inner-icon":"mdi-phone",counter:"9",color:"secondary",density:"compact",variant:"outlined",readonly:o.readonly},null,8,["modelValue","rules","readonly"])])),_:1}),(0,i.bF)(g.B,{cols:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(h.W,{modelValue:r.localOrg.organization_address,"onUpdate:modelValue":e[4]||(e[4]=a=>r.localOrg.organization_address=a),modelModifiers:{trim:!0},rules:n.rules.required,label:"Morada",placeholder:"Insira a morada da organização","prepend-inner-icon":"mdi-map-marker",color:"secondary",density:"compact",variant:"outlined",readonly:o.readonly},null,8,["modelValue","rules","readonly"])])),_:1}),(0,i.bF)(g.B,{cols:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(h.W,{modelValue:r.localOrg.organization_city,"onUpdate:modelValue":e[5]||(e[5]=a=>r.localOrg.organization_city=a),modelModifiers:{trim:!0},rules:n.rules.required,label:"Cidade",placeholder:"Insira a cidade da organização","prepend-inner-icon":"mdi-city",color:"secondary",density:"compact",variant:"outlined",readonly:o.readonly},null,8,["modelValue","rules","readonly"])])),_:1})])),_:1})])),_:1},8,["modelValue"])}var D={name:"OrgForm",props:{organization:{type:Object},formValid:{type:Boolean,required:!1,default:!1},readonly:{type:Boolean,required:!1,default:!1}},data(){return{rules:{required:[a=>!!a||"Campo obrigatório",a=>a&&a.length<=50||"Máximo de 50 caracteres"],email:[a=>!!a||"Campo obrigatório",a=>/.+@.+\..+/.test(a)||"Email inválido"],number:[a=>!!a||"Campo obrigatório",a=>a&&9===a.length||"Número inválido"]},valid:!1}},computed:{localOrg:{get(){return this.organization},set(a){this.$emit("update:organization",a)}},localValid:{get(){return this.formValid},set(a){this.$emit("update:formValid",a)}}}},V=o(1241);const S=(0,V.A)(D,[["render",L]]);var W=S,A=o(6044),C=o(501),E=o(8355),w={name:"AddOrg",components:{OrgForm:W},setup(){const a=(0,A.E)(),e=(0,C.T)();return{accountStore:a,generalStore:e}},data(){return{dialog:!1,organization:{organization_name:null,organization_phone:null,organization_email:null,organization_address:null,organization_city:null,organizationtype_id:null,organization_nif:null},isLoading:!1,organizationtypes:[],isLoadingTypes:!1,step:0,steps:[{title:"Tipo de Organização",formValid:!1},{title:"Detalhes da Organização",formValid:!1}]}},watch:{dialog(a){a&&this.onOpenDialog()}},computed:{lasStep(){return this.steps.length-1}},methods:{onOpenDialog(){this.getOrganizationTypes()},async getOrganizationTypes(){this.isLoadingTypes=!0,await E.A.request({url:"api/organizationtypes",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((a=>{this.organizationtypes=a.data,this.isLoadingTypes=!1})).catch((a=>{console.error(a),this.isLoadingTypes=!1,this.generalStore.errorSnackbar("Erro ao obter os tipos de organização")}))},async addOrg(){this.isLoading=!0;let a={entity_name:this.organization.organization_name,entity_phone:this.organization.organization_phone,entity_email:this.organization.organization_email,entity_address:this.organization.organization_address,entity_city:this.organization.organization_city,organizationtype_id:this.organization.organizationtype_id,organization_nif:this.organization.organization_nif};console.log(a),await E.A.request({url:"api/organizations",method:"POST",headers:{Authorization:"Bearer "+this.accountStore.account.token},data:a}).then((a=>{this.isLoading=!1,this.generalStore.successSnackbar("Organização adicionada com sucesso"),this.$emit("refresh"),this.dialog=!1})).catch((a=>{console.log(a),this.isLoading=!1,this.generalStore.errorSnackbar("Erro ao adicionar organização")}))},reset(){this.isLoading=!1,this.organization={organization_name:null,organization_phone:null,organization_email:null,organization_address:null,organization_city:null,organizationtype_id:null,organization_nif:null},this.organitiontypes=[],this.step=0}}};const T=(0,V.A)(w,[["render",O]]);var x=T,B=o(5523),M=o(1867),U=o(7511),q=o(1146),X=o(1161);const G={key:0},j={key:1},I=(0,i.Lk)("span",null,"Remover Organização",-1);function N(a,e,o,t,s,u){const g=(0,i.g2)("OrgDetail");return(0,i.uX)(),(0,i.Wv)(q.i,{class:"pa-2",elevation:"8",rounded:"lg",width:"100%"},{default:(0,i.k6)((()=>[(0,i.bF)(M.g,{fixed_header:"","no-data-text":"Nenhuma organização encontrada","loading-text":"Carregando organizações...",headers:u.headers,items:u.tableItems,loading:o.isLoadingOrgs,height:u.tableHeight},{item:(0,i.k6)((a=>[(0,i.Lk)("tr",null,[(0,i.Lk)("td",null,[t.accountStore.hasRole(["Administrador"])||a.item.organization_id==u.myOrg?((0,i.uX)(),(0,i.Wv)(n.D,{key:0,color:"info",variant:"text",icon:"mdi-information-outline",onClick:e=>u.openDetailDialog(a.item,!1)},null,8,["onClick"])):(0,i.Q3)("",!0)]),(0,i.Lk)("td",null,(0,z.v_)(a.item.organization_name),1),(0,i.Lk)("td",null,[(0,i.bF)(B.x,{label:"",color:"info"},{default:(0,i.k6)((()=>[(0,i.eW)((0,z.v_)(a.item.organization_type),1)])),_:2},1024)]),(0,i.Lk)("td",null,(0,z.v_)(a.item.organization_phone),1),(0,i.Lk)("td",null,(0,z.v_)(a.item.organization_email),1),(0,i.Lk)("td",null,(0,z.v_)(a.item.organization_city),1),t.accountStore.hasRole(["Administrador"])?((0,i.uX)(),(0,i.CE)("td",G,[(0,i.bF)(n.D,{color:"warning",variant:"text",icon:"",onClick:e=>u.openDetailDialog(a.item,!0)},{default:(0,i.k6)((()=>[(0,i.bF)(m.w,null,{default:(0,i.k6)((()=>[(0,i.eW)("mdi-pencil")])),_:1}),(0,i.bF)(X.y,{activator:"parent",location:"bottom"},{default:(0,i.k6)((()=>[(0,i.eW)("Editar")])),_:1})])),_:2},1032,["onClick"]),(0,i.bF)(n.D,{color:"error",variant:"text",icon:"",onClick:e=>u.openDeleteDialog(a.item)},{default:(0,i.k6)((()=>[(0,i.bF)(m.w,null,{default:(0,i.k6)((()=>[(0,i.eW)("mdi-delete-outline")])),_:1}),(0,i.bF)(X.y,{activator:"parent",location:"bottom"},{default:(0,i.k6)((()=>[(0,i.eW)("Remover")])),_:1})])),_:2},1032,["onClick"])])):(0,i.Q3)("",!0),t.accountStore.hasRole(["Organização"])?((0,i.uX)(),(0,i.CE)("td",j,[a.item.organization_id==u.myOrg?((0,i.uX)(),(0,i.Wv)(n.D,{key:0,color:"warning",variant:"text",icon:"",onClick:e=>u.openDetailDialog(a.item,!0)},{default:(0,i.k6)((()=>[(0,i.bF)(m.w,null,{default:(0,i.k6)((()=>[(0,i.eW)("mdi-pencil")])),_:1}),(0,i.bF)(X.y,{activator:"parent",location:"bottom"},{default:(0,i.k6)((()=>[(0,i.eW)("Editar")])),_:1})])),_:2},1032,["onClick"])):(0,i.Q3)("",!0)])):(0,i.Q3)("",!0)])])),_:1},8,["headers","items","loading","height"]),(0,i.bF)(f.p,{modelValue:s.deleteDialog,"onUpdate:modelValue":e[2]||(e[2]=a=>s.deleteDialog=a),onAfterLeave:e[3]||(e[3]=a=>s.organization=null),width:"auto"},{default:(0,i.k6)((()=>[(0,i.bF)(r.J,null,{default:(0,i.k6)((()=>[(0,i.bF)(l.r,{class:"bg-error d-flex align-center"},{default:(0,i.k6)((()=>[(0,i.bF)(m.w,{size:"small",class:"mr-2"},{default:(0,i.k6)((()=>[(0,i.eW)("mdi-delete-outline")])),_:1}),I])),_:1}),(0,i.bF)(d.O,null,{default:(0,i.k6)((()=>[(0,i.Lk)("span",null,[(0,i.eW)("Tem a certeza que pretende remover a organização "),(0,i.Lk)("b",null,(0,z.v_)(s.organization?.organization_name),1),(0,i.eW)("?")])])),_:1}),(0,i.bF)(U.G),(0,i.bF)(b.S,{class:"d-flex justify-space-around"},{default:(0,i.k6)((()=>[(0,i.bF)(n.D,{color:"error",variant:"tonal",icon:"mdi-close",onClick:e[0]||(e[0]=a=>s.deleteDialog=!1)}),(0,i.bF)(n.D,{color:"secondary",variant:"tonal",icon:"mdi-check",loading:s.isLoadingDelete,onClick:e[1]||(e[1]=a=>u.deleteOrg())},null,8,["loading"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,i.bF)(f.p,{modelValue:s.subDialog,"onUpdate:modelValue":e[6]||(e[6]=a=>s.subDialog=a),onAfterLeave:e[7]||(e[7]=a=>s.organization=null),width:"auto"},{default:(0,i.k6)((()=>[(0,i.bF)(r.J,null,{default:(0,i.k6)((()=>[(0,i.bF)(l.r,{class:"bg-secondary"},{default:(0,i.k6)((()=>[(0,i.eW)(" Inscrição em Organização")])),_:1}),(0,i.bF)(d.O,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,z.v_)(s.organization?"Deseja se inscrever na organização "+s.organization.organization_name+"?":""),1)])),_:1}),(0,i.bF)(U.G),(0,i.bF)(b.S,{class:"d-flex justify-space-around"},{default:(0,i.k6)((()=>[(0,i.bF)(n.D,{color:"error",variant:"tonal",icon:"mdi-close",onClick:e[4]||(e[4]=a=>s.subDialog=!1)}),(0,i.bF)(n.D,{color:"secondary",variant:"tonal",icon:"mdi-check",loading:s.isLoadingSub,onClick:e[5]||(e[5]=a=>u.postSubscription())},null,8,["loading"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,i.bF)(f.p,{modelValue:s.unsubDialog,"onUpdate:modelValue":e[10]||(e[10]=a=>s.unsubDialog=a),onAfterLeave:e[11]||(e[11]=a=>s.organization=null),width:"auto"},{default:(0,i.k6)((()=>[(0,i.bF)(r.J,null,{default:(0,i.k6)((()=>[(0,i.bF)(l.r,{class:"bg-warning"},{default:(0,i.k6)((()=>[(0,i.eW)(" Desinscrição de Organização")])),_:1}),(0,i.bF)(d.O,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,z.v_)(s.organization?"Deseja sair da organização "+s.organization.organization_name+"?":""),1)])),_:1}),(0,i.bF)(U.G),(0,i.bF)(b.S,{class:"d-flex justify-space-around"},{default:(0,i.k6)((()=>[(0,i.bF)(n.D,{color:"error",variant:"tonal",icon:"mdi-close",onClick:e[8]||(e[8]=a=>s.unsubDialog=!1)}),(0,i.bF)(n.D,{color:"secondary",variant:"tonal",icon:"mdi-check",loading:s.isLoadingUnsub,onClick:e[9]||(e[9]=a=>u.deleteSubscription())},null,8,["loading"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,i.bF)(g,{organization_id:s.organization?.organization_id,editMode:s.editMode,dialog:s.detailDialog,"onUpdate:dialog":e[12]||(e[12]=a=>s.detailDialog=a),onRefresh:e[13]||(e[13]=()=>a.$emit("refresh"))},null,8,["organization_id","editMode","dialog"])])),_:1})}var R=o(5130),$=o(6106);const Q={key:0,class:"d-flex align-center"},J=(0,i.Lk)("span",null,"Editar Organização",-1),H={key:1,class:"d-flex align-center"},P=(0,i.Lk)("span",null,"Detalhes da Organização",-1);function K(a,e,o,t,s,c){const h=(0,i.g2)("OrgForm");return(0,i.uX)(),(0,i.Wv)(f.p,{modelValue:c.localDialog,"onUpdate:modelValue":e[4]||(e[4]=a=>c.localDialog=a),onAfterleave:e[5]||(e[5]=a=>c.reset()),persistent:o.editMode,width:"auto"},{default:(0,i.k6)((()=>[(0,i.bF)(r.J,{width:"600"},{default:(0,i.k6)((()=>[(0,i.bF)(l.r,{class:(0,z.C4)(["bg-info d-flex justify-space-between align-center",{"bg-warning":o.editMode}])},{default:(0,i.k6)((()=>[o.editMode?((0,i.uX)(),(0,i.CE)("div",Q,[(0,i.bF)(m.w,{size:"small",class:"mr-2"},{default:(0,i.k6)((()=>[(0,i.eW)("mdi-pencil")])),_:1}),J])):((0,i.uX)(),(0,i.CE)("div",H,[(0,i.bF)(m.w,{size:"small",class:"mr-2"},{default:(0,i.k6)((()=>[(0,i.eW)("mdi-information-outline")])),_:1}),P])),(0,i.bo)((0,i.bF)(B.x,{label:"",color:"info",variant:"flat"},{default:(0,i.k6)((()=>[(0,i.eW)((0,z.v_)(s.organization?.organization_type),1)])),_:1},512),[[R.aG,!s.isLoadingGet]])])),_:1},8,["class"]),(0,i.bF)(d.O,null,{default:(0,i.k6)((()=>[s.isLoadingGet?((0,i.uX)(),(0,i.Wv)(u.L,{key:0,align:"center"},{default:(0,i.k6)((()=>[(0,i.bF)(g.B,{class:"d-flex align-center justify-center"},{default:(0,i.k6)((()=>[(0,i.bF)($.x,{color:"secondary",size:"50",width:"7",indeterminate:""})])),_:1})])),_:1})):((0,i.uX)(),(0,i.Wv)(h,{key:1,organization:s.organization,formValid:s.valid,readonly:!o.editMode,"onUpdate:organization":e[0]||(e[0]=a=>s.organization=a),"onUpdate:formValid":e[1]||(e[1]=a=>s.valid=a)},null,8,["organization","formValid","readonly"]))])),_:1}),(0,i.bF)(U.G),o.editMode?((0,i.uX)(),(0,i.Wv)(b.S,{key:0,class:"d-flex justify-space-around"},{default:(0,i.k6)((()=>[(0,i.bF)(n.D,{color:"error",variant:"tonal",icon:"mdi-close",onClick:e[2]||(e[2]=a=>c.localDialog=!1)}),(0,i.bF)(n.D,{color:"secondary",variant:"tonal",icon:"mdi-check",loading:s.isLoadingEdit,disabled:!s.valid||s.isLoadingGet,onClick:e[3]||(e[3]=a=>c.editOrg())},null,8,["loading","disabled"])])),_:1})):(0,i.Q3)("",!0)])),_:1})])),_:1},8,["modelValue","persistent"])}var Y={name:"OrgDetail",components:{OrgForm:W},props:{organization_id:{type:Number},editMode:{type:Boolean,required:!1,default:!1},dialog:{type:Boolean,required:!0}},setup(){const a=(0,A.E)(),e=(0,C.T)();return{accountStore:a,generalStore:e}},data(){return{isLoadingGet:!1,isLoadingEdit:!1,organization:null,rules:{required:[a=>!!a||"Campo obrigatório",a=>a&&a.length<=50||"Máximo de 50 caracteres"],email:[a=>!!a||"Campo obrigatório",a=>/.+@.+\..+/.test(a)||"Email inválido"],number:[a=>!!a||"Campo obrigatório",a=>a&&9===a.length||"Número de telefone inválido"]},valid:!1}},watch:{dialog(a){a&&this.onOpenDialog()}},computed:{localDialog:{get(){return this.dialog},set(a){this.$emit("update:dialog",a)}}},methods:{async onOpenDialog(){await this.getOrg()},async getOrg(){this.isLoadingGet=!0,await E.A.request({url:"api/organizations/"+this.organization_id,method:"get",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((a=>{this.organization=a.data,this.isLoadingGet=!1})).catch((a=>{console.log(a),this.isLoadingGet=!1,this.generalStore.errorSnackbar("Erro ao obter organização")}))},async editOrg(){this.isLoadingEdit=!0;let a={organization_nif:this.organization.organization_nif,entity_name:this.organization.organization_name,entity_email:this.organization.organization_email,entity_phone:this.organization.organization_phone,entity_address:this.organization.organization_address,entity_city:this.organization.organization_city};await E.A.request({url:"api/organizations/"+this.organization.organization_id,method:"patch",headers:{Authorization:"Bearer "+this.accountStore.account.token},data:a}).then((a=>{this.isLoadingEdit=!1,this.generalStore.successSnackbar("Organização editada com sucesso"),this.$emit("refresh"),this.localDialog=!1})).catch((a=>{console.log(a),this.isLoadingEdit=!1,this.generalStore.errorSnackbar("Erro ao editar organização")}))},reset(){this.organization=null}}};const Z=(0,V.A)(Y,[["render",K]]);var aa=Z,ea={name:"OrganizationsTable",components:{OrgDetail:aa},props:{organizations:{type:Array,required:!0},isLoadingOrgs:{type:Boolean,required:!0},hasMore:{type:Boolean,required:!0}},setup(){const a=(0,C.T)(),e=(0,A.E)();return{generalStore:a,accountStore:e}},data(){return{detailDialog:!1,editMode:!1,organization:null,subDialog:!1,isLoadingSub:!1,unsubDialog:!1,isLoadingUnsub:!1,deleteDialog:!1,isLoadingDelete:!1}},computed:{tableHeight(){return window.innerHeight-270},headers(){let a=[{title:""},{title:"Nome",key:"organization_name"},{title:"Tipo",key:"organizationtype_name"},{title:"Telefone",key:"organization_phone"},{title:"Email",key:"organization_email"},{title:"Cidade",key:"organization_city"}];return this.accountStore.hasRole(["Administrador","Organização"])&&a.push({title:""}),a},tableItems(){return this.organizations},myOrg(){return this.accountStore.account?.organization}},methods:{loadMore(a){a&&this.$emit("loadMore")},openDetailDialog(a,e){this.organization=a,this.editMode=e,this.detailDialog=!0},openSubDialog(a){this.organization=a,this.subDialog=!0},openUnsubDialog(a){this.organization=a,this.unsubDialog=!0},postSubscription(){this.isLoadingSub=!0,E.A.request({method:"POST",url:"/api/organizationmembers/subscribe",headers:{Authorization:"Bearer "+this.accountStore.account.token},data:{organization_id:this.organization.organization_id}}).then((()=>{this.isLoadingSub=!1,this.generalStore.successSnackbar("Inscrição realizada com sucesso"),this.accountStore.account.organization=this.organization.organization_id,this.subDialog=!1,this.$emit("refresh")})).catch((a=>{console.log(a),this.isLoadingSub=!1,this.generalStore.errorSnackbar("Erro ao realizar inscrição")}))},deleteSubscription(){this.isLoadingUnsub=!0,E.A.request({method:"DELETE",url:"/api/organizationmembers/unsubscribe",headers:{Authorization:"Bearer "+this.accountStore.account.token},data:{organization_id:this.organization.organization_id}}).then((()=>{this.isLoadingUnsub=!1,this.generalStore.successSnackbar("Desinscrição realizada com sucesso"),this.accountStore.account.organization=null,this.unsubDialog=!1,this.$emit("refresh")})).catch((a=>{console.log(a),this.isLoadingUnsub=!1,this.generalStore.errorSnackbar("Erro ao realizar desinscrição")}))},openDeleteDialog(a){this.organization=a,this.deleteDialog=!0},deleteOrg(){this.isLoadingDelete=!0,E.A.request({url:"/api/organizations/"+this.organization.organization_id,method:"DELETE",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((()=>{this.isLoadingDelete=!1,this.generalStore.successSnackbar("Organização removida com sucesso"),this.deleteDialog=!1,this.$emit("refresh")})).catch((a=>{console.log(a),this.isLoadingDelete=!1,this.generalStore.errorSnackbar(a.response.data.error,3e3)}))}}};const oa=(0,V.A)(ea,[["render",N]]);var ia=oa,ta={name:"OrganizationsView",components:{AddOrg:x,OrganizationsTable:ia},setup(){const a=(0,A.E)(),e=(0,C.T)();return{accountStore:a,generalStore:e}},data(){return{isLoadingOrgs:!1,organizations:[],filter:{name:null,city:null,organizationtype_id:null},limit:12,offset:0,hasMore:!1,organizationtypes:[],isLoadingTypes:!1}},methods:{async getOrgs(){this.isLoadingOrgs=!0,await E.A.request({url:"api/organizations",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token},params:{entity_name:this.filter.name,entity_city:this.filter.city,organizationtype_id:this.filter.organizationtype_id,limit:this.limit,offset:this.offset}}).then((a=>{this.organizations.push(...a.data.organizations),this.hasMore=a.data.hasMore,this.offset+=a.data.organizations.length,this.isLoadingOrgs=!1})).catch((a=>{console.log(a),this.generalStore.errorSnackbar("Erro ao buscar organizações"),this.isLoadingOrgs=!1}))},refreshOrgs(){this.organizations=[],this.offset=0,this.getOrgs()},async getOrganizationTypes(){this.isLoadingTypes=!0,await E.A.request({url:"api/organizationtypes",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((a=>{this.organizationtypes=a.data,this.isLoadingTypes=!1})).catch((a=>{console.error(a),this.isLoading=!1,this.generalStore.errorSnackbar("Erro ao obter os tipos de organização")}))}},mounted(){this.getOrgs(),this.getOrganizationTypes()}};const na=(0,V.A)(ta,[["render",p]]);var ra=na}}]);
//# sourceMappingURL=organizations.35c3d174.js.map