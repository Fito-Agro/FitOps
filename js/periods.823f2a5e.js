"use strict";(self["webpackChunkfitoagro_backoffice"]=self["webpackChunkfitoagro_backoffice"]||[]).push([[991],{7651:function(e,o,t){t.r(o),t.d(o,{default:function(){return ro}});var i=t(6768),a=t(2239),l=t(2807),r=t(4593),d=t(1606),n=t(697),s=t(3813),u=t(6756),c=t(5526),p=t(1720),m=t(9669),h=t(3948);function g(e,o,t,g,b,f){const k=(0,i.g2)("AddPeriod"),_=(0,i.g2)("PeriodDrawer"),v=(0,i.g2)("PeriodsTable");return(0,i.uX)(),(0,i.Wv)(s.I,null,{default:(0,i.k6)((()=>[(0,i.bF)(u.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(c.B,{col:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(r.J,{levation:"8"},{default:(0,i.k6)((()=>[(0,i.bF)(d.r,null,{default:(0,i.k6)((()=>[(0,i.eW)("Filtro")])),_:1}),(0,i.bF)(n.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(u.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(c.B,{cols:"2"},{default:(0,i.k6)((()=>[(0,i.bF)(h.W,{clearable:"",modelValue:b.filter.name,"onUpdate:modelValue":o[0]||(o[0]=e=>b.filter.name=e),label:"Nome",density:"comfortable",variant:"underlined",color:"primary"},null,8,["modelValue"])])),_:1}),(0,i.bF)(c.B,{cols:"2"},{default:(0,i.k6)((()=>[(0,i.bF)(a.V,{clearable:"",modelValue:b.filter.periodtype_id,"onUpdate:modelValue":o[1]||(o[1]=e=>b.filter.periodtype_id=e),items:b.periodtypes,"item-title":"periodtype_name","item-value":"periodtype_id",label:"Tipo de Período",density:"comfortable",variant:"underlined",color:"primary",loading:b.isLoadingTypes},null,8,["modelValue","items","loading"])])),_:1}),(0,i.bF)(c.B,{cols:"2"},{default:(0,i.k6)((()=>[(0,i.bF)(l.D,{color:"secondary",icon:"",variant:"text",disabled:b.isLoadingPeriods,onClick:o[2]||(o[2]=e=>f.refreshPeriods())},{default:(0,i.k6)((()=>[(0,i.bF)(m.w,{size:"x-large"},{default:(0,i.k6)((()=>[(0,i.eW)("mdi-magnify")])),_:1})])),_:1},8,["disabled"])])),_:1}),(0,i.bF)(p.h),g.accountStore.hasRole(["Administrador"])?((0,i.uX)(),(0,i.Wv)(c.B,{key:0,cols:"2"},{default:(0,i.k6)((()=>[(0,i.bF)(k,{onRefresh:o[3]||(o[3]=e=>f.refreshPeriods())})])),_:1})):(0,i.Q3)("",!0)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),(0,i.bF)(_,{ref:"PeriodDrawer"},null,512),(0,i.bF)(u.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(c.B,null,{default:(0,i.k6)((()=>[(0,i.bF)(v,{periods:b.periods,isLoadingPeriods:b.isLoadingPeriods,hasMore:b.hasMore,onLoadMore:o[4]||(o[4]=e=>f.getPeriods()),onRefresh:o[5]||(o[5]=e=>f.refreshPeriods()),onShowInfo:o[6]||(o[6]=e=>f.showInfo(e))},null,8,["periods","isLoadingPeriods","hasMore"])])),_:1})])),_:1})])),_:1})}t(4114);var b=t(4232),f=t(3745),k=t(1772),_=t(7511),v=t(1560),y=t(1321),F=t(3740),D=t(6048),P=t(1781);function V(e,o,t,s,m,g){const V=(0,i.g2)("v-date-input");return(0,i.uX)(),(0,i.Wv)(k.p,{modelValue:m.dialog,"onUpdate:modelValue":o[11]||(o[11]=e=>m.dialog=e),onAfterLeave:o[12]||(o[12]=e=>g.reset()),width:"auto"},{activator:(0,i.k6)((({props:e})=>[(0,i.bF)(l.D,(0,i.v6)({color:"success","append-icon":"mdi-plus"},e),{default:(0,i.k6)((()=>[(0,i.eW)("Novo Período")])),_:2},1040)])),default:(0,i.k6)((({})=>[(0,i.bF)(r.J,{class:"mx-auto",width:"450"},{default:(0,i.k6)((()=>[(0,i.bF)(d.r,{class:"bg-success"},{default:(0,i.k6)((()=>[(0,i.eW)((0,b.v_)(m.steps[m.step].title),1)])),_:1}),(0,i.bF)(D.r3,{modelValue:m.step,"onUpdate:modelValue":o[7]||(o[7]=e=>m.step=e)},{default:(0,i.k6)((()=>[(0,i.bF)(P.m,{value:0},{default:(0,i.k6)((()=>[(0,i.bF)(n.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(u.L,{justify:"center"},{default:(0,i.k6)((()=>[(0,i.bF)(c.B,{cols:"10"},{default:(0,i.k6)((()=>[(0,i.bF)(v.n,{modelValue:m.steps[0].formValid,"onUpdate:modelValue":o[1]||(o[1]=e=>m.steps[0].formValid=e)},{default:(0,i.k6)((()=>[(0,i.bF)(a.V,{modelValue:m.period.type,"onUpdate:modelValue":o[0]||(o[0]=e=>m.period.type=e),class:"mt-4",items:m.periodTypes,label:"Tipo de Período",placeholder:"Selecione um tipo","prepend-inner-icon":"mdi-calendar","no-data-text":"Nenhum tipo encontrado","item-title":"periodtype_name","item-value":"periodtype_id",color:"secondary",density:"compact",variant:"outlined",clearable:"",rules:[m.rules.required]},null,8,["modelValue","items","rules"])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),(0,i.bF)(P.m,{value:1},{default:(0,i.k6)((()=>[(0,i.bF)(n.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(v.n,{modelValue:m.steps[1].formValid,"onUpdate:modelValue":o[6]||(o[6]=e=>m.steps[1].formValid=e)},{default:(0,i.k6)((()=>[(0,i.bF)(y.i,{locale:"pt"},{default:(0,i.k6)((()=>[(0,i.bF)(u.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(c.B,{cols:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(h.W,{modelValue:m.period.name,"onUpdate:modelValue":o[2]||(o[2]=e=>m.period.name=e),modelModifiers:{trim:!0},label:"Nome",placeholder:"Insira um nome","prepend-inner-icon":"mdi-tag-text-outline",color:"secondary",density:"compact",variant:"outlined",rules:[m.rules.required,m.rules.maxLength]},null,8,["modelValue","rules"])])),_:1}),(0,i.bF)(c.B,{cols:"6"},{default:(0,i.k6)((()=>[(0,i.bF)(V,{modelValue:m.period.startDate,"onUpdate:modelValue":o[3]||(o[3]=e=>m.period.startDate=e),label:"Data de início","prepend-icon":"","prepend-inner-icon":"mdi-calendar-start",color:"secondary",density:"compact",variant:"outlined",clearable:"",rules:[m.rules.required]},null,8,["modelValue","rules"])])),_:1}),(0,i.bF)(c.B,{cols:"6"},{default:(0,i.k6)((()=>[(0,i.bF)(V,{modelValue:m.period.endDate,"onUpdate:modelValue":o[4]||(o[4]=e=>m.period.endDate=e),label:"Data de fim","prepend-icon":"","prepend-inner-icon":"mdi-calendar-end",color:"secondary",density:"compact",variant:"outlined",clearable:"",rules:[m.rules.required]},null,8,["modelValue","rules"])])),_:1}),(0,i.bF)(c.B,{cols:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(F.J,{modelValue:m.period.description,"onUpdate:modelValue":o[5]||(o[5]=e=>m.period.description=e),modelModifiers:{trim:!0},label:"Descrição",placeholder:"Insira uma descrição","prepend-inner-icon":"mdi-text-box-outline",color:"secondary",density:"compact",variant:"outlined",rules:[m.rules.description]},null,8,["modelValue","rules"])])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}),(0,i.bF)(P.m,{value:2},{default:(0,i.k6)((()=>[(0,i.bF)(n.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(v.n)])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,i.bF)(_.G),(0,i.bF)(f.S,null,{default:(0,i.k6)((()=>[m.step>0?((0,i.uX)(),(0,i.Wv)(l.D,{key:0,"prepend-icon":"mdi-chevron-left",variant:"tonal",onClick:o[8]||(o[8]=e=>m.step--)},{default:(0,i.k6)((()=>[(0,i.eW)(" Anterior ")])),_:1})):(0,i.Q3)("",!0),(0,i.bF)(p.h),m.step<1?((0,i.uX)(),(0,i.Wv)(l.D,{key:1,disabled:!m.steps[m.step].formValid,"append-icon":"mdi-chevron-right",color:"secondary",variant:"tonal",onClick:o[9]||(o[9]=e=>m.step++)},{default:(0,i.k6)((()=>[(0,i.eW)(" Próximo ")])),_:1},8,["disabled"])):1===m.step?((0,i.uX)(),(0,i.Wv)(l.D,{key:2,disabled:!m.steps[m.step].formValid,color:"success",variant:"flat","append-icon":"mdi-check",loading:m.isLoading,onClick:o[10]||(o[10]=e=>g.postPeriod())},{default:(0,i.k6)((()=>[(0,i.eW)(" Adicionar ")])),_:1},8,["disabled","loading"])):(0,i.Q3)("",!0)])),_:1})])),_:1})])),_:1},8,["modelValue"])}var L=t(6044),S=t(501),w=t(8355),x={name:"AddPeriod",setup(){const e=(0,L.E)(),o=(0,S.T)();return{accountStore:e,generalStore:o}},data(){return{dialog:!1,period:{type:null,name:null,startDate:null,endDate:null,description:null},isLoading:!1,step:0,steps:[{title:"Tipo",formValid:!1},{title:"Datas",formValid:!1}],rules:{required:e=>!!e||"Campo obrigatório",maxLength:e=>e&&e.length<=25||"Máximo de 25 caracteres.",description:e=>e&&e.length<=255||!e||"Máximo de 255 caracteres."},periodTypes:[],isLoadingTypes:!1}},watch:{dialog(e){e&&this.onOpenDialog()}},computed:{lastStep(){return this.steps.length-1}},methods:{onOpenDialog(){this.getPeriodTypes()},async getPeriodTypes(){this.isLoadingTypes=!0,await w.A.request({url:"api/periodtypes",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token},params:{periodtype_id:this.periodTypeSelected}}).then((e=>{this.periodTypes=e.data,this.isLoadingTypes=!1})).catch((e=>{console.error(e),this.generalStore.errorSnackbar("Erro ao buscar tipos de período"),this.isLoadingTypes=!1}))},async postPeriod(){this.isLoading=!0;let e={periodtype_id:this.period.type,period_name:this.period.name,period_description:this.period.description,period_startdate:this.period.startDate,period_enddate:this.period.endDate};await w.A.request({url:"api/periods",method:"POST",headers:{Authorization:"Bearer "+this.accountStore.account.token},data:e}).then((e=>{this.isLoading=!1,this.generalStore.successSnackbar("Período adicionado com sucesso"),this.$emit("refresh"),this.dialog=!1})).catch((e=>{console.error(e),this.generalStore.errorSnackbar("Erro ao adicionar período"),this.isLoading=!1}))},reset(){this.period={type:null,name:null,startDate:null,endDate:null},this.isLoading=!1,this.step=0,this.periodTypes=[]}}},W=t(1241);const T=(0,W.A)(x,[["render",V]]);var C=T,A=t(5523),B=t(1867),E=t(1146),R=t(1161);const U={key:0},q=(0,i.Lk)("span",{class:"text-h6"},"Descrição",-1),M=(0,i.Lk)("span",null,"Remover Período",-1);function $(e,o,t,a,s,u){const c=(0,i.g2)("PeriodEdit"),p=(0,i.g2)("PeriodDuplicate");return(0,i.uX)(),(0,i.Wv)(E.i,{class:"pa-2",elevation:"8",rounded:"lg",width:"100%"},{default:(0,i.k6)((()=>[(0,i.bF)(B.g,{"fixed-header":"","no-data-text":"Nenhum período encontrado","loading-text":"A carregar períodos...",headers:u.headers,items:u.tableItems,loading:t.isLoadingPeriods,height:u.tableHeight},{item:(0,i.k6)((e=>[(0,i.Lk)("tr",null,[(0,i.Lk)("td",null,[(0,i.bF)(l.D,{color:"info",variant:"text",icon:"mdi-information-outline",onClick:o=>u.showInfo(e.item.period_id)},null,8,["onClick"])]),(0,i.Lk)("td",null,(0,b.v_)(e.item.period_name),1),(0,i.Lk)("td",null,[(0,i.bF)(A.x,{label:"",color:"info"},{default:(0,i.k6)((()=>[(0,i.eW)((0,b.v_)(e.item.periodtype_name),1)])),_:2},1024)]),(0,i.Lk)("td",null,(0,b.v_)(u.formatDate(e.item.period_startdate)),1),(0,i.Lk)("td",null,(0,b.v_)(u.formatDate(e.item.period_enddate)),1),(0,i.Lk)("td",null,[e.item.period_description?((0,i.uX)(),(0,i.Wv)(l.D,{key:0,color:"info",variant:"text",icon:"mdi-text-box-outline",onClick:o=>u.showDescription(e.item)},null,8,["onClick"])):((0,i.uX)(),(0,i.Wv)(l.D,{key:1,color:"info",variant:"text",icon:"",disabled:""},{default:(0,i.k6)((()=>[(0,i.bF)(m.w,null,{default:(0,i.k6)((()=>[(0,i.eW)("mdi-text-box-outline")])),_:1})])),_:1}))]),a.accountStore.hasRole(["Administrador"])?((0,i.uX)(),(0,i.CE)("td",U,[(0,i.bF)(l.D,{color:"warning",variant:"text",icon:"",onClick:o=>u.editPeriod(e.item)},{default:(0,i.k6)((()=>[(0,i.bF)(m.w,null,{default:(0,i.k6)((()=>[(0,i.eW)("mdi-pencil")])),_:1}),(0,i.bF)(R.y,{activator:"parent",location:"bottom"},{default:(0,i.k6)((()=>[(0,i.eW)("Editar")])),_:1})])),_:2},1032,["onClick"]),(0,i.bF)(l.D,{color:"secondary",variant:"text",icon:"",onClick:o=>u.openDuplicateDialog(e.item)},{default:(0,i.k6)((()=>[(0,i.bF)(m.w,null,{default:(0,i.k6)((()=>[(0,i.eW)("mdi-content-copy")])),_:1}),(0,i.bF)(R.y,{activator:"parent",location:"bottom"},{default:(0,i.k6)((()=>[(0,i.eW)("Duplicar")])),_:1})])),_:2},1032,["onClick"]),(0,i.bF)(l.D,{color:"error",variant:"text",icon:"",onClick:o=>u.openRemoveDialog(e.item)},{default:(0,i.k6)((()=>[(0,i.bF)(m.w,null,{default:(0,i.k6)((()=>[(0,i.eW)("mdi-delete-outline")])),_:1}),(0,i.bF)(R.y,{activator:"parent",location:"bottom"},{default:(0,i.k6)((()=>[(0,i.eW)("Remover")])),_:1})])),_:2},1032,["onClick"])])):(0,i.Q3)("",!0)])])),_:1},8,["headers","items","loading","height"]),(0,i.bF)(k.p,{modelValue:s.descDialog,"onUpdate:modelValue":o[0]||(o[0]=e=>s.descDialog=e),onAfterLeave:o[1]||(o[1]=e=>s.selectedPeriod=null),width:"auto"},{default:(0,i.k6)((()=>[(0,i.bF)(r.J,{class:"mx-auto",width:"400"},{default:(0,i.k6)((()=>[(0,i.bF)(d.r,{class:"bg-info d-flex align-center"},{default:(0,i.k6)((()=>[(0,i.bF)(m.w,{size:"small",class:"mr-2"},{default:(0,i.k6)((()=>[(0,i.eW)("mdi-text-box-outline")])),_:1}),q])),_:1}),(0,i.bF)(n.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(F.J,{"model-value":s.selectedPeriod.period_description,readonly:"","no-resize":"",rows:"5",color:"secondary",density:"compact",variant:"outlined"},null,8,["model-value"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,i.bF)(k.p,{modelValue:s.deleteDialog,"onUpdate:modelValue":o[4]||(o[4]=e=>s.deleteDialog=e),onAfterLeave:o[5]||(o[5]=e=>s.selectedPeriod=null),width:"auto",persistent:""},{default:(0,i.k6)((()=>[(0,i.bF)(r.J,null,{default:(0,i.k6)((()=>[(0,i.bF)(d.r,{class:"bg-error d-flex align-center"},{default:(0,i.k6)((()=>[(0,i.bF)(m.w,{size:"small",class:"mr-2"},{default:(0,i.k6)((()=>[(0,i.eW)("mdi-delete-outline")])),_:1}),M])),_:1}),(0,i.bF)(n.O,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,b.v_)(s.selectedPeriod?`Deseja remover o período ${s.selectedPeriod.period_name}?`:""),1)])),_:1}),(0,i.bF)(_.G),(0,i.bF)(f.S,{class:"d-flex justify-space-around"},{default:(0,i.k6)((()=>[(0,i.bF)(l.D,{color:"error",variant:"tonal",icon:"mdi-close",onClick:o[2]||(o[2]=e=>s.deleteDialog=!1)}),(0,i.bF)(l.D,{color:"secondary",variant:"tonal",icon:"mdi-check",loading:s.isLoadingDelete,onClick:o[3]||(o[3]=e=>u.deletePeriod())},null,8,["loading"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,i.bF)(c,{period:s.selectedPeriod,dialog:s.editDialog,"onUpdate:period":o[6]||(o[6]=e=>s.selectedPeriod=e),"onUpdate:dialog":o[7]||(o[7]=e=>s.editDialog=e),onRefreshPeriods:o[8]||(o[8]=o=>e.$emit("refresh"))},null,8,["period","dialog"]),(0,i.bF)(p,{ref:"PeriodDuplicate",period_id:s.selectedPeriod?.period_id,dialog:s.duplicateDialog,"onUpdate:dialog":o[9]||(o[9]=e=>s.duplicateDialog=e),onRefreshPeriods:o[10]||(o[10]=o=>e.$emit("refresh"))},null,8,["period_id","dialog"])])),_:1})}const X=(0,i.Lk)("span",null,"Editar Período",-1);function I(e,o,t,s,p,g){const b=(0,i.g2)("v-date-input");return(0,i.uX)(),(0,i.Wv)(k.p,{modelValue:g.localDialog,"onUpdate:modelValue":o[8]||(o[8]=e=>g.localDialog=e),onAfterLeave:o[9]||(o[9]=e=>g.reset()),width:"auto"},{default:(0,i.k6)((()=>[(0,i.bF)(r.J,{class:"mx-auto",width:"450"},{default:(0,i.k6)((()=>[(0,i.bF)(d.r,{class:"bg-warning d-flex align-center"},{default:(0,i.k6)((()=>[(0,i.bF)(m.w,{size:"small",class:"mr-2"},{default:(0,i.k6)((()=>[(0,i.eW)("mdi-pencil")])),_:1}),X])),_:1}),(0,i.bF)(n.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(v.n,{modelValue:p.formValid,"onUpdate:modelValue":o[5]||(o[5]=e=>p.formValid=e)},{default:(0,i.k6)((()=>[(0,i.bF)(u.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(c.B,{cols:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(a.V,{modelValue:g.localPeriod.periodtype_id,"onUpdate:modelValue":o[0]||(o[0]=e=>g.localPeriod.periodtype_id=e),class:"mt-4",items:p.periodTypes,label:"Tipo de Período",placeholder:"Selecione um tipo","prepend-inner-icon":"mdi-calendar","no-data-text":"Nenhum tipo encontrado","item-title":"periodtype_name","item-value":"periodtype_id",color:"secondary",density:"compact",variant:"outlined",rules:[p.rules.required]},null,8,["modelValue","items","rules"])])),_:1}),(0,i.bF)(_.G),(0,i.bF)(c.B,{cols:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(h.W,{class:"mt-4",modelValue:g.localPeriod.period_name,"onUpdate:modelValue":o[1]||(o[1]=e=>g.localPeriod.period_name=e),modelModifiers:{trim:!0},label:"Nome",placeholder:"Insira um nome","prepend-inner-icon":"mdi-tag-text-outline",color:"secondary",density:"compact",variant:"outlined",rules:[p.rules.required,p.rules.sizesmall]},null,8,["modelValue","rules"])])),_:1}),(0,i.bF)(c.B,{cols:"6"},{default:(0,i.k6)((()=>[(0,i.bF)(b,{modelValue:g.localPeriod.period_startdate,"onUpdate:modelValue":o[2]||(o[2]=e=>g.localPeriod.period_startdate=e),label:"Data de início","prepend-icon":"","prepend-inner-icon":"mdi-calendar-start",color:"secondary",density:"compact",variant:"outlined",clearable:"",rules:[p.rules.required]},null,8,["modelValue","rules"])])),_:1}),(0,i.bF)(c.B,{cols:"6"},{default:(0,i.k6)((()=>[(0,i.bF)(b,{modelValue:g.localPeriod.period_enddate,"onUpdate:modelValue":o[3]||(o[3]=e=>g.localPeriod.period_enddate=e),label:"Data de fim","prepend-icon":"","prepend-inner-icon":"mdi-calendar-end",color:"secondary",density:"compact",variant:"outlined",clearable:"",rules:[p.rules.required]},null,8,["modelValue","rules"])])),_:1}),(0,i.bF)(c.B,{cols:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(F.J,{modelValue:g.localPeriod.period_description,"onUpdate:modelValue":o[4]||(o[4]=e=>g.localPeriod.period_description=e),modelModifiers:{trim:!0},label:"Descrição",placeholder:"Insira uma descrição","prepend-inner-icon":"mdi-text-box-outline",color:"secondary",density:"compact",variant:"outlined",rules:[p.rules.description]},null,8,["modelValue","rules"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,i.bF)(_.G),(0,i.bF)(f.S,{class:"d-flex justify-space-around"},{default:(0,i.k6)((()=>[(0,i.bF)(l.D,{color:"error",variant:"tonal",icon:"mdi-close",onClick:o[6]||(o[6]=e=>g.localDialog=!1)}),(0,i.bF)(l.D,{color:"secondary",variant:"tonal",icon:"mdi-check",loading:p.isLoading,disabled:!p.formValid,onClick:o[7]||(o[7]=e=>g.patchPeriod())},null,8,["loading","disabled"])])),_:1})])),_:1})])),_:1},8,["modelValue"])}var z=t(2666),O={name:"PeriodEdit",props:{period:Object,dialog:Boolean},setup(){const e=(0,S.T)(),o=(0,L.E)(),t=(0,z.S_)();return{generalStore:e,accountStore:o,date:t}},data(){return{isLoading:!1,formValid:!1,rules:{required:e=>!!e||"Campo obrigatório",sizesmall:e=>e&&e.length<=50||"Máximo de 50 caracteres",description:e=>e&&e.length<=255||!e||"Máximo de 255 caracteres."},periodTypes:[],isLoadingTypes:!1}},watch:{dialog(e){e&&(this.localPeriod.period_startdate=new Date(this.localPeriod.period_startdate),this.localPeriod.period_enddate=new Date(this.localPeriod.period_enddate),console.log(this.localPeriod),this.getPeriodTypes())}},computed:{localPeriod:{get(){return this.period},set(e){this.$emit("update:period",e)}},localDialog:{get(){return this.dialog},set(e){this.$emit("update:dialog",e)}}},methods:{async patchPeriod(){this.isLoading=!0,w.A.request({url:"api/periods/"+this.period.period_id,method:"PATCH",headers:{Authorization:"Bearer "+this.accountStore.account.token},data:this.localPeriod}).then((()=>{this.isLoading=!1,this.generalStore.successSnackbar("Período atualizado com sucesso"),this.$emit("refreshPeriods"),this.localDialog=!1})).catch((e=>{console.error(e),this.generalStore.errorSnackbar("Erro ao atualizar período"),this.isLoading=!1}))},async getPeriodTypes(){this.isLoadingTypes=!0,await w.A.request({url:"api/periodtypes",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token},params:{periodtype_id:this.periodTypeSelected}}).then((e=>{this.periodTypes=e.data,this.isLoadingTypes=!1})).catch((e=>{console.error(e),this.generalStore.errorSnackbar("Erro ao buscar tipos de período"),this.isLoadingTypes=!1}))},reset(){this.localPeriod=null,this.localDialog=!1}}};const j=(0,W.A)(O,[["render",I]]);var J=j,N=t(7254),Q=t(6106);const G={class:"text-center"};function H(e,o,t,s,g,V){const L=(0,i.g2)("v-date-input");return(0,i.uX)(),(0,i.Wv)(k.p,{modelValue:V.localDialog,"onUpdate:modelValue":o[11]||(o[11]=e=>V.localDialog=e),onAfterLeave:o[12]||(o[12]=e=>V.reset()),width:"auto"},{default:(0,i.k6)((()=>[(0,i.bF)(r.J,{class:"mx-auto",width:"450"},{default:(0,i.k6)((()=>[(0,i.bF)(d.r,{class:"bg-secondary"},{default:(0,i.k6)((()=>[(0,i.eW)((0,b.v_)(g.steps[g.step].title),1)])),_:1}),g.isLoading?((0,i.uX)(),(0,i.Wv)(n.O,{key:0},{default:(0,i.k6)((()=>[(0,i.Lk)("div",G,[(0,i.bF)(Q.x,{indeterminate:"",color:"primary"})])])),_:1})):((0,i.uX)(),(0,i.Wv)(D.r3,{key:1,modelValue:g.step,"onUpdate:modelValue":o[7]||(o[7]=e=>g.step=e)},{default:(0,i.k6)((()=>[(0,i.bF)(P.m,{value:0},{default:(0,i.k6)((()=>[(0,i.bF)(n.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(v.n,{modelValue:g.steps[0].formValid,"onUpdate:modelValue":o[5]||(o[5]=e=>g.steps[0].formValid=e)},{default:(0,i.k6)((()=>[(0,i.bF)(y.i,{locale:"pt"},{default:(0,i.k6)((()=>[(0,i.bF)(u.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(c.B,{cols:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(a.V,{modelValue:g.period.periodtype_id,"onUpdate:modelValue":o[0]||(o[0]=e=>g.period.periodtype_id=e),class:"mt-4",items:g.periodTypes,label:"Tipo de Período",placeholder:"Selecione um tipo","prepend-inner-icon":"mdi-calendar","no-data-text":"Nenhum tipo encontrado","item-title":"periodtype_name","item-value":"periodtype_id",color:"secondary",density:"compact",variant:"outlined",rules:[g.rules.required]},null,8,["modelValue","items","rules"])])),_:1}),(0,i.bF)(_.G),(0,i.bF)(c.B,{cols:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(h.W,{class:"mt-4",modelValue:g.period.period_name,"onUpdate:modelValue":o[1]||(o[1]=e=>g.period.period_name=e),modelModifiers:{trim:!0},label:"Nome",placeholder:"Insira um nome","prepend-inner-icon":"mdi-tag-text-outline",color:"secondary",density:"compact",variant:"outlined",rules:[g.rules.required,g.rules.sizesmall]},null,8,["modelValue","rules"])])),_:1}),(0,i.bF)(c.B,{cols:"6"},{default:(0,i.k6)((()=>[(0,i.bF)(L,{modelValue:g.period.period_startdate,"onUpdate:modelValue":o[2]||(o[2]=e=>g.period.period_startdate=e),label:"Data de início","prepend-icon":"","prepend-inner-icon":"mdi-calendar-start",color:"secondary",density:"compact",variant:"outlined",clearable:"",rules:[g.rules.required]},null,8,["modelValue","rules"])])),_:1}),(0,i.bF)(c.B,{cols:"6"},{default:(0,i.k6)((()=>[(0,i.bF)(L,{modelValue:g.period.period_enddate,"onUpdate:modelValue":o[3]||(o[3]=e=>g.period.period_enddate=e),label:"Data de fim","prepend-icon":"","prepend-inner-icon":"mdi-calendar-end",color:"secondary",density:"compact",variant:"outlined",clearable:"",rules:[g.rules.required]},null,8,["modelValue","rules"])])),_:1}),(0,i.bF)(c.B,{cols:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(F.J,{modelValue:g.period.period_description,"onUpdate:modelValue":o[4]||(o[4]=e=>g.period.period_description=e),modelModifiers:{trim:!0},label:"Descrição",placeholder:"Insira uma descrição","prepend-inner-icon":"mdi-text-box-outline",color:"secondary",density:"compact",variant:"outlined",rules:[g.rules.description]},null,8,["modelValue","rules"])])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}),(0,i.bF)(P.m,{value:1},{default:(0,i.k6)((()=>[(0,i.bF)(n.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(u.L,{align:"center"},{default:(0,i.k6)((()=>[(0,i.bF)(c.B,{cols:"2"},{default:(0,i.k6)((()=>[(0,i.bF)(l.D,{color:"info",variant:"outline",icon:"",onClick:V.selectAll},{default:(0,i.k6)((()=>[(0,i.bF)(m.w,null,{default:(0,i.k6)((()=>[(0,i.eW)("mdi-playlist-check")])),_:1}),(0,i.bF)(R.y,{activator:"parent",location:"left"},{default:(0,i.k6)((()=>[(0,i.eW)("Selecionar todas")])),_:1})])),_:1},8,["onClick"])])),_:1}),(0,i.bF)(c.B,{cols:"10"},{default:(0,i.k6)((()=>[(0,i.bF)(a.V,{modelValue:g.regionsToAdd,"onUpdate:modelValue":o[6]||(o[6]=e=>g.regionsToAdd=e),items:g.regions,label:"Parcelas a manter",placeholder:"Selecione as parcelas a manter","no-data-text":"Nenhuma parcela encontrada",color:"secondary",density:"compact",variant:"outlined",chips:"","item-title":e=>`[${e.region.region_code}] `+e.region.region_name,"closable-chips":"","return-object":"",multiple:"",clearable:"","hide-details":"","prepend-inner-icon":"mdi-land-plots-marker"},{chip:(0,i.k6)((({props:e,item:o})=>[(0,i.bF)(A.x,(0,i.v6)(e,{text:`[${o.raw.region.region_code}] `+o.raw.region.region_name+(o.raw.region.eois?" ("+o.raw.region.eois.length+")":"")}),null,16,["text"])])),item:(0,i.k6)((({props:e,item:o})=>[(0,i.bF)(N.g,(0,i.v6)(e,{title:`[${o.raw.region.region_code}] `+o.raw.region.region_name,subtitle:`${o.raw.eois?o.raw.eois.length:"Sem"} EOIs`}),null,16,["title","subtitle"])])),_:1},8,["modelValue","items","item-title"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])),(0,i.bF)(_.G),(0,i.bF)(f.S,null,{default:(0,i.k6)((()=>[g.step>0?((0,i.uX)(),(0,i.Wv)(l.D,{key:0,"prepend-icon":"mdi-chevron-left",variant:"tonal",onClick:o[8]||(o[8]=e=>g.step--)},{default:(0,i.k6)((()=>[(0,i.eW)(" Anterior ")])),_:1})):(0,i.Q3)("",!0),(0,i.bF)(p.h),g.step<V.lastStep?((0,i.uX)(),(0,i.Wv)(l.D,{key:1,disabled:!g.steps[g.step].formValid,"append-icon":"mdi-chevron-right",color:"secondary",variant:"tonal",onClick:o[9]||(o[9]=e=>g.step++)},{default:(0,i.k6)((()=>[(0,i.eW)(" Próximo ")])),_:1},8,["disabled"])):g.step===V.lastStep?((0,i.uX)(),(0,i.Wv)(l.D,{key:2,disabled:!g.steps[g.step].formValid,color:"success",variant:"flat","append-icon":"mdi-check",loading:g.isLoading||g.isLoadingPost,onClick:o[10]||(o[10]=e=>V.duplicatePeriod())},{default:(0,i.k6)((()=>[(0,i.eW)(" Adicionar ")])),_:1},8,["disabled","loading"])):(0,i.Q3)("",!0)])),_:1})])),_:1})])),_:1},8,["modelValue"])}var K={name:"PeriodDuplicate",props:{period_id:{type:Number},dialog:{type:Boolean}},setup(){const e=(0,L.E)(),o=(0,S.T)();return{accountStore:e,generalStore:o}},data(){return{isLoading:!1,isLoadingPost:!1,period:{},regionsToAdd:[],step:0,steps:[{title:"Detalhes do Período",formValid:!1},{title:"Parcelas a manter",formValid:!0}],rules:{required:e=>!!e||"Campo obrigatório",sizesmall:e=>e&&e.length<=50||"Máximo de 50 caracteres",description:e=>e&&e.length<=255||!e||"Máximo de 255 caracteres."},periodTypes:[],isLoadingTypes:!1,regions:[],isLoadingRegions:!1}},watch:{dialog(e){e&&this.onOpenDialog()}},computed:{localDialog:{get(){return this.dialog},set(e){this.$emit("update:dialog",e)}},lastStep(){return this.steps.length-1},treeItems(){return this.regions.map((e=>({id:e.region.region_id,name:e.region.region_name,children:e.region.eois.map((e=>({id:e.eoi_id,name:e.eoi_name})))})))}},methods:{reset(){this.isLoading=!1,this.period={},this.regionsToAdd=[],this.periodTypes=[],this.regions=[],this.step=0},onOpenDialog(){this.isLoading=!0,Promise.all([this.getPeriod(),this.getPeriodTypes(),this.getRegions()]).then((()=>{this.isLoading=!1}))},selectAll(){this.regionsToAdd=this.regions},async duplicatePeriod(){this.isLoadingPost=!0;let e={period:this.period,regions:this.regionsToAdd.map((e=>({region_id:e.region.region_id,eois:e.eois?.map((e=>e.eoi_id))})))};console.log(e),await w.A.request({url:"api/periods/duplicate",method:"POST",headers:{Authorization:`Bearer ${this.accountStore.account.token}`},data:e}).then((()=>{this.isLoadingPost=!1,this.generalStore.successSnackbar("Período duplicado com sucesso"),this.localDialog=!1,this.$emit("refreshPeriods")})).catch((e=>{this.isLoadingPost=!1,console.error(e),this.generalStore.errorSnackbar("Erro ao duplicar período")}))},async getPeriod(){this.isLoading=!0,await w.A.request({url:"api/periods/"+this.period_id,headers:{Authorization:`Bearer ${this.accountStore.account.token}`}}).then((e=>{this.period=e.data,this.period.period_name=`${this.period.period_name} (Cópia)`,this.period.period_startdate=new Date(this.period.period_startdate),this.period.period_enddate=new Date(this.period.period_enddate)})).catch((e=>{this.generalStore.errorSnackbar("Erro ao buscar detalhes do período"),console.error(e)}))},async getPeriodTypes(){this.isLoadingTypes=!0,await w.A.request({url:"api/periodtypes",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token},params:{periodtype_id:this.periodTypeSelected}}).then((e=>{this.periodTypes=e.data})).catch((e=>{console.error(e),this.generalStore.errorSnackbar("Erro ao buscar tipos de período")}))},async getRegions(){await w.A.request({url:"api/periods/"+this.period_id+"/regionsinperiods",headers:{Authorization:`Bearer ${this.accountStore.account.token}`}}).then((e=>{let o=e.data.regioninperiods.map((e=>({regioninperiod_id:e.regioninperiod_id,region:e.region,eois:e.elements_of_interest})));this.regions.push(...o),this.offset+=this.regions.length,this.hasMore=e.data.hasMore})).catch((e=>{this.generalStore.errorSnackbar("Erro ao buscar regiões do período")}))}}};const Y=(0,W.A)(K,[["render",H],["__scopeId","data-v-3aec1eaf"]]);var Z=Y,ee={name:"PeriodsTable",components:{PeriodEdit:J,PeriodDuplicate:Z},props:{periods:{type:Array,required:!0},isLoadingPeriods:{type:Boolean,required:!0},hasMore:{type:Boolean,required:!0}},setup(){const e=(0,S.T)(),o=(0,L.E)();return{generalStore:e,accountStore:o}},data(){return{descDialog:!1,editDialog:!1,deleteDialog:!1,duplicateDialog:!1,isLoadingDelete:!1,selectedPeriod:null}},computed:{tableHeight(){return window.innerHeight-260},headers(){let e=[{title:""},{title:"Nome",key:"period_name"},{title:"Tipo",key:"periodtype_name"},{title:"Data de Início",key:"period_startdate"},{title:"Data de Fim",key:"period_enddate"},{title:"Descrição"}];return this.accountStore.hasRole(["Administrador"])&&e.push({title:""}),e},tableItems(){return this.periods}},methods:{loadMore(e){e&&this.$emit("loadMore")},formatDate(e){return new Date(e).toLocaleDateString("pt-PT")},showInfo(e){this.$emit("showInfo",e)},showDescription(e){this.selectedPeriod=e,this.descDialog=!0},editPeriod(e){this.selectedPeriod=Object.assign({},e),this.editDialog=!0},openDuplicateDialog(e){this.selectedPeriod=e,this.duplicateDialog=!0},openRemoveDialog(e){this.selectedPeriod=e,this.deleteDialog=!0},async deletePeriod(){this.isLoadingDelete=!0,await w.A.request({url:"api/periods/"+this.selectedPeriod.period_id,method:"DELETE",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((()=>{this.isLoadingDelete=!1,this.deleteDialog=!1,this.generalStore.successSnackbar("Período removido com sucesso!"),this.$emit("refresh")})).catch((e=>{console.error(e),this.isLoadingDelete=!1,this.generalStore.errorSnackbar(e.response.data.error,3e3)}))}}};const oe=(0,W.A)(ee,[["render",$]]);var te=oe,ie=t(373),ae=t(381),le=t(6686),re=t(7604),de=t(4441);function ne(e,o,t,a,l,p){const m=(0,i.g2)("PeriodDetail"),h=(0,i.g2)("PeriodRegions");return(0,i.uX)(),(0,i.Wv)(ie.e,{location:"right",modelValue:l.drawer,"onUpdate:modelValue":o[2]||(o[2]=e=>l.drawer=e),width:"1000",temporary:"","disable-route-watcher":""},{default:(0,i.k6)((()=>[(0,i.bF)(r.J,{class:"fill-height"},{default:(0,i.k6)((()=>[(0,i.bF)(d.r,{class:"bg-primary"},{default:(0,i.k6)((()=>[(0,i.eW)(" Detalhes do Período "),(0,i.Lk)("i",null,(0,b.v_)(l.period?.period_name),1)])),_:1}),(0,i.bF)(n.O,{class:"fill-height pa-0"},{default:(0,i.k6)((()=>[(0,i.bF)(s.I,{class:"fill-height pa-0"},{default:(0,i.k6)((()=>[l.isLoading?((0,i.uX)(),(0,i.Wv)(u.L,{key:0,align:"center"},{default:(0,i.k6)((()=>[(0,i.bF)(c.B,{class:"d-flex align-center justify-center"},{default:(0,i.k6)((()=>[(0,i.bF)(Q.x,{color:"secondary",size:"65",width:"7",indeterminate:""})])),_:1})])),_:1})):(0,i.Q3)("",!0),l.isLoading||null==l.period?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.Wv)(r.J,{key:1,elevation:"0",flat:"",rounded:"",width:"100%",height:"100%",class:"ma-0"},{default:(0,i.k6)((()=>[(0,i.bF)(ae.h,{color:"secondary",modelValue:l.tab,"onUpdate:modelValue":o[0]||(o[0]=e=>l.tab=e),grow:""},{default:(0,i.k6)((()=>[(0,i.bF)(le.U,{value:"period"},{default:(0,i.k6)((()=>[(0,i.eW)("Período")])),_:1}),(0,i.bF)(le.U,{value:"regions"},{default:(0,i.k6)((()=>[(0,i.eW)("Parcelas")])),_:1})])),_:1},8,["modelValue"]),(0,i.bF)(n.O,{class:"fill-height"},{default:(0,i.k6)((()=>[(0,i.bF)(re.l,{modelValue:l.tab,"onUpdate:modelValue":o[1]||(o[1]=e=>l.tab=e),class:"fill-height"},{default:(0,i.k6)((()=>[(0,i.bF)(de.Y,{value:"period",class:"fill-height"},{default:(0,i.k6)((()=>[(0,i.bF)(m,{period:l.period},null,8,["period"])])),_:1}),(0,i.bF)(de.Y,{value:"regions",class:"fill-height"},{default:(0,i.k6)((()=>[(0,i.bF)(h,{period:l.period},null,8,["period"])])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}))])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])}var se=t(5627);const ue=e=>((0,i.Qi)("data-v-9dbc000a"),e=e(),(0,i.jt)(),e),ce=ue((()=>(0,i.Lk)("span",{class:"text-h4"},"Informação Geral",-1))),pe={class:"text-subtitle-1"},me={class:"text-subtitle-1"},he=ue((()=>(0,i.Lk)("span",{class:"text-subtitle-1"}," Descrição: ",-1))),ge=ue((()=>(0,i.Lk)("br",null,null,-1))),be={key:0},fe={key:1,class:"text-overline text-center"};function ke(e,o,t,a,l,s){return(0,i.uX)(),(0,i.Wv)(r.J,{elevation:"0",border:"",rounded:"",class:"pa-5",height:"85%","min-height":"350"},{default:(0,i.k6)((()=>[(0,i.bF)(d.r,{class:"d-flex justify-space-between align-center"},{default:(0,i.k6)((()=>[ce])),_:1}),(0,i.bF)(n.O,{class:"fill-height mt-5 scrollable-card"},{default:(0,i.k6)((()=>[(0,i.bF)(E.i,{border:"",rounded:"",class:"pa-5"},{default:(0,i.k6)((()=>[(0,i.bF)(u.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(c.B,{cols:"6"},{default:(0,i.k6)((()=>[(0,i.Lk)("span",pe,[(0,i.eW)(" Nome do Período: "),(0,i.Lk)("strong",null,(0,b.v_)(l.localPeriod.period_name),1)])])),_:1}),(0,i.bF)(c.B,{cols:"6"},{default:(0,i.k6)((()=>[(0,i.Lk)("span",me,[(0,i.eW)(" Tipo de Período: "),(0,i.bF)(A.x,{label:"",color:"info"},{default:(0,i.k6)((()=>[(0,i.eW)((0,b.v_)(l.localPeriod.period_type.periodtype_name),1)])),_:1})])])),_:1}),(0,i.bF)(c.B,{cols:"12"},{default:(0,i.k6)((()=>[he,ge,l.localPeriod.period_description?((0,i.uX)(),(0,i.CE)("span",be,(0,b.v_)(l.localPeriod.period_description),1)):((0,i.uX)(),(0,i.CE)("span",fe," Sem descrição "))])),_:1}),(0,i.bF)(c.B,{cols:"6"},{default:(0,i.k6)((()=>[(0,i.bF)(y.i,{locale:"pt"},{default:(0,i.k6)((()=>[(0,i.bF)(se.f,{title:"Data de Início","model-value":l.localPeriod.period_startdate,disabled:""},null,8,["model-value"])])),_:1})])),_:1}),(0,i.bF)(c.B,{cols:"6"},{default:(0,i.k6)((()=>[(0,i.bF)(y.i,{locale:"pt"},{default:(0,i.k6)((()=>[(0,i.bF)(se.f,{title:"Data de término","model-value":l.localPeriod.period_enddate,disabled:""},null,8,["model-value"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}var _e={name:"PeriodDetail",props:{period:{type:Object,required:!0}},setup(){const e=(0,S.T)(),o=(0,L.E)();return{generalStore:e,accountStore:o}},data(){return{localPeriod:{...this.period}}},mounted(){this.localPeriod.period_startdate=new Date(this.period.period_startdate),this.localPeriod.period_enddate=new Date(this.period.period_enddate)}};const ve=(0,W.A)(_e,[["render",ke],["__scopeId","data-v-9dbc000a"]]);var ye=ve,Fe=t(8815),De=t(9336),Pe=t(8738),Ve=t(594),Le=t(9562),Se=t(9629);const we=e=>((0,i.Qi)("data-v-fb42095e"),e=e(),(0,i.jt)(),e),xe=we((()=>(0,i.Lk)("span",{class:"text-h4"},"Pesquisa",-1))),We={clas:"text-h4"},Te={class:"px-4"},Ce={key:0,class:"mb-5"},Ae=we((()=>(0,i.Lk)("br",null,null,-1))),Be=we((()=>(0,i.Lk)("span",null,"Remover perído da região",-1)));function Ee(e,o,t,a,s,p){const g=(0,i.g2)("PeriodRegionDetail");return(0,i.uX)(),(0,i.Wv)(r.J,{elevation:"0",border:"",rounded:"",class:"pa-5",height:"85%","min-height":"350"},{default:(0,i.k6)((()=>[(0,i.bF)(d.r,null,{default:(0,i.k6)((()=>[xe,(0,i.bF)(u.L,{class:"d-flex align-center justify-space-between"},{default:(0,i.k6)((()=>[(0,i.bF)(c.B,{cols:"5"},{default:(0,i.k6)((()=>[(0,i.bF)(h.W,{modelValue:s.filter.region_name,"onUpdate:modelValue":o[0]||(o[0]=e=>s.filter.region_name=e),color:"secondary",placeholder:"Nome",density:"compact",variant:"solo","hide-details":"",class:"mt-5",clearable:"","append-icon":"mdi-magnify","onClick:append":p.refreshRegions,"onClick:clear":p.refreshRegions},null,8,["modelValue","onClick:append","onClick:clear"])])),_:1})])),_:1})])),_:1}),(0,i.bF)(n.O,{class:"scrollable-card mt-5"},{default:(0,i.k6)((()=>[s.isLoading?((0,i.uX)(),(0,i.Wv)(De.Z,{key:0,color:"primary",indeterminate:""})):((0,i.uX)(),(0,i.Wv)(Fe.$,{key:1,items:s.regions,"item-value":"regioninperiod_id","items-per-page":s.regions.length},{default:(0,i.k6)((({items:e,isExpanded:o,toggleExpand:t})=>[(0,i.bF)(u.L,null,{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e,(e=>((0,i.uX)(),(0,i.Wv)(c.B,{cols:"12",key:e.raw.regioninperiod_id},{default:(0,i.k6)((()=>[(0,i.bF)(r.J,null,{default:(0,i.k6)((()=>[(0,i.bF)(d.r,{class:"d-flex align-center justify-space-between"},{default:(0,i.k6)((()=>[(0,i.Lk)("span",We,(0,b.v_)(e.raw.region.region_name),1),a.accountStore.hasRole(["Produtor","Organização","Administrador"])?((0,i.uX)(),(0,i.Wv)(l.D,{key:0,color:"error",variant:"text",icon:"",onClick:o=>p.openDeleteDialog(e.raw)},{default:(0,i.k6)((()=>[(0,i.bF)(m.w,null,{default:(0,i.k6)((()=>[(0,i.eW)("mdi-delete-outline")])),_:1}),(0,i.bF)(R.y,{activator:"parent",location:"bottom"},{default:(0,i.k6)((()=>[(0,i.eW)(" Remover ")])),_:1})])),_:2},1032,["onClick"])):(0,i.Q3)("",!0)])),_:2},1024),(0,i.Lk)("div",Te,[(0,i.bF)(Ve.N,{label:(o(e)?"Esconder":"Mostrar")+" Detalhes","model-value":o(e),density:"compact",color:"secondary",onClick:()=>t(e)},null,8,["label","model-value","onClick"]),(0,i.bF)(Le.Qo,null,{default:(0,i.k6)((()=>[o(e)?((0,i.uX)(),(0,i.CE)("div",Ce,[(0,i.bF)(g,{regionId:e.raw.region.region_id},null,8,["regionId"])])):(0,i.Q3)("",!0)])),_:2},1024)])])),_:2},1024)])),_:2},1024)))),128)),s.hasMore?((0,i.uX)(),(0,i.Wv)(c.B,{key:0,cols:"12"},{default:(0,i.k6)((()=>[(0,i.bo)((0,i.bF)(Pe.V8,{type:"card"},null,512),[[Se.o,{handler:p.loadMore,options:{threshold:.3}},void 0,{quiet:!0}]])])),_:1})):((0,i.uX)(),(0,i.Wv)(c.B,{key:1,cols:"12"},{default:(0,i.k6)((()=>[Ae])),_:1}))])),_:2},1024)])),_:1},8,["items","items-per-page"]))])),_:1}),(0,i.bF)(k.p,{modelValue:s.deleteDialog,"onUpdate:modelValue":o[3]||(o[3]=e=>s.deleteDialog=e),persistent:"",width:"auto",onAfterLeave:p.resetDeleteDialog},{default:(0,i.k6)((()=>[(0,i.bF)(r.J,{width:"40rem"},{default:(0,i.k6)((()=>[(0,i.bF)(d.r,{class:"bg-error d-flex align-center"},{default:(0,i.k6)((()=>[(0,i.bF)(m.w,{size:"small",class:"mr-2"},{default:(0,i.k6)((()=>[(0,i.eW)("mdi-delete-outline")])),_:1}),Be])),_:1}),(0,i.bF)(n.O,{class:"text-center"},{default:(0,i.k6)((()=>[(0,i.Lk)("span",null,[(0,i.eW)("Tem a certeza que quer dessassociar a região "),(0,i.Lk)("b",null,(0,b.v_)(s.regioninperiod.region.region_name),1),(0,i.eW)("?")])])),_:1}),(0,i.bF)(_.G),(0,i.bF)(f.S,{class:"d-flex justify-space-around"},{default:(0,i.k6)((()=>[(0,i.bF)(l.D,{color:"error",variant:"tonal",icon:"mdi-close",onClick:o[1]||(o[1]=e=>s.deleteDialog=!1)}),(0,i.bF)(l.D,{color:"secondary",variant:"tonal",icon:"mdi-check",loading:s.isLoadingDelete,onClick:o[2]||(o[2]=e=>p.deleteRegionPeriod())},null,8,["loading"])])),_:1})])),_:1})])),_:1},8,["modelValue","onAfterLeave"])])),_:1})}const Re={class:"d-flex flex-column justify-space-evenly"},Ue={class:"text-subtitle-1"},qe={class:"text-subtitle-1"},Me={class:"text-subtitle-1"},$e={class:"text-subtitle-1"},Xe={class:"text-subtitle-1 d-flex","full-width":""},Ie={key:0},ze={key:1},Oe=(0,i.Lk)("b",null,"Sem estação",-1),je=[Oe];function Je(e,o,t,a,l,r){const d=(0,i.g2)("StationData"),n=(0,i.g2)("RegionMap");return(0,i.uX)(),(0,i.Wv)(E.i,null,{default:(0,i.k6)((()=>[l.isLoading?((0,i.uX)(),(0,i.Wv)(u.L,{key:0,align:"center"},{default:(0,i.k6)((()=>[(0,i.bF)(c.B,{class:"d-flex align-center justify-center"},{default:(0,i.k6)((()=>[(0,i.bF)(De.Z,{color:"secondary",indeterminate:""})])),_:1})])),_:1})):l.isLoading||null==this.region?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.Wv)(u.L,{key:1,"no-gutters":""},{default:(0,i.k6)((()=>[(0,i.bF)(c.B,{cols:"6",class:"d-flex flex-column justify-space-evenly"},{default:(0,i.k6)((()=>[(0,i.Lk)("div",Re,[(0,i.Lk)("span",Ue,[(0,i.eW)("Nome: "),(0,i.Lk)("b",null,(0,b.v_)(l.region.region_name),1)]),(0,i.Lk)("span",qe,[(0,i.eW)("Código: "),(0,i.bF)(A.x,{color:"secondary"},{default:(0,i.k6)((()=>[(0,i.eW)((0,b.v_)(l.region.region_code),1)])),_:1})]),(0,i.Lk)("span",Me,[(0,i.eW)(" Localidade: "),(0,i.Lk)("b",null,(0,b.v_)(l.region.localidade),1)]),(0,i.Lk)("span",$e,[(0,i.eW)(" Cultura: "),(0,i.Lk)("b",null,(0,b.v_)(l.region.crop?.crop_name||"Sem cultura"),1)]),(0,i.Lk)("div",null,[(0,i.Lk)("span",Xe,[l.region.closest_datasource?((0,i.uX)(),(0,i.CE)("div",Ie,[(0,i.Lk)("a",{class:"text-secondary text-decoration-none cursor-pointer",onClick:o[0]||(o[0]=(...o)=>e.$refs.RegionMap.flyToStation&&e.$refs.RegionMap.flyToStation(...o))},(0,b.v_)(l.region.closest_datasource?.datasource_name),1),(0,i.bF)(d,{station_id:l.region.closest_datasource.datasource_id},null,8,["station_id"])])):((0,i.uX)(),(0,i.CE)("span",ze,je))])])])])),_:1}),(0,i.bF)(c.B,{cols:"6"},{default:(0,i.k6)((()=>[(0,i.bF)(u.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(c.B,{cols:"12"},{default:(0,i.k6)((()=>[(0,i.Lk)("div",null,[(0,i.bF)(n,{ref:"RegionMap",region:l.region,zoom:15,height:"300px"},null,8,["region"])])])),_:1})])),_:1})])),_:1})])),_:1}))])),_:1})}var Ne=t(6593),Qe=t(3245),Ge={name:"PeriodRegionDetail",components:{RegionMap:Ne.A,StationData:Qe.A},props:{regionId:{type:Number,required:!0}},setup(){const e=(0,L.E)(),o=(0,S.T)();return{accountStore:e,generalStore:o}},data(){return{region:null,isLoading:!1}},methods:{async getRegion(){this.isLoading=!0,await w.A.request({url:"api/regions/"+this.regionId,method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.region=e.data,console.log(this.region),this.isLoading=!1})).catch((e=>{console.log(e)}))},reset(){this.region=null,this.isLoading=!1}},mounted(){this.getRegion()},unmounted(){this.reset()}};const He=(0,W.A)(Ge,[["render",Je]]);var Ke=He,Ye={name:"PeriodRegions",components:{PeriodRegionDetail:Ke},props:{period:{type:Object,required:!0}},setup(){const e=(0,L.E)(),o=(0,S.T)();return{accountStore:e,generalStore:o}},data(){return{isLoading:!1,regions:[],filter:{region_name:""},limit:5,offset:0,hasMore:!1,regioninperiod:null,deleteDialog:!1,isLoadingDelete:!1}},methods:{async getRegions(){await w.A.request({url:"api/periods/"+this.period.period_id+"/regionsinperiods",headers:{Authorization:`Bearer ${this.accountStore.account.token}`},params:{limit:this.limit,offset:this.offset}}).then((e=>{let o=e.data.regioninperiods.map((e=>({regioninperiod_id:e.regioninperiod_id,region:e.region})));this.regions.push(...o),this.offset+=this.regions.length,this.hasMore=e.data.hasMore,this.isLoading=!1})).catch((e=>{this.isLoading=!1,this.generalStore.errorSnackbar("Erro ao buscar regiões do período")}))},loadMore(e){e&&this.hasMore&&this.getRegions()},refreshRegions(){this.regions=[],this.offset=0,this.getRegions()},openDeleteDialog(e){this.regioninperiod=e,this.deleteDialog=!0},resetDeleteDialog(){this.regioninperiod=null,this.deleteDialog=!1},deleteRegionPeriod(){this.isLoading=!0,w.A.request({url:"api/regionsinperiods/"+this.regioninperiod.regioninperiod_id,method:"DELETE",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((()=>{this.isLoading=!1,this.refreshRegions()})).catch((e=>{this.isLoading=!1,this.generalStore.errorSnackbar("Erro ao remover região do período")}))}},mounted(){this.isLoading=!0,this.getRegions()}};const Ze=(0,W.A)(Ye,[["render",Ee],["__scopeId","data-v-fb42095e"]]);var eo=Ze,oo={name:"PeriodDrawer",components:{PeriodDetail:ye,PeriodRegions:eo},setup(){const e=(0,L.E)(),o=(0,S.T)();return{accountStore:e,generalStore:o}},data(){return{drawer:!1,period:null,isLoading:!1,tab:null}},watch:{drawer(e){e||this.reset()}},methods:{openDrawer(e){this.drawer=!0,this.getPeriodDetail(e)},reset(){this.period=null,this.regions=[],this.tab=null},async getPeriodDetail(e){this.isLoading=!0,await w.A.request({url:"api/periods/"+e,headers:{Authorization:`Bearer ${this.accountStore.account.token}`}}).then((e=>{this.period=e.data,this.period.period_startdate=new Date(this.period.period_startdate),this.period.period_enddate=new Date(this.period.period_enddate),console.log(this.period),this.isLoading=!1})).catch((e=>{this.isLoading=!1,this.generalStore.errorSnackbar("Erro ao buscar detalhes do período"),console.error(e)}))}}};const to=(0,W.A)(oo,[["render",ne]]);var io=to,ao={name:"PeriodsView",components:{AddPeriod:C,PeriodsTable:te,PeriodDrawer:io},setup(){const e=(0,L.E)(),o=(0,S.T)();return{accountStore:e,generalStore:o}},data(){return{isLoadingPeriods:!1,periods:[],filter:{name:null,periodtype_id:null},limit:12,offset:0,hasMore:!1,periodtypes:[],isLoadingTypes:!1}},methods:{async getPeriods(){this.isLoadingPeriods=!0,await w.A.request({url:"api/periods",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token},params:{name:this.filter.name,periodtype_id:this.filter.periodtype_id,limit:this.limit,offset:this.offset}}).then((e=>{this.periods.push(...e.data.periods),this.hasMore=e.data.hasMore,this.offset+=e.data.periods.length,this.isLoadingPeriods=!1})).catch((e=>{console.error(e),this.generalStore.errorSnackbar("Erro ao buscar os períodos."),this.isLoadingPeriods=!1}))},refreshPeriods(){this.periods=[],this.offset=0,this.getPeriods()},showInfo(e){this.$refs.PeriodDrawer.openDrawer(e)},async getPeriodTypes(){this.isLoadingTypes=!0,await w.A.request({url:"api/periodtypes",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.periodtypes=e.data,this.isLoadingTypes=!1})).catch((e=>{console.error(e),this.generalStore.errorSnackbar("Erro ao buscar tipos de período"),this.isLoadingTypes=!1}))}},mounted(){this.getPeriods(),this.getPeriodTypes()}};const lo=(0,W.A)(ao,[["render",g]]);var ro=lo},1321:function(e,o,t){t.d(o,{i:function(){return u}});var i=t(6768),a=t(9262),l=t(5296),r=t(4587),d=t(1247),n=t(4600);const s=(0,r.j)({locale:String,fallbackLocale:String,messages:Object,rtl:{type:Boolean,default:void 0},...(0,a.u)()},"VLocaleProvider"),u=(0,d.RW)()({name:"VLocaleProvider",props:s(),setup(e,o){let{slots:t}=o;const{rtlClasses:a}=(0,l.Q1)(e);return(0,n.C)((()=>(0,i.bF)("div",{class:["v-locale-provider",a.value,e.class],style:e.style},[t.default?.()]))),{}}})},6686:function(e,o,t){t.d(o,{U:function(){return b}});var i=t(6768),a=t(2807),l=t(2886),r=t(1950),d=t(144),n=t(3301),s=t(4587),u=t(9094),c=t(1247),p=t(2419),m=t(1884),h=t(4600);const g=(0,s.j)({fixed:Boolean,sliderColor:String,hideSlider:Boolean,direction:{type:String,default:"horizontal"},...(0,u.cJ)((0,a.x)({selectedClass:"v-tab--selected",variant:"text"}),["active","block","flat","location","position","symbol"])},"VTab"),b=(0,c.RW)()({name:"VTab",props:g(),setup(e,o){let{slots:t,attrs:s}=o;const{textColorClasses:u,textColorStyles:c}=(0,l.aH)(e,"sliderColor"),g=(0,d.KR)(),b=(0,d.KR)(),f=(0,i.EW)((()=>"horizontal"===e.direction)),k=(0,i.EW)((()=>g.value?.group?.isSelected.value??!1));function _(e){let{value:o}=e;if(o){const e=g.value?.$el.parentElement?.querySelector(".v-tab--selected .v-tab__slider"),o=b.value;if(!e||!o)return;const t=getComputedStyle(e).color,i=e.getBoundingClientRect(),a=o.getBoundingClientRect(),l=f.value?"x":"y",r=f.value?"X":"Y",d=f.value?"right":"bottom",n=f.value?"width":"height",s=i[l],u=a[l],c=s>u?i[d]-a[d]:i[l]-a[l],h=Math.sign(c)>0?f.value?"right":"bottom":Math.sign(c)<0?f.value?"left":"top":"center",k=Math.abs(c)+(Math.sign(c)<0?i[n]:a[n]),_=k/Math.max(i[n],a[n])||0,v=i[n]/a[n]||0,y=1.5;(0,p.i)(o,{backgroundColor:[t,"currentcolor"],transform:[`translate${r}(${c}px) scale${r}(${v})`,`translate${r}(${c/y}px) scale${r}(${(_-1)/y+1})`,"none"],transformOrigin:Array(3).fill(h)},{duration:225,easing:m.B2})}}return(0,h.C)((()=>{const o=a.D.filterProps(e);return(0,i.bF)(a.D,(0,i.v6)({symbol:n.D,ref:g,class:["v-tab",e.class],style:e.style,tabindex:k.value?0:-1,role:"tab","aria-selected":String(k.value),active:!1},o,s,{block:e.fixed,maxWidth:e.fixed?300:void 0,"onGroup:selected":_}),{...t,default:()=>(0,i.bF)(i.FK,null,[t.default?.()??e.text,!e.hideSlider&&(0,i.bF)("div",{ref:b,class:["v-tab__slider",u.value],style:c.value},null)])})})),(0,r.O)({},g)}})},381:function(e,o,t){t.d(o,{h:function(){return F}});var i=t(6768),a=t(6686),l=t(7604),r=t(4441),d=t(4062),n=t(2886),s=t(2858),u=t(2191),c=t(2067),p=t(2876),m=t(4663),h=t(144),g=t(9094),b=t(4587),f=t(1247),k=t(4600),_=t(3301);function v(e){return e?e.map((e=>(0,g.Gv)(e)?e:{text:e,value:e})):[]}const y=(0,b.j)({alignTabs:{type:String,default:"start"},color:String,fixedTabs:Boolean,items:{type:Array,default:()=>[]},stacked:Boolean,bgColor:String,grow:Boolean,height:{type:[Number,String],default:void 0},hideSlider:Boolean,sliderColor:String,...(0,d.l9)({mandatory:"force",selectedClass:"v-tab-item--selected"}),...(0,u.r)(),...(0,m.X)()},"VTabs"),F=(0,f.RW)()({name:"VTabs",props:y(),emits:{"update:modelValue":e=>!0},setup(e,o){let{attrs:t,slots:m}=o;const b=(0,c.q)(e,"modelValue"),f=(0,i.EW)((()=>v(e.items))),{densityClasses:y}=(0,u.Q)(e),{backgroundColorClasses:F,backgroundColorStyles:D}=(0,n.z6)((0,h.lW)(e,"bgColor")),{scopeId:P}=(0,p.b)();return(0,s.Uh)({VTab:{color:(0,h.lW)(e,"color"),direction:(0,h.lW)(e,"direction"),stacked:(0,h.lW)(e,"stacked"),fixed:(0,h.lW)(e,"fixedTabs"),sliderColor:(0,h.lW)(e,"sliderColor"),hideSlider:(0,h.lW)(e,"hideSlider")}}),(0,k.C)((()=>{const o=d.fJ.filterProps(e),n=!!(m.window||e.items.length>0);return(0,i.bF)(i.FK,null,[(0,i.bF)(d.fJ,(0,i.v6)(o,{modelValue:b.value,"onUpdate:modelValue":e=>b.value=e,class:["v-tabs",`v-tabs--${e.direction}`,`v-tabs--align-tabs-${e.alignTabs}`,{"v-tabs--fixed-tabs":e.fixedTabs,"v-tabs--grow":e.grow,"v-tabs--stacked":e.stacked},y.value,F.value,e.class],style:[{"--v-tabs-height":(0,g.Dg)(e.height)},D.value,e.style],role:"tablist",symbol:_.D},P,t),{default:()=>[m.default?.()??f.value.map((e=>m.tab?.({item:e})??(0,i.bF)(a.U,(0,i.v6)(e,{key:e.text,value:e.value}),{default:m[`tab.${e.value}`]?()=>m[`tab.${e.value}`]?.({item:e}):void 0})))]}),n&&(0,i.bF)(l.l,(0,i.v6)({modelValue:b.value,"onUpdate:modelValue":e=>b.value=e,key:"tabs-window"},P),{default:()=>[f.value.map((e=>m.item?.({item:e})??(0,i.bF)(r.Y,{value:e.value},{default:()=>m[`item.${e.value}`]?.({item:e})}))),m.window?.()]})])})),{}}})},7604:function(e,o,t){t.d(o,{l:function(){return p}});var i=t(6768),a=t(6048),l=t(2067),r=t(4587),d=t(9094),n=t(1247),s=t(4600),u=t(3301);const c=(0,r.j)({...(0,d.cJ)((0,a.ZJ)(),["continuous","nextIcon","prevIcon","showArrows","touch","mandatory"])},"VTabsWindow"),p=(0,n.RW)()({name:"VTabsWindow",props:c(),emits:{"update:modelValue":e=>!0},setup(e,o){let{slots:t}=o;const r=(0,i.WQ)(u.D,null),d=(0,l.q)(e,"modelValue"),n=(0,i.EW)({get(){return null==d.value&&r?r.items.value.find((e=>r.selected.value.includes(e.id)))?.value:d.value},set(e){d.value=e}});return(0,s.C)((()=>{const o=a.r3.filterProps(e);return(0,i.bF)(a.r3,(0,i.v6)({_as:"VTabsWindow"},o,{modelValue:n.value,"onUpdate:modelValue":e=>n.value=e,class:["v-tabs-window",e.class],style:e.style,mandatory:!1,touch:!1}),t)})),{}}})},4441:function(e,o,t){t.d(o,{Y:function(){return s}});var i=t(6768),a=t(1781),l=t(4587),r=t(1247),d=t(4600);const n=(0,l.j)({...(0,a.w)()},"VTabsWindowItem"),s=(0,r.RW)()({name:"VTabsWindowItem",props:n(),setup(e,o){let{slots:t}=o;return(0,d.C)((()=>{const o=a.m.filterProps(e);return(0,i.bF)(a.m,(0,i.v6)({_as:"VTabsWindowItem"},o,{class:["v-tabs-window-item",e.class],style:e.style}),t)})),{}}})},3301:function(e,o,t){t.d(o,{D:function(){return i}});const i=Symbol.for("vuetify:v-tabs")}}]);
//# sourceMappingURL=periods.823f2a5e.js.map