"use strict";(self["webpackChunkfitoagro_backoffice"]=self["webpackChunkfitoagro_backoffice"]||[]).push([[438],{7395:function(e,t,i){i.r(t),i.d(t,{default:function(){return q}});var a=i(6768),l=i(2239),o=i(2807),s=i(4593),r=i(1606),n=i(697),d=i(7511),u=i(3813),c=i(6756),h=i(5526),m=i(9669),g=i(2164),f=i(7254),p=i(1321),_=i(8249),b=i(8738),v=i(594),k=i(3948),F=i(1161),V=i(9629);const y=e=>((0,a.Qi)("data-v-51e6a8f7"),e=e(),(0,a.jt)(),e),L=y((()=>(0,a.Lk)("span",null,"Períodos Datas",-1)));function P(e,t,i,y,P,M){const S=(0,a.g2)("v-date-input"),A=(0,a.g2)("VisitsTable");return(0,a.uX)(),(0,a.Wv)(u.I,null,{default:(0,a.k6)((()=>[(0,a.bF)(c.L,null,{default:(0,a.k6)((()=>[(0,a.bF)(h.B,null,{default:(0,a.k6)((()=>[(0,a.bF)(s.J,{elevation:"8"},{default:(0,a.k6)((()=>[(0,a.bF)(r.r,null,{default:(0,a.k6)((()=>[(0,a.eW)("Filtro")])),_:1}),(0,a.bF)(n.O,null,{default:(0,a.k6)((()=>[(0,a.bF)(c.L,null,{default:(0,a.k6)((()=>[(0,a.bF)(h.B,null,{default:(0,a.k6)((()=>[(0,a.bF)(c.L,null,{default:(0,a.k6)((()=>[(0,a.bF)(h.B,{cols:"2"},{default:(0,a.k6)((()=>[(0,a.bF)(l.V,{modelValue:P.filter.region_code,"onUpdate:modelValue":t[0]||(t[0]=e=>P.filter.region_code=e),items:M.selectRegionItems,label:"Parcela","item-title":"title","item-value":"value",color:"primary",density:"comfortable",variant:"underlined",loading:P.isLoadingRegs,clearable:""},(0,a.eX)({_:2},[P.reg_hasMore?{name:"append-item",fn:(0,a.k6)((()=>[(0,a.bo)(((0,a.uX)(),(0,a.CE)("div",null,[(0,a.bF)(b.V8,{type:"list-item"})])),[[V.o,M.loadMoreRegions,void 0,{quiet:!0}]])])),key:"0"}:void 0]),1032,["modelValue","items","loading"])])),_:1}),(0,a.bF)(h.B,{cols:"3",class:"d-flex align-center mb-5"},{default:(0,a.k6)((()=>[(0,a.bF)(p.i,{locale:"pt"},{default:(0,a.k6)((()=>[(0,a.bF)(S,{modelValue:P.filter.dates,"onUpdate:modelValue":t[1]||(t[1]=e=>P.filter.dates=e),label:"Datas","max-width":"368","prepend-icon":"","prepend-inner-icon":"mdi-calendar",multiple:"range",density:"comfortable",variant:"underlined",color:"primary",clearable:"","onClick:clear":t[2]||(t[2]=e=>P.filter.dates=[])},null,8,["modelValue"])])),_:1}),(0,a.bF)(_.q,{"close-on-content-click":!1},{activator:(0,a.k6)((({props:e})=>[(0,a.bF)(o.D,(0,a.v6)({loading:P.isLoadingPeriods,icon:"",variant:"plain"},e),{default:(0,a.k6)((()=>[(0,a.bF)(m.w,null,{default:(0,a.k6)((()=>[(0,a.eW)("mdi-view-list")])),_:1}),(0,a.bF)(F.y,{activator:"parent",location:"top"},{default:(0,a.k6)((()=>[L])),_:1})])),_:2},1040,["loading"])])),default:(0,a.k6)((()=>[(0,a.bF)(s.J,{"min-width":"250","max-height":"300"},{default:(0,a.k6)((()=>[(0,a.bF)(r.r,null,{default:(0,a.k6)((()=>[(0,a.bF)(k.W,{density:"compact",modelValue:P.filter_periods.period_name,"onUpdate:modelValue":t[3]||(t[3]=e=>P.filter_periods.period_name=e),label:"Pesquisa o nome",color:"primary","append-icon":"mdi-magnify",variant:"underlined","hide-details":"",clearable:"","onClick:append":t[4]||(t[4]=e=>M.searchPeriods())},null,8,["modelValue"])])),_:1}),(0,a.bF)(g.x8,{class:"scrollable-menu"},{default:(0,a.k6)((()=>[(0,a.bF)(d.G),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(P.periods,(e=>((0,a.uX)(),(0,a.Wv)(f.g,{key:e.period_id,title:e.period_name,subtitle:`${M.formatDate(e.period_startdate)} - ${M.formatDate(e.period_enddate)}`,onClick:t=>M.updateDates(e)},null,8,["title","subtitle","onClick"])))),128)),P.periods_hasMore?((0,a.uX)(),(0,a.Wv)(f.g,{key:0},{default:(0,a.k6)((()=>[(0,a.bo)(((0,a.uX)(),(0,a.CE)("div",null,[(0,a.bF)(b.V8,{type:"list-item"})])),[[V.o,M.loadMorePeriods,void 0,{quiet:!0}]])])),_:1})):(0,a.Q3)("",!0)])),_:1})])),_:1})])),_:1})])),_:1}),y.accountStore.hasRole(["Administrador"])?((0,a.uX)(),(0,a.Wv)(h.B,{key:0,cols:"3"},{default:(0,a.k6)((()=>[(0,a.bF)(l.V,{modelValue:P.filter.agent_name,"onUpdate:modelValue":t[5]||(t[5]=e=>P.filter.agent_name=e),items:M.selectAgentItems,label:"Agente de Campo","item-title":e=>`${e.title} - ${e.subtitle}`,"item-value":"value",color:"primary",variant:"underlined",density:"comfortable",loading:P.isLoadingAgents,clearable:""},(0,a.eX)({item:(0,a.k6)((({props:e,item:t})=>[(0,a.bF)(f.g,(0,a.v6)(e,{title:t.raw.title,subtitle:t.raw.subtitle}),null,16,["title","subtitle"])])),_:2},[P.ag_hasMore?{name:"append-item",fn:(0,a.k6)((()=>[(0,a.bo)(((0,a.uX)(),(0,a.CE)("div",null,[(0,a.bF)(b.V8,{type:"list-item"})])),[[V.o,M.loadMoreAgents,void 0,{quiet:!0}]])])),key:"0"}:void 0]),1032,["modelValue","items","item-title","loading"])])),_:1})):(0,a.Q3)("",!0),(0,a.bF)(h.B,{cols:"2"},{default:(0,a.k6)((()=>[(0,a.bF)(k.W,{modelValue:P.filter.nea,"onUpdate:modelValue":t[6]||(t[6]=e=>P.filter.nea=e),modelModifiers:{trim:!0},label:"NEA",type:"number",prefix:"%",color:"primary",variant:"underlined",density:"comfortable",rules:[P.rules.percentage],clearable:""},null,8,["modelValue","rules"])])),_:1}),(0,a.bF)(h.B,{cols:"2"},{default:(0,a.k6)((()=>[(0,a.bF)(l.V,{modelValue:P.filter.ef,"onUpdate:modelValue":t[7]||(t[7]=e=>P.filter.ef=e),loading:P.isLoadingStages,items:P.stages,"no-data-text":"Sem resultados","item-title":"phenologicalstage_code","item-value":"phenologicalstage_code",label:"EF",color:"primary",variant:"underlined",density:"comfortable",clearable:""},{item:(0,a.k6)((({props:e,item:t})=>[(0,a.bF)(f.g,(0,a.v6)(e,{title:t.raw.phenologicalstage_code,subtitle:t.raw.phenologicalstage_name}),null,16,["title","subtitle"])])),_:1},8,["modelValue","loading","items"])])),_:1}),(0,a.bF)(h.B,{sm:"3",md:"3",lg:"3",xl:"2"},{default:(0,a.k6)((()=>[(0,a.bF)(v.N,{label:"Visita",modelValue:P.filter.visited,"onUpdate:modelValue":t[8]||(t[8]=e=>P.filter.visited=e),indeterminate:null===P.filter.visited,color:"info","prepend-icon":"mdi-close-circle","onClick:prepend":t[9]||(t[9]=e=>P.filter.visited=null)},null,8,["modelValue","indeterminate"])])),_:1}),(0,a.bF)(h.B,{sm:"3",md:"3",lg:"3",xl:"2"},{default:(0,a.k6)((()=>[(0,a.bF)(v.N,{label:"GPS",modelValue:P.filter.gps,"onUpdate:modelValue":t[10]||(t[10]=e=>P.filter.gps=e),indeterminate:null===P.filter.gps,color:"info","prepend-icon":"mdi-close-circle","onClick:prepend":t[11]||(t[11]=e=>P.filter.gps=null)},null,8,["modelValue","indeterminate"])])),_:1}),(0,a.bF)(h.B,{sm:"3",md:"3",lg:"3",xl:"2"},{default:(0,a.k6)((()=>[(0,a.bF)(v.N,{label:"Fotos",modelValue:P.filter.hasPhotos,"onUpdate:modelValue":t[12]||(t[12]=e=>P.filter.hasPhotos=e),indeterminate:null===P.filter.hasPhotos,color:"info","prepend-icon":"mdi-close-circle","onClick:prepend":t[13]||(t[13]=e=>P.filter.hasPhotos=null)},null,8,["modelValue","indeterminate"]),P.filter.hasPhotos?((0,a.uX)(),(0,a.Wv)(k.W,{key:0,modelValue:P.filter.numPhotos,"onUpdate:modelValue":t[14]||(t[14]=e=>P.filter.numPhotos=e),modelModifiers:{trim:!0},label:"Nº Fotos",type:"number",color:"primary",variant:"underlined",density:"compact",rules:[P.rules.gtZero],clearable:""},null,8,["modelValue","rules"])):(0,a.Q3)("",!0)])),_:1}),(0,a.bF)(h.B,{sm:"3",md:"3",lg:"3",xl:"2"},{default:(0,a.k6)((()=>[(0,a.bF)(v.N,{label:"Chuva",modelValue:P.filter.rain,"onUpdate:modelValue":t[15]||(t[15]=e=>P.filter.rain=e),indeterminate:null===P.filter.rain,color:"info","prepend-icon":"mdi-close-circle","onClick:prepend":t[16]||(t[16]=e=>P.filter.rain=null)},null,8,["modelValue","indeterminate"])])),_:1}),(0,a.bF)(h.B,{sm:"3",md:"3",lg:"3",xl:"2"},{default:(0,a.k6)((()=>[(0,a.bF)(v.N,{label:"Tratamento",modelValue:P.filter.treatment,"onUpdate:modelValue":t[17]||(t[17]=e=>P.filter.treatment=e),indeterminate:null===P.filter.treatment,color:"info","prepend-icon":"mdi-close-circle","onClick:prepend":t[18]||(t[18]=e=>P.filter.treatment=null)},null,8,["modelValue","indeterminate"])])),_:1})])),_:1})])),_:1}),(0,a.bF)(h.B,{cols:"2"},{default:(0,a.k6)((()=>[(0,a.bF)(o.D,{color:"secondary",icon:"",variant:"text",disabled:P.isLoading,onClick:t[19]||(t[19]=e=>M.searchVisits())},{default:(0,a.k6)((()=>[(0,a.bF)(m.w,{size:"x-large"},{default:(0,a.k6)((()=>[(0,a.eW)("mdi-magnify")])),_:1})])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),(0,a.bF)(c.L,null,{default:(0,a.k6)((()=>[(0,a.bF)(h.B,null,{default:(0,a.k6)((()=>[(0,a.bF)(A,{visits:P.visits,isLoading:P.isLoading,hasMore:P.vis_hasMore,onLoadMore:t[20]||(t[20]=e=>M.listVisits())},null,8,["visits","isLoading","hasMore"])])),_:1})])),_:1})])),_:1})}i(4114);var M=i(9336);const S=e=>((0,a.Qi)("data-v-46c4ecfc"),e=e(),(0,a.jt)(),e),A=S((()=>(0,a.Lk)("h2",{class:"text-h5"},"Nenhuma observação encontrada",-1)));function B(e,t,i,l,o,d){const u=(0,a.g2)("VisitCard"),g=(0,a.g2)("VisitDetail");return(0,a.uX)(),(0,a.Wv)(s.J,{class:"pa-5",elevation:"8",rounded:"",height:d.sheetHeight},{default:(0,a.k6)((()=>[(0,a.bF)(r.r,null,{default:(0,a.k6)((()=>[i.isLoading?((0,a.uX)(),(0,a.Wv)(M.Z,{key:0,color:"primary",indeterminate:""})):(0,a.Q3)("",!0)])),_:1}),(0,a.bF)(n.O,{class:"scrollable"},{default:(0,a.k6)((()=>[(0,a.bF)(c.L,{class:"fill-width"},{default:(0,a.k6)((()=>[0!=i.visits.length||i.isLoading?((0,a.uX)(!0),(0,a.CE)(a.FK,{key:1},(0,a.pI)(i.visits,(e=>((0,a.uX)(),(0,a.Wv)(h.B,{key:e.fileId,sm:"6",md:"6",lg:"4",xl:"3"},{default:(0,a.k6)((()=>[(0,a.bF)(u,{visit:e,onDetail:t[0]||(t[0]=e=>d.openDetail(e))},null,8,["visit"])])),_:2},1024)))),128)):((0,a.uX)(),(0,a.Wv)(h.B,{key:0},{default:(0,a.k6)((()=>[(0,a.bF)(s.J,{class:"fill-width",elevation:"0"},{default:(0,a.k6)((()=>[(0,a.bF)(n.O,{class:"text-center"},{default:(0,a.k6)((()=>[(0,a.bF)(m.w,{size:"100"},{default:(0,a.k6)((()=>[(0,a.eW)("mdi-file-search")])),_:1}),A])),_:1})])),_:1})])),_:1})),i.hasMore&&!i.isLoading?((0,a.uX)(),(0,a.Wv)(h.B,{key:2,cols:"3"},{default:(0,a.k6)((()=>[(0,a.bo)((0,a.bF)(b.V8,{type:"card"},null,512),[[V.o,{handler:d.loadMore,options:{threshold:.5}},void 0,{quiet:!0}]])])),_:1})):(0,a.Q3)("",!0)])),_:1})])),_:1}),(0,a.bF)(g,{visit:o.visit_selected,dialog:o.detailDialog,"onUpdate:dialog":t[1]||(t[1]=e=>o.detailDialog=e)},null,8,["visit","dialog"])])),_:1},8,["height"])}var w=i(9473),D=i(94),C=i(501),E=i(6044),W={name:"VisitsTable",components:{VisitCard:w.A,VisitDetail:D.A},props:{visits:Array,isLoading:Boolean,hasMore:Boolean},setup(){const e=(0,C.T)(),t=(0,E.E)();return{generalStore:e,accountStore:t}},data(){return{detailDialog:!1,visit_selected:null}},watch:{},computed:{sheetHeight(){return.6*window.innerHeight}},methods:{openDetail(e){this.visit_selected=JSON.parse(JSON.stringify(e)),this.detailDialog=!0},loadMore(e){e&&this.$emit("loadMore")}}},X=i(1241);const x=(0,X.A)(W,[["render",B],["__scopeId","data-v-46c4ecfc"]]);var R=x,U=i(8355),T={name:"VisitsView",components:{VisitsTable:R},setup(){const e=(0,E.E)(),t=(0,C.T)();return{accountStore:e,generalStore:t}},data(){return{isLoading:!1,observations:[],filter:{region_code:null,dates:[],agent_name:null,fileId:null,nea:null,ef:null,visited:null,gps:null,hasPhotos:null,numPhotos:null,rain:null,treatment:null},visits:[],vis_offset:0,vis_limit:16,vis_hasMore:!1,regions:[],isLoadingRegs:!1,reg_offset:0,reg_limit:10,reg_hasMore:!1,agents:[],isLoadingAgents:!1,ag_offset:0,ag_limit:10,ag_hasMore:!1,stages:[],isLoadingStages:!1,periods:[],isLoadingPeriods:!1,filter_periods:{period_name:null},periods_offset:0,periods_limit:5,periods_hasMore:!1,rules:{percentage:e=>null===e||""===e||(e>=0&&e<=100||"Valor inválido"),gtZero:e=>null===e||""===e||(e>0||"Valor inválido")}}},computed:{dateRange(){return this.filter.dates.length>0?this.filter.dates[0]+" - "+this.filter.dates[this.filter.dates.length-1]:null},selectRegionItems(){return this.regions.map((e=>({title:`${e.region_code} - ${e.region_name}`,value:e.region_code})))},selectAgentItems(){return this.agents.map((e=>({title:`${e.name}`,subtitle:`${e.username}`,value:e.name})))}},methods:{async listVisits(){this.isLoading=!0,U.A.request({url:"api/visits",method:"GET",headers:{Authorization:`Bearer ${this.accountStore.account.token}`},params:{offset:this.vis_offset,limit:this.vis_limit,region_code:this.filter.region_code,date_range:this.dateRange,agent_name:this.filter.agent_name,nea:this.filter.nea,ef:this.filter.ef,visited:this.filter.visited,gps:this.filter.gps,hasPhotos:this.filter.hasPhotos,numPhotos:this.filter.numPhotos,rain:this.filter.rain,treatment:this.filter.treatment}}).then((e=>{this.visits.push(...e.data.visits),this.vis_offset+=e.data.visits.length,this.vis_hasMore=e.data.hasMore})).catch((e=>{console.error(e),this.generalStore.errorSnackbar("Erro ao carregar visitas")})).finally((()=>{this.isLoading=!1}))},searchVisits(){this.vis_offset=0,this.visits=[],this.listVisits()},async listRegions(){this.isLoadingRegs=!0,await U.A.request({url:"api/regions",method:"GET",headers:{Authorization:`Bearer ${this.accountStore.account.token}`},params:{offset:this.reg_offset,limit:this.reg_limit}}).then((e=>{this.regions.push(...e.data.regions),this.reg_offset+=e.data.regions.length,this.reg_hasMore=e.data.hasMore})).catch((e=>{console.error(e),this.generalStore.errorSnackbar("Erro ao carregar regiões")})).finally((()=>{this.isLoadingRegs=!1}))},loadMoreRegions(e){e&&this.listRegions()},async listAgents(){this.isLoadingAgents=!0,await U.A.request({url:"api/agents",method:"GET",headers:{Authorization:`Bearer ${this.accountStore.account.token}`},params:{offset:this.ag_offset,limit:this.ag_limit,type:1}}).then((e=>{this.agents.push(...e.data.agents),this.ag_offset+=e.data.agents.length,this.ag_hasMore=e.data.hasMore})).catch((e=>{console.error(e),this.generalStore.errorSnackbar("Erro ao carregar agentes")})).finally((()=>{this.isLoadingAgents=!1}))},loadMoreAgents(e){e&&this.listAgents()},listPhenologicalStages(){this.isLoadingStages=!0,U.A.request({url:"api/phenologicalstages",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.stages=e.data,this.isLoadingStages=!1})).catch((e=>{console.error(e),this.generalStore.errorSnackbar("Erro ao carregar estágios fenológicos")}))},listPeriods(){this.isLoadingPeriods=!0,U.A.request({url:"api/periods",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token},params:{limit:this.periods_limit,offset:this.periods_offset,name:this.filter_periods.period_name}}).then((e=>{this.periods.push(...e.data.periods),this.periods_offset+=e.data.periods.length,this.periods_hasMore=e.data.hasMore,this.isLoadingPeriods=!1})).catch((e=>{console.error(e),this.isLoadingPeriods=!1,this.generalStore.errorSnackbar("Erro ao carregar períodos")}))},loadMorePeriods(e){e&&this.listPeriods()},searchPeriods(){this.periods=[],this.periods_offset=0,this.listPeriods()},formatDate(e){return new Date(e).toLocaleDateString("pt-PT")},updateDates(e){const t=new Date(e.period_startdate),i=new Date(e.period_enddate);this.filter.dates=[t,i]}},mounted(){this.listVisits(),this.listRegions(),this.listPeriods(),this.listPhenologicalStages(),this.accountStore.hasRole(["Administrador"])&&this.listAgents()}};const $=(0,X.A)(T,[["render",P],["__scopeId","data-v-51e6a8f7"]]);var q=$}}]);
//# sourceMappingURL=observations.d5017d73.js.map