"use strict";(self["webpackChunkfitoagro_backoffice"]=self["webpackChunkfitoagro_backoffice"]||[]).push([[809],{2299:function(e,t,a){a.r(t),a.d(t,{default:function(){return ae}});var o=a(6768),i=a(2239),l=a(2807),n=a(4593),r=a(1606),s=a(697),d=a(3813),u=a(6756),c=a(5526),m=a(9669),g=a(105),b=a(3948);function h(e,t,a,h,p,f){const k=(0,o.g2)("AddMember"),v=(0,o.g2)("AgentsTable");return(0,o.uX)(),(0,o.Wv)(d.I,{fluid:"",class:"fill-width"},{default:(0,o.k6)((()=>[(0,o.bF)(u.L,null,{default:(0,o.k6)((()=>[(0,o.bF)(c.B,{cols:"12"},{default:(0,o.k6)((()=>[(0,o.bF)(n.J,{elevation:"8"},{default:(0,o.k6)((()=>[(0,o.bF)(r.r,null,{default:(0,o.k6)((()=>[(0,o.eW)("Filtro")])),_:1}),(0,o.bF)(s.O,null,{default:(0,o.k6)((()=>[(0,o.bF)(u.L,null,{default:(0,o.k6)((()=>[h.accountStore.hasRole(["Administrador"])?((0,o.uX)(),(0,o.Wv)(c.B,{key:0},{default:(0,o.k6)((()=>[(0,o.bF)(i.V,{clearable:"",density:"comfortable",variant:"underlined",color:"primary",label:"Organização",disabled:p.isLoadingTable||p.isLoadingOrgs,items:p.organizations,"item-title":"organization_name","item-value":"organization_id",modelValue:p.filter.organization_id,"onUpdate:modelValue":t[0]||(t[0]=e=>p.filter.organization_id=e)},null,8,["disabled","items","modelValue"])])),_:1})):(0,o.Q3)("",!0),h.accountStore.hasRole(["Administrador"])?((0,o.uX)(),(0,o.Wv)(c.B,{key:1},{default:(0,o.k6)((()=>[(0,o.bF)(g.d4,{clearable:"",density:"comfortable",variant:"underlined",color:"primary",label:"Tipo de Conta",disabled:p.isLoadingTable||p.isLoadingAgentTypes,items:p.agentTypes,"item-title":"agenttype_name","item-value":"agenttype_id",modelValue:p.filter.type,"onUpdate:modelValue":t[1]||(t[1]=e=>p.filter.type=e)},null,8,["disabled","items","modelValue"])])),_:1})):(0,o.Q3)("",!0),h.accountStore.hasRole(["Organização"])?((0,o.uX)(),(0,o.Wv)(c.B,{key:2},{default:(0,o.k6)((()=>[(0,o.bF)(g.d4,{clearable:"",density:"comfortable",variant:"underlined",color:"primary",label:"Tipo de Membro",disabled:p.isLoadingTable||p.isLoadingMemberTypes,items:p.memberTypes,"item-title":"membertype_name","item-value":"membertype_id",modelValue:p.filter.type,"onUpdate:modelValue":t[2]||(t[2]=e=>p.filter.type=e)},null,8,["disabled","items","modelValue"])])),_:1})):(0,o.Q3)("",!0),(0,o.bF)(c.B,null,{default:(0,o.k6)((()=>[(0,o.bF)(b.W,{clearable:"",density:"comfortable",variant:"underlined",color:"primary",label:"Conta",disabled:p.isLoadingTable,modelValue:p.filter.username,"onUpdate:modelValue":t[3]||(t[3]=e=>p.filter.username=e)},null,8,["disabled","modelValue"])])),_:1}),(0,o.bF)(c.B,null,{default:(0,o.k6)((()=>[(0,o.bF)(b.W,{clearable:"",density:"comfortable",variant:"underlined",color:"primary",label:"Nome",disabled:p.isLoadingTable,modelValue:p.filter.name,"onUpdate:modelValue":t[4]||(t[4]=e=>p.filter.name=e)},null,8,["disabled","modelValue"])])),_:1}),(0,o.bF)(c.B,null,{default:(0,o.k6)((()=>[(0,o.bF)(b.W,{clearable:"",density:"comfortable",variant:"underlined",color:"primary",label:"Telefone",disabled:p.isLoadingTable,modelValue:p.filter.phone,"onUpdate:modelValue":t[5]||(t[5]=e=>p.filter.phone=e)},null,8,["disabled","modelValue"])])),_:1}),(0,o.bF)(c.B,null,{default:(0,o.k6)((()=>[(0,o.bF)(b.W,{clearable:"",density:"comfortable",variant:"underlined",color:"primary",label:"Email",disabled:p.isLoadingTable,modelValue:p.filter.email,"onUpdate:modelValue":t[6]||(t[6]=e=>p.filter.email=e)},null,8,["disabled","modelValue"])])),_:1}),(0,o.bF)(c.B,null,{default:(0,o.k6)((()=>[(0,o.bF)(l.D,{color:"secondary",icon:"",variant:"text",onClick:t[7]||(t[7]=e=>f.refreshAgents()),disabled:p.isLoadingTable},{default:(0,o.k6)((()=>[(0,o.bF)(m.w,{size:"x-large"},{default:(0,o.k6)((()=>[(0,o.eW)("mdi-magnify")])),_:1})])),_:1},8,["disabled"])])),_:1}),h.accountStore.hasRole(["Organização"])?((0,o.uX)(),(0,o.Wv)(c.B,{key:3},{default:(0,o.k6)((()=>[(0,o.bF)(k,{organization_id:h.accountStore.account.organization,existingMembers:p.agents,onRefresh:t[8]||(t[8]=e=>f.refreshAgents())},null,8,["organization_id","existingMembers"])])),_:1})):(0,o.Q3)("",!0)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),(0,o.bF)(u.L,null,{default:(0,o.k6)((()=>[(0,o.bF)(c.B,null,{default:(0,o.k6)((()=>[(0,o.bF)(v,{agents:p.agents,hasMore:p.hasMore,isLoadingTable:p.isLoadingTable,onLoadMore:t[9]||(t[9]=e=>f.getAgents()),onRefresh:t[10]||(t[10]=e=>f.refreshAgents())},null,8,["agents","hasMore","isLoadingTable"])])),_:1})])),_:1})])),_:1})}a(4114);var p=a(4232),f=a(3745),k=a(5523),v=a(1867),y=a(1772),_=a(1560),F=a(1146),A=a(8738),L=a(1161),V=a(9629);const S={key:0},D={class:"text-center"},z={key:1,class:"d-flex justify-space-evenly nowrap"},T={key:2,class:"d-flex justify-space-evenly nowrap"},w=["colspan"],W=(0,o.Lk)("span",null,"Remover membro",-1),x={class:"mt-4"},C=(0,o.Lk)("span",null,"Remover Utilizador",-1);function M(e,t,a,i,d,u){const c=(0,o.g2)("v-date-input"),g=(0,o.g2)("v-local-provider"),b=(0,o.g2)("AgentDetail");return(0,o.uX)(),(0,o.Wv)(F.i,{class:"pa-2",elevation:"8",rounded:"lg",width:"100%"},{default:(0,o.k6)((()=>[(0,o.bF)(v.g,{"fixed-header":"","no-data-text":"Nenhum utilizador encontrado","loading-text":"A carregar utilizadores...",headers:u.headers,items:u.tableItems,loading:a.isLoadingAgents,height:u.tableHeight},(0,o.eX)({item:(0,o.k6)((e=>[(0,o.Lk)("tr",null,[(0,o.Lk)("td",null,[(0,o.bF)(l.D,{color:"info",variant:"text",icon:"mdi-information-outline",onClick:t=>u.openDetailDialog(e.item,!1)},null,8,["onClick"])]),i.accountStore.hasRole(["Administrador"])?((0,o.uX)(),(0,o.CE)("td",S,[e.item.organization?((0,o.uX)(),(0,o.Wv)(k.x,{key:0,color:"warning"},{default:(0,o.k6)((()=>[(0,o.eW)((0,p.v_)(e.item.organization.organization_name),1)])),_:2},1024)):(0,o.Q3)("",!0)])):(0,o.Q3)("",!0),(0,o.Lk)("td",null,[(0,o.bF)(k.x,{label:"",color:u.roleColor(e.item.type),variant:"flat"},{default:(0,o.k6)((()=>[(0,o.eW)((0,p.v_)(e.item.type),1)])),_:2},1032,["color"])]),(0,o.Lk)("td",null,(0,p.v_)(e.item.username),1),(0,o.Lk)("td",null,(0,p.v_)(e.item.name),1),(0,o.Lk)("td",D,[(0,o.bF)(k.x,{color:e.item.accepted?"success":"error"},{default:(0,o.k6)((()=>[(0,o.eW)((0,p.v_)(e.item.accepted?"Aceite":"Não aceite"),1)])),_:2},1032,["color"]),i.accountStore.hasRole(["Administrador"])?((0,o.uX)(),(0,o.Wv)(k.x,{key:0,color:e.item.blocked?"error":"success"},{default:(0,o.k6)((()=>[(0,o.eW)((0,p.v_)(e.item.blocked?"Bloqueado":"Não bloqueado"),1)])),_:2},1032,["color"])):(0,o.Q3)("",!0),i.accountStore.hasRole(["Administrador"])?((0,o.uX)(),(0,o.Wv)(k.x,{key:1,color:e.item.active?"success":"error"},{default:(0,o.k6)((()=>[(0,o.eW)((0,p.v_)(e.item.active?"Ativo":"Inativo"),1)])),_:2},1032,["color"])):(0,o.Q3)("",!0)]),i.accountStore.hasRole(["Administrador"])?((0,o.uX)(),(0,o.CE)("td",z,[(0,o.bF)(l.D,{color:"warning",variant:"text",icon:"",onClick:t=>u.openDetailDialog(e.item,!0)},{default:(0,o.k6)((()=>[(0,o.bF)(m.w,null,{default:(0,o.k6)((()=>[(0,o.eW)("mdi-pencil")])),_:1}),(0,o.bF)(L.y,{activator:"parent",location:"bottom"},{default:(0,o.k6)((()=>[(0,o.eW)(" Editar ")])),_:1})])),_:2},1032,["onClick"]),(0,o.bF)(l.D,{color:"error",variant:"text",icon:"",onClick:t=>u.openDeleteDialog(e.item)},{default:(0,o.k6)((()=>[(0,o.bF)(m.w,null,{default:(0,o.k6)((()=>[(0,o.eW)("mdi-delete-outline")])),_:1}),(0,o.bF)(L.y,{activator:"parent",location:"bottom"},{default:(0,o.k6)((()=>[(0,o.eW)(" Remover conta ")])),_:1})])),_:2},1032,["onClick"])])):(0,o.Q3)("",!0),i.accountStore.hasRole(["Organização"])?((0,o.uX)(),(0,o.CE)("td",T,[e.item.accepted?((0,o.uX)(),(0,o.Wv)(l.D,{key:0,color:"error",variant:"text",icon:"",loading:e.item.loading,onClick:t=>u.changeStatus(e.item,!1)},{default:(0,o.k6)((()=>[(0,o.bF)(m.w,null,{default:(0,o.k6)((()=>[(0,o.eW)("mdi-account-remove")])),_:1}),(0,o.bF)(L.y,{activator:"parent",location:"bottom"},{default:(0,o.k6)((()=>[(0,o.eW)(" Rejeitar membro ")])),_:1})])),_:2},1032,["loading","onClick"])):((0,o.uX)(),(0,o.Wv)(l.D,{key:1,color:"success",variant:"text",icon:"",loading:e.item.loading,onClick:t=>u.changeStatus(e.item,!0)},{default:(0,o.k6)((()=>[(0,o.bF)(m.w,null,{default:(0,o.k6)((()=>[(0,o.eW)("mdi-account-check")])),_:1}),(0,o.bF)(L.y,{activator:"parent",location:"bottom"},{default:(0,o.k6)((()=>[(0,o.eW)(" Aceitar membro ")])),_:1})])),_:2},1032,["loading","onClick"])),(0,o.bF)(l.D,{color:"error",variant:"text",icon:"",onClick:t=>u.openDeleteDialog(e.item)},{default:(0,o.k6)((()=>[(0,o.bF)(m.w,null,{default:(0,o.k6)((()=>[(0,o.eW)("mdi-logout")])),_:1}),(0,o.bF)(L.y,{activator:"parent",location:"bottom"},{default:(0,o.k6)((()=>[(0,o.eW)(" Remover membro ")])),_:1})])),_:2},1032,["onClick"])])):(0,o.Q3)("",!0)])])),_:2},[a.hasMore&&!a.isLoadingAgents?{name:"body.append",fn:(0,o.k6)((()=>[(0,o.bo)(((0,o.uX)(),(0,o.CE)("tr",null,[(0,o.Lk)("td",{colspan:u.headers.length,class:"text-center"},[(0,o.bF)(A.V8,{type:"table-row"})],8,w)])),[[V.o,{handler:u.loadMore,options:{threshold:.5}},void 0,{quiet:!0}]])])),key:"0"}:void 0]),1032,["headers","items","loading","height"]),i.accountStore.hasRole(["Organização"])?((0,o.uX)(),(0,o.Wv)(y.p,{key:0,modelValue:d.deleteDialog,"onUpdate:modelValue":t[4]||(t[4]=e=>d.deleteDialog=e),onAfterLeave:t[5]||(t[5]=e=>u.reset()),persistent:"",width:"auto"},{default:(0,o.k6)((()=>[(0,o.bF)(n.J,null,{default:(0,o.k6)((()=>[(0,o.bF)(r.r,{class:"bg-error d-flex align-center"},{default:(0,o.k6)((()=>[(0,o.bF)(m.w,{size:"small",class:"mr-2"},{default:(0,o.k6)((()=>[(0,o.eW)(" mdi-logout ")])),_:1}),W])),_:1}),(0,o.bF)(s.O,null,{default:(0,o.k6)((()=>[(0,o.Lk)("span",null,[(0,o.eW)("Tem a certeza que pretende remover o membro "),(0,o.Lk)("b",null,(0,p.v_)(d.agent?.username),1),(0,o.eW)(" da organização?")]),(0,o.bF)(_.n,{modelValue:d.deleteFormValid,"onUpdate:modelValue":t[1]||(t[1]=e=>d.deleteFormValid=e)},{default:(0,o.k6)((()=>[(0,o.Lk)("div",x,[(0,o.bF)(g,{locale:"pt"},{default:(0,o.k6)((()=>[(0,o.bF)(c,{modelValue:d.endDate,"onUpdate:modelValue":t[0]||(t[0]=e=>d.endDate=e),label:" Ultima data de atuação","prepend-icon":"","prepend-inner-icon":"mdi-calendar-end",color:"secondary",density:"compact",variant:"outlined",rules:[e=>!!e||"Campo obrigatório"]},null,8,["modelValue","rules"])])),_:1})])])),_:1},8,["modelValue"])])),_:1}),(0,o.bF)(f.S,{class:"d-flex justify-space-around"},{default:(0,o.k6)((()=>[(0,o.bF)(l.D,{color:"error",variant:"tonal",icon:"mdi-close",onClick:t[2]||(t[2]=e=>d.deleteDialog=!1)}),(0,o.bF)(l.D,{color:"secondary",variant:"tonal",icon:"mdi-check",loading:d.isLoading,onClick:t[3]||(t[3]=e=>u.deleteMember())},null,8,["loading"])])),_:1})])),_:1})])),_:1},8,["modelValue"])):i.accountStore.hasRole(["Administrador"])?((0,o.uX)(),(0,o.Wv)(y.p,{key:1,modelValue:d.deleteDialog,"onUpdate:modelValue":t[8]||(t[8]=e=>d.deleteDialog=e),onAfterLeave:t[9]||(t[9]=e=>u.reset()),persistent:"",width:"auto"},{default:(0,o.k6)((()=>[(0,o.bF)(n.J,null,{default:(0,o.k6)((()=>[(0,o.bF)(r.r,{class:"bg-error d-flex align-center"},{default:(0,o.k6)((()=>[(0,o.bF)(m.w,{size:"small",class:"mr-2"},{default:(0,o.k6)((()=>[(0,o.eW)("mdi-delete-outline")])),_:1}),C])),_:1}),(0,o.bF)(s.O,null,{default:(0,o.k6)((()=>[(0,o.Lk)("span",null,[(0,o.eW)("Tem a certeza que pretende remover o utilizador "),(0,o.Lk)("b",null,(0,p.v_)(d.agent?.username),1),(0,o.eW)("?")])])),_:1}),(0,o.bF)(f.S,{class:"d-flex justify-space-around"},{default:(0,o.k6)((()=>[(0,o.bF)(l.D,{color:"error",variant:"tonal",icon:"mdi-close",onClick:t[6]||(t[6]=e=>d.deleteDialog=!1)}),(0,o.bF)(l.D,{color:"secondary",variant:"tonal",icon:"mdi-check",loading:d.isLoading,onClick:t[7]||(t[7]=e=>u.deleteAgent())},null,8,["loading"])])),_:1})])),_:1})])),_:1},8,["modelValue"])):(0,o.Q3)("",!0),(0,o.bF)(b,{agent:d.agent,editMode:d.editMode,dialog:d.detailDialog,"onUpdate:dialog":t[10]||(t[10]=e=>d.detailDialog=e),onRefresh:t[11]||(t[11]=()=>e.$emit("refresh"))},null,8,["agent","editMode","dialog"])])),_:1})}var B=a(5040),O=a(501),R=a(6044),X=a(8355),U={name:"AgentsTable",components:{AgentDetail:B.A},props:{agents:Array,isLoadingAgents:Boolean,hasMore:Boolean},setup(){const e=(0,O.T)(),t=(0,R.E)();return{generalStore:e,accountStore:t}},data(){return{isLoading:!1,detailDialog:!1,editFormValid:!1,editMode:!1,agent:null,deleteDialog:!1,deleteFormValid:!1,endDate:new Date,isLoadingDelete:!1,isLoadingStatus:!1}},computed:{tableHeight(){return window.innerHeight-270},headers(){switch(this.accountStore.Role()){case"Administrador":return[{title:"",align:"center"},{title:"Organização",key:"organization"},{title:"Tipo",key:"type"},{title:"Conta",key:"username"},{title:"Nome",key:"name"},{title:"Estado",align:"center"},{title:""}];case"Organização":return[{title:"",align:"center"},{title:"Tipo",key:"type"},{title:"Conta",key:"username"},{title:"Nome",key:"name"},{title:"Estado",align:"center"},{title:""}];default:return[]}},me(){return this.accountStore.account},tableItems(){return this.agents.filter((e=>e.id!=this.me?.id))}},methods:{async changeStatus(e,t){e.loading=!0,console.log(e),await X.A.request({url:"api/organizationmembers/"+e.member_id+"/status",method:"patch",headers:{Authorization:"Bearer "+this.accountStore.account.token},data:{status:t}}).then((t=>{e.loading=!1,this.generalStore.successSnackbar("Estado do membro alterado com sucesso"),this.$emit("refresh")})).catch((t=>{e.loading=!1,console.log(t),this.generalStore.errorSnackbar("Erro ao alterar estado do membro")}))},deleteMember(){this.isLoading=!0,console.log(this.agent),X.A.request({url:"api/organizationmembers/"+this.agent.member_id,method:"delete",headers:{Authorization:"Bearer "+this.accountStore.account.token},data:{endDate:this.endDate}}).then((e=>{this.generalStore.successSnackbar("Membro removido com sucesso"),this.$emit("refresh"),this.isLoading=!1,this.deleteDialog=!1})).catch((e=>{console.log(e),this.isLoading=!1,this.generalStore.errorSnackbar("Erro ao remover membro")}))},deleteAgent(){this.isLoading=!0,console.log(this.agent),X.A.request({url:"api/agents/"+this.agent.id,method:"delete",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.generalStore.successSnackbar("Conta removida com sucesso"),this.$emit("refresh"),this.isLoading=!1,this.deleteDialog=!1})).catch((e=>{console.log(e),this.isLoading=!1,this.generalStore.errorSnackbar(e.response.data.error,3e3)}))},showInfo(e){this.$emit("showInfo",e)},loadMore(e){e&&this.$emit("loadMore")},roleColor(e){switch(e){case"Administrador":return"error";case"Organização":return"warning";case"Produtor":return"success";case"Agente de Campo":return"info";default:return"primary"}},openDetailDialog(e,t){this.agent=e,this.editMode=t,this.detailDialog=!0},openDeleteDialog(e){this.agent=e,this.deleteDialog=!0},reset(){this.agent=null,this.isLoading=!1}}},E=a(1241);const q=(0,E.A)(U,[["render",M]]);var Q=q,j=a(1720),N=a(7254),P=a(1321),I=a(6048),$=a(1781);const G={class:"d-flex justify-space-between align-center"},J={class:"mt-4"};function H(e,t,a,d,u,c){const m=(0,o.g2)("v-date-input");return(0,o.uX)(),(0,o.Wv)(y.p,{modelValue:u.dialog,"onUpdate:modelValue":t[9]||(t[9]=e=>u.dialog=e),onAfterLeave:t[10]||(t[10]=e=>c.reset()),width:"auto"},{activator:(0,o.k6)((({props:e})=>[(0,o.bF)(l.D,(0,o.v6)({color:"success","append-icon":"mdi-plus"},e),{default:(0,o.k6)((()=>[(0,o.eW)("Novo Membro")])),_:2},1040)])),default:(0,o.k6)((({})=>[(0,o.bF)(n.J,{class:"mx-auto","min-width":"400"},{default:(0,o.k6)((()=>[(0,o.bF)(r.r,{class:"bg-success"},{default:(0,o.k6)((()=>[(0,o.eW)((0,p.v_)(u.steps[u.step].title),1)])),_:1}),(0,o.bF)(I.r3,{modelValue:u.step,"onUpdate:modelValue":t[5]||(t[5]=e=>u.step=e)},{default:(0,o.k6)((()=>[(0,o.bF)($.m,{value:0},{default:(0,o.k6)((()=>[(0,o.bF)(s.O,null,{default:(0,o.k6)((()=>[(0,o.bF)(_.n,{modelValue:u.steps[0].formValid,"onUpdate:modelValue":t[2]||(t[2]=e=>u.steps[0].formValid=e)},{default:(0,o.k6)((()=>[(0,o.bF)(i.V,{class:"mt-4",modelValue:u.member,"onUpdate:modelValue":t[0]||(t[0]=e=>u.member=e),items:u.agents,"item-title":"username","item-value":"id","prepend-inner-icon":"mdi-account","return-object":"",placeholder:"Insira o nome do utilizador","no-data-text":"Nenhum utilizador encontrado",color:"secondary",density:"compact",variant:"outlined",rules:[e=>!!e||"Campo obrigatório"],loading:u.isLoadingAgents,"onUpdate:search":t[1]||(t[1]=e=>c.listAgents(e))},{item:(0,o.k6)((({props:e,item:t})=>[(0,o.bF)(N.g,(0,p._B)((0,o.Ng)(e)),{subtitle:(0,o.k6)((()=>[(0,o.Lk)("div",G,[(0,o.Lk)("span",null,(0,p.v_)(t.raw.name),1),(0,o.bF)(k.x,{size:"small",color:c.roleColor(t.raw.type),variant:"flat"},{default:(0,o.k6)((()=>[(0,o.eW)((0,p.v_)(t.raw.type),1)])),_:2},1032,["color"])])])),_:2},1040)])),_:1},8,["modelValue","items","rules","loading"])])),_:1},8,["modelValue"])])),_:1})])),_:1}),(0,o.bF)($.m,{value:1},{default:(0,o.k6)((()=>[(0,o.bF)(s.O,null,{default:(0,o.k6)((()=>[(0,o.bF)(_.n,{modelValue:u.steps[1].formValid,"onUpdate:modelValue":t[4]||(t[4]=e=>u.steps[1].formValid=e)},{default:(0,o.k6)((()=>[(0,o.bF)(P.i,{locale:"pt"},{default:(0,o.k6)((()=>[(0,o.Lk)("div",J,[(0,o.bF)(m,{modelValue:u.startDate,"onUpdate:modelValue":t[3]||(t[3]=e=>u.startDate=e),label:"Data de Início","prepend-icon":"","prepend-inner-icon":"mdi-calendar-start",color:"secondary",density:"compact",variant:"outlined",rules:[e=>!!e||"Campo obrigatório"]},null,8,["modelValue","rules"])])])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,o.bF)(f.S,null,{default:(0,o.k6)((()=>[u.step>0?((0,o.uX)(),(0,o.Wv)(l.D,{key:0,"prepend-icon":"mdi-chevron-left",variant:"tonal",onClick:t[6]||(t[6]=e=>u.step--)},{default:(0,o.k6)((()=>[(0,o.eW)(" Anterior ")])),_:1})):(0,o.Q3)("",!0),(0,o.bF)(j.h),u.step<c.lastStep?((0,o.uX)(),(0,o.Wv)(l.D,{key:1,disabled:!u.steps[u.step].formValid,"append-icon":"mdi-chevron-right",color:"secondary",variant:"tonal",onClick:t[7]||(t[7]=e=>u.step++)},{default:(0,o.k6)((()=>[(0,o.eW)(" Próximo ")])),_:1},8,["disabled"])):((0,o.uX)(),(0,o.Wv)(l.D,{key:2,disabled:!u.steps[u.step].formValid,color:"success",variant:"flat",loading:u.isLoadingPost,onClick:t[8]||(t[8]=e=>c.postMember())},{default:(0,o.k6)((()=>[(0,o.eW)(" Adicionar ")])),_:1},8,["disabled","loading"]))])),_:1})])),_:1})])),_:1},8,["modelValue"])}var Y={name:"AddMember",props:{organization_id:Number,existingMembers:Array},setup(){const e=(0,R.E)(),t=(0,O.T)();return{accountStore:e,generalStore:t}},data(){return{dialog:!1,step:0,steps:[{title:"Utilizador",icon:"mdi-account",formValid:!1},{title:"Data de Início",icon:"mdi-calendar",formValid:!1}],agents:[],isLoadingAgents:!1,member:null,startDate:new Date,isLoadingPost:!1,startDate:new Date}},watch:{roleSelected(e){e&&(this.member=null)},member(e){e&&console.log(e)}},computed:{lastStep(){return this.steps.length-1},existingAgentIds(){return this.existingMembers.map((e=>e.id))}},methods:{reset(){this.step=0,this.member=null,this.agents=[],this.startDate=new Date,this.isLoadingPost=!1},roleColor(e){switch(e){case"Administrador":return"error";case"Organização":return"warning";case"Produtor":return"success";case"Agente de Campo":return"info";default:return"primary"}},async listAgents(e){e&&(this.isLoadingAgents=!0,await X.A.request({url:"api/freeagents",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token},params:{username:e}}).then((e=>{this.agents=e.data.agents,this.isLoadingAgents=!1})))},async postMember(){console.log("postMember"),this.isLoadingPost=!0;let e={agent_id:this.member.id,organization_id:this.organization_id,startDate:this.startDate};console.log(e),await X.A.request({url:"api/organizationmembers",method:"POST",headers:{Authorization:"Bearer "+this.accountStore.account.token},data:e}).then((e=>{this.isLoadingPost=!1,this.dialog=!1,this.generalStore.successSnackbar("Membro adicionado com sucesso!"),this.$emit("refresh")})).catch((e=>{console.error(e),this.isLoadingPost=!1,this.generalStore.errorSnackbar("Erro ao adicionar membro.")}))}}};const K=(0,E.A)(Y,[["render",H]]);var Z=K,ee={name:"AgentsView",components:{AgentsTable:Q,AddMember:Z},setup(){const e=(0,R.E)();return{accountStore:e}},data(){return{isLoadingTable:!1,agents:[],filter:{organization_id:null,type:null,username:null,name:null,phone:null,email:null},limit:12,offset:0,hasMore:!1,isLoadingOrgs:!1,organizations:[],isLoadingAgentTypes:!1,agentTypes:[],isLoadingMemberTypes:!1,memberTypes:[]}},watch:{},computed:{},methods:{async getAgents(){this.isLoadingTable=!0,await X.A.request({url:"api/agents",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token},params:{limit:this.limit,offset:this.offset,organization_id:this.filter.organization_id,type:this.filter.type,username:this.filter.username,name:this.filter.name,phone:this.filter.phone,email:this.filter.email}}).then((e=>{this.agents.push(...e.data.agents),this.offset+=e.data.agents.length,this.hasMore=e.data.hasMore,this.isLoadingTable=!1})).catch((e=>{console.log(e),this.isLoadingTable=!1}))},refreshAgents(){this.offset=0,this.agents=[],this.getAgents()},async getOrganizations(){this.isLoadingOrgs=!0,await X.A.request({url:"api/organizations",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.organizations=e.data.organizations,this.isLoadingOrgs=!1})).catch((e=>{console.log(e),this.isLoadingOrgs=!1}))},async getAgentTypes(){this.isLoadingAgentTypes=!0,await X.A.request({url:"api/agenttypes/roles",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.agentTypes=e.data,this.isLoadingAgentTypes=!1})).catch((e=>{console.log(e),this.isLoadingAgentTypes=!1}))},async getMemberTypes(){this.isLoadingMemberTypes=!0,await X.A.request({url:"api/membertypes",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.memberTypes=e.data,this.isLoadingMemberTypes=!1})).catch((e=>{console.log(e),this.isLoadingMemberTypes=!1}))}},mounted(){this.getAgents(),this.accountStore.hasRole(["Administrador"])?(this.getOrganizations(),this.getAgentTypes()):this.accountStore.hasRole(["Organização"])&&this.getMemberTypes()}};const te=(0,E.A)(ee,[["render",h]]);var ae=te},1321:function(e,t,a){a.d(t,{i:function(){return u}});var o=a(6768),i=a(9262),l=a(5296),n=a(4587),r=a(1247),s=a(4600);const d=(0,n.j)({locale:String,fallbackLocale:String,messages:Object,rtl:{type:Boolean,default:void 0},...(0,i.u)()},"VLocaleProvider"),u=(0,r.RW)()({name:"VLocaleProvider",props:d(),setup(e,t){let{slots:a}=t;const{rtlClasses:i}=(0,l.Q1)(e);return(0,s.C)((()=>(0,o.bF)("div",{class:["v-locale-provider",i.value,e.class],style:e.style},[a.default?.()]))),{}}})},8738:function(e,t,a){a.d(t,{V8:function(){return y}});a(4114);var o=a(6768),i=a(2886),l=a(2542),n=a(7018),r=a(5296),s=a(7664),d=a(144),u=a(4587),c=a(1247),m=a(9094),g=a(4600);const b={actions:"button@2",article:"heading, paragraph",avatar:"avatar",button:"button",card:"image, heading","card-avatar":"image, list-item-avatar",chip:"chip","date-picker":"list-item, heading, divider, date-picker-options, date-picker-days, actions","date-picker-options":"text, avatar@2","date-picker-days":"avatar@28",divider:"divider",heading:"heading",image:"image","list-item":"text","list-item-avatar":"avatar, text","list-item-two-line":"sentences","list-item-avatar-two-line":"avatar, sentences","list-item-three-line":"paragraph","list-item-avatar-three-line":"avatar, paragraph",ossein:"ossein",paragraph:"text@3",sentences:"text@2",subtitle:"text",table:"table-heading, table-thead, table-tbody, table-tfoot","table-heading":"chip, text","table-thead":"heading@6","table-tbody":"table-row-divider@6","table-row-divider":"table-row, divider","table-row":"text@6","table-tfoot":"text@2, avatar@2",text:"text"};function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return(0,o.bF)("div",{class:["v-skeleton-loader__bone",`v-skeleton-loader__${e}`]},[t])}function p(e){const[t,a]=e.split("@");return Array.from({length:a}).map((()=>f(t)))}function f(e){let t=[];if(!e)return t;const a=b[e];if(e===a);else{if(e.includes(","))return k(e);if(e.includes("@"))return p(e);a.includes(",")?t=k(a):a.includes("@")?t=p(a):a&&t.push(f(a))}return[h(e,t)]}function k(e){return e.replace(/\s/g,"").split(",").map(f)}const v=(0,u.j)({boilerplate:Boolean,color:String,loading:Boolean,loadingText:{type:String,default:"$vuetify.loading"},type:{type:[String,Array],default:"ossein"},...(0,l.X)(),...(0,n.s)(),...(0,s.yx)()},"VSkeletonLoader"),y=(0,c.RW)()({name:"VSkeletonLoader",props:v(),setup(e,t){let{slots:a}=t;const{backgroundColorClasses:u,backgroundColorStyles:c}=(0,i.z6)((0,d.lW)(e,"color")),{dimensionStyles:b}=(0,l.S)(e),{elevationClasses:h}=(0,n.j)(e),{themeClasses:p}=(0,s.NX)(e),{t:k}=(0,r.Ym)(),v=(0,o.EW)((()=>f((0,m.BN)(e.type).join(","))));return(0,g.C)((()=>{const t=!a.default||e.loading;return(0,o.bF)("div",{class:["v-skeleton-loader",{"v-skeleton-loader--boilerplate":e.boilerplate},p.value,u.value,h.value],style:[c.value,t?b.value:{}],"aria-busy":e.boilerplate?void 0:t,"aria-live":e.boilerplate?void 0:"polite","aria-label":e.boilerplate?void 0:k(e.loadingText),role:e.boilerplate?void 0:"alert"},[t?v.value:a.default?.()])})),{}}})}}]);
//# sourceMappingURL=users.db43734d.js.map