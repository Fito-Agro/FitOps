"use strict";(self["webpackChunkfitoagro_backoffice"]=self["webpackChunkfitoagro_backoffice"]||[]).push([[310],{4843:function(e,t,o){o.r(t),o.d(t,{default:function(){return ta}});var i=o(6768),a=o(2239),r=o(2807),n=o(4593),l=o(1606),s=o(697),d=o(3813),c=o(6756),u=o(5526),g=o(9669),p=o(3948);function m(e,t,o,m,h,f){const b=(0,i.g2)("AddRegion"),_=(0,i.g2)("RegionsDetail"),k=(0,i.g2)("RegionsTable");return(0,i.uX)(),(0,i.Wv)(d.I,{fluid:"",class:"fill-width"},{default:(0,i.k6)((()=>[(0,i.bF)(c.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(u.B,{cols:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(n.J,{elevation:"8"},{default:(0,i.k6)((()=>[(0,i.bF)(l.r,null,{default:(0,i.k6)((()=>[(0,i.eW)("Filtro")])),_:1}),(0,i.bF)(s.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(c.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(u.B,{cols:"6"},{default:(0,i.k6)((()=>[(0,i.bF)(c.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(u.B,{cols:"3"},{default:(0,i.k6)((()=>[(0,i.bF)(p.W,{clearable:"",density:"comfortable",variant:"underlined",color:"primary",label:"Código da Parcela",disabled:h.isLoadingRegions,modelValue:h.filter.region_code,"onUpdate:modelValue":t[0]||(t[0]=e=>h.filter.region_code=e)},null,8,["disabled","modelValue"])])),_:1}),(0,i.bF)(u.B,{cols:"4"},{default:(0,i.k6)((()=>[(0,i.bF)(p.W,{clearable:"",density:"comfortable",variant:"underlined",color:"primary",label:"Nome da Parcela",disabled:h.isLoadingRegions,modelValue:h.filter.region_name,"onUpdate:modelValue":t[1]||(t[1]=e=>h.filter.region_name=e)},null,8,["disabled","modelValue"])])),_:1}),(0,i.bF)(u.B,{cols:"4"},{default:(0,i.k6)((()=>[(0,i.bF)(a.V,{clearable:"",modelValue:h.filter.regiontype_id,"onUpdate:modelValue":t[2]||(t[2]=e=>h.filter.regiontype_id=e),label:"Tipo de Região",items:h.regiontypes,"item-title":"regiontype_name","item-value":"regiontype_id",density:"comfortable",variant:"underlined",color:"primary",disabled:h.isLoadingRegionTypes},null,8,["modelValue","items","disabled"])])),_:1}),(0,i.bF)(u.B,{cols:"3"},{default:(0,i.k6)((()=>[(0,i.bF)(p.W,{clearable:"",density:"comfortable",variant:"underlined",color:"primary",label:"Localidade",disabled:h.isLoadingRegions,modelValue:h.filter.local,"onUpdate:modelValue":t[3]||(t[3]=e=>h.filter.local=e)},null,8,["disabled","modelValue"])])),_:1}),(0,i.bF)(u.B,{cols:"3"},{default:(0,i.k6)((()=>[(0,i.bF)(a.V,{clearable:"",density:"comfortable",variant:"underlined",color:"primary",label:"Cultura",disabled:h.isLoadingCrops,items:h.crops,"item-title":"crop_name","item-value":"crop_id",modelValue:h.filter.crop,"onUpdate:modelValue":t[4]||(t[4]=e=>h.filter.crop=e)},null,8,["disabled","items","modelValue"])])),_:1}),m.accountStore.hasRole(["Administrador"])?((0,i.uX)(),(0,i.Wv)(u.B,{key:0,cols:"4"},{default:(0,i.k6)((()=>[(0,i.bF)(a.V,{clearable:"",density:"comfortable",variant:"underlined",color:"primary",label:"Organização",disabled:h.isLoadingRegions||h.isLoadingOrganizations,items:h.organizations,"item-title":"organization_name","item-value":"organization_id",modelValue:h.filter.organization_id,"onUpdate:modelValue":t[5]||(t[5]=e=>h.filter.organization_id=e)},null,8,["disabled","items","modelValue"])])),_:1})):(0,i.Q3)("",!0)])),_:1})])),_:1}),(0,i.bF)(u.B,{cols:"3"},{default:(0,i.k6)((()=>[(0,i.bF)(c.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(u.B,{cols:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(r.D,{color:"secondary",icon:"",variant:"text",onClick:t[6]||(t[6]=e=>f.search()),disabled:h.isLoadingRegions},{default:(0,i.k6)((()=>[(0,i.bF)(g.w,{size:"x-large"},{default:(0,i.k6)((()=>[(0,i.eW)("mdi-magnify")])),_:1})])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1}),(0,i.bF)(u.B,{cols:"3"},{default:(0,i.k6)((()=>[(0,i.bF)(c.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(u.B,{cols:"12"},{default:(0,i.k6)((()=>[m.accountStore.hasRole(["Produtor","Organização"])?((0,i.uX)(),(0,i.Wv)(b,{key:0,onRefreshRegions:t[7]||(t[7]=e=>f.search())})):(0,i.Q3)("",!0)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),(0,i.bF)(_,{ref:"RegionDetail"},null,512),(0,i.bF)(c.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(u.B,null,{default:(0,i.k6)((()=>[(0,i.bF)(k,{regions:h.regions,isLoadingRegions:h.isLoadingRegions,hasMore:h.hasMore,onLoadMore:t[8]||(t[8]=e=>f.getRegions()),onShowInfo:t[9]||(t[9]=e=>f.showInfo(e)),onRefresh:t[10]||(t[10]=e=>f.search())},null,8,["regions","isLoadingRegions","hasMore"])])),_:1})])),_:1})])),_:1})}o(4114);var h=o(4232),f=o(3745),b=o(5523),_=o(1867),k=o(1772),v=o(7511),y=o(1146),F=o(8738),L=o(1161),V=o(9629);const D={key:0},S={key:1,class:"d-flex justify-center nowrap"},E=["colspan"],P=(0,i.Lk)("span",null,"Remover Parcela",-1);function A(e,t,o,a,d,c){const u=(0,i.g2)("RegionEdit");return(0,i.uX)(),(0,i.Wv)(y.i,{class:"pa-2",elevation:"8",rounded:"lg",width:"100%"},{default:(0,i.k6)((()=>[(0,i.bF)(_.g,{"fixed-header":"","no-data-text":"Nenhuma parcela encontrada","loading-text":"Carregando parcelas...",headers:c.headers,items:c.tableItems,loading:o.isLoadingRegions,height:c.tableHeight},(0,i.eX)({item:(0,i.k6)((e=>[(0,i.Lk)("tr",null,[(0,i.Lk)("td",null,[(0,i.bF)(r.D,{color:"info",variant:"text",icon:"mdi-dots-vertical-circle-outline",onClick:t=>c.showInfo(e.item.region_id)},null,8,["onClick"])]),(0,i.Lk)("td",null,(0,h.v_)(e.item.region_code),1),(0,i.Lk)("td",null,(0,h.v_)(e.item.region_name),1),(0,i.Lk)("td",null,[(0,i.bF)(b.x,{label:"",color:"info"},{default:(0,i.k6)((()=>[(0,i.eW)((0,h.v_)(e.item.regiontype),1)])),_:2},1024)]),(0,i.Lk)("td",null,(0,h.v_)(e.item.localidade),1),(0,i.Lk)("td",null,(0,h.v_)(e.item.crop?.crop_name),1),a.accountStore.hasRole(["Administrador"])?((0,i.uX)(),(0,i.CE)("td",D,[(0,i.bF)(b.x,{color:"warning"},{default:(0,i.k6)((()=>[(0,i.eW)((0,h.v_)(e.item.organization_name),1)])),_:2},1024)])):(0,i.Q3)("",!0),a.accountStore.hasRole(["Administrador","Organização","Produtor"])?((0,i.uX)(),(0,i.CE)("td",S,[(0,i.bF)(r.D,{color:"warning",variant:"text",icon:"",onClick:t=>c.openEditDialog(e.item)},{default:(0,i.k6)((()=>[(0,i.bF)(g.w,null,{default:(0,i.k6)((()=>[(0,i.eW)("mdi-pencil")])),_:1}),(0,i.bF)(L.y,{activator:"parent",location:"bottom"},{default:(0,i.k6)((()=>[(0,i.eW)(" Editar ")])),_:1})])),_:2},1032,["onClick"]),a.accountStore.hasRole(["Administrador","Organização"])?((0,i.uX)(),(0,i.Wv)(r.D,{key:0,color:"error",variant:"text",icon:"",onClick:t=>c.openRemoveDialog(e.item)},{default:(0,i.k6)((()=>[(0,i.bF)(g.w,null,{default:(0,i.k6)((()=>[(0,i.eW)("mdi-delete-outline")])),_:1}),(0,i.bF)(L.y,{activator:"parent",location:"bottom"},{default:(0,i.k6)((()=>[(0,i.eW)(" Remover ")])),_:1})])),_:2},1032,["onClick"])):(0,i.Q3)("",!0)])):(0,i.Q3)("",!0)])])),_:2},[o.hasMore&&!o.isLoadingRegions?{name:"body.append",fn:(0,i.k6)((()=>[(0,i.bo)(((0,i.uX)(),(0,i.CE)("tr",null,[(0,i.Lk)("td",{colspan:c.headers.length,class:"text-center"},[(0,i.bF)(F.V8,{type:"table-row"})],8,E)])),[[V.o,{handler:c.loadMore,options:{threshold:.5}},void 0,{quiet:!0}]])])),key:"0"}:void 0]),1032,["headers","items","loading","height"]),(0,i.bF)(k.p,{modelValue:d.deleteDialog,"onUpdate:modelValue":t[2]||(t[2]=e=>d.deleteDialog=e),onAfterLeave:t[3]||(t[3]=e=>d.region=null),width:"auto",persistent:""},{default:(0,i.k6)((()=>[(0,i.bF)(n.J,null,{default:(0,i.k6)((()=>[(0,i.bF)(l.r,{class:"bg-error d-flex align-center"},{default:(0,i.k6)((()=>[(0,i.bF)(g.w,{size:"small",class:"mr-2"},{default:(0,i.k6)((()=>[(0,i.eW)("mdi-delete-outline")])),_:1}),P])),_:1}),(0,i.bF)(s.O,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,h.v_)(d.region?`Deseja remover a parcela ${d.region.region_name}?`:""),1)])),_:1}),(0,i.bF)(v.G),(0,i.bF)(f.S,{class:"d-flex justify-space-around"},{default:(0,i.k6)((()=>[(0,i.bF)(r.D,{color:"error",variant:"tonal",icon:"mdi-close",onClick:t[0]||(t[0]=e=>d.deleteDialog=!1)}),(0,i.bF)(r.D,{color:"secondary",variant:"tonal",icon:"mdi-check",loading:d.isLoadingDelete,onClick:t[1]||(t[1]=e=>c.deleteRegion())},null,8,["loading"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,i.bF)(u,{regionProp:d.region,dialog:d.editDialog,"onUpdate:dialog":t[4]||(t[4]=e=>d.editDialog=e),onRefresh:t[5]||(t[5]=()=>e.$emit("refresh"))},null,8,["regionProp","dialog"])])),_:1})}var w=o(1560),x=o(3740);const C=(0,i.Lk)("span",null,"Editar Parcela",-1);function W(e,t,o,d,p,m){return(0,i.uX)(),(0,i.Wv)(k.p,{modelValue:m.localDialog,"onUpdate:modelValue":t[7]||(t[7]=e=>m.localDialog=e),onAfterLeave:t[8]||(t[8]=e=>m.reset()),width:"auto"},{default:(0,i.k6)((()=>[(0,i.bF)(n.J,{class:"mx-auto",width:"500"},{default:(0,i.k6)((()=>[(0,i.bF)(l.r,{class:"bg-warning d-flex align-center"},{default:(0,i.k6)((()=>[(0,i.bF)(g.w,{size:"small",class:"mr-2"},{default:(0,i.k6)((()=>[(0,i.eW)("mdi-pencil")])),_:1}),C])),_:1}),(0,i.bF)(s.O,null,{default:(0,i.k6)((()=>[p.isLoadingGet?((0,i.uX)(),(0,i.Wv)(F.V8,{key:0,type:"text",class:"mb-4"})):((0,i.uX)(),(0,i.Wv)(w.n,{key:1,modelValue:p.formValid,"onUpdate:modelValue":t[4]||(t[4]=e=>p.formValid=e),ref:"form"},{default:(0,i.k6)((()=>[(0,i.bF)(c.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(u.B,{cols:"6"},{default:(0,i.k6)((()=>[(0,i.bF)(a.V,{modelValue:p.region.crop,"onUpdate:modelValue":[t[0]||(t[0]=e=>p.region.crop=e),t[1]||(t[1]=e=>m.refreshVarieties())],items:p.crops,"item-title":"crop_name","return-object":"",label:"Cultura",placeholder:"Escolhe uma cultura","prepend-inner-icon":"mdi-tree-outline","no-data-text":"Nenhuma cultura encontrada",density:"compact",variant:"outlined",rules:[p.rules.required],loading:p.isLoadingCrops},null,8,["modelValue","items","rules","loading"])])),_:1}),(0,i.bF)(u.B,{cols:"6"},{default:(0,i.k6)((()=>[(0,i.bF)(a.V,{modelValue:p.region.variety,"onUpdate:modelValue":t[2]||(t[2]=e=>p.region.variety=e),items:p.varieties,"item-title":"variety_name","return-object":"",label:"Variedade",placeholder:"Escolhe uma variedade","prepend-inner-icon":"mdi-food-apple-outline","no-data-text":"Nenhuma variedade encontrada",density:"compact",variant:"outlined",rules:[p.rules.required],disabled:!p.region.crop,loading:p.isLoadingVarieties},null,8,["modelValue","items","rules","disabled","loading"])])),_:1}),(0,i.bF)(u.B,{cols:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(x.J,{modelValue:p.region.region_description,"onUpdate:modelValue":t[3]||(t[3]=e=>p.region.region_description=e),label:"Descrição",placeholder:"Insira uma descrição...","prepend-inner-icon":"mdi-text-box-outline",density:"compact",variant:"outlined",rules:[p.rules.description]},null,8,["modelValue","rules"])])),_:1})])),_:1})])),_:1},8,["modelValue"]))])),_:1}),(0,i.bF)(v.G),(0,i.bF)(f.S,{class:"d-flex justify-space-around"},{default:(0,i.k6)((()=>[(0,i.bF)(r.D,{color:"error",variant:"tonal",icon:"mdi-close",onClick:t[5]||(t[5]=e=>m.localDialog=!1)}),(0,i.bF)(r.D,{color:"secondary",variant:"tonal",icon:"mdi-check",loading:p.isLoadingEdit,disabled:!m.canEdit,onClick:t[6]||(t[6]=e=>m.editRegion())},null,8,["loading","disabled"])])),_:1})])),_:1})])),_:1},8,["modelValue"])}var T=o(501),R=o(6044),z=o(8355),O={name:"RegionEdit",props:{regionProp:{type:Object},dialog:{type:Boolean,required:!0}},setup(){const e=(0,T.T)(),t=(0,R.E)();return{generalStore:e,accountStore:t}},data(){return{oldRegion:null,region:null,isLoadingEdit:!1,isLoadingGet:!1,formValid:!1,orgMembers:[],isLoadingMembers:!1,stations:[],isLoadingStations:!1,crops:[],isLoadingCrops:!1,varieties:[],isLoadingVarieties:!1,rules:{required:e=>!!e||"Campo obrigatório.",code:e=>e&&e.length<=3&&e.toUpperCase()===e||"Código inválido",maxLength:e=>e&&e.length<=25||"Máximo de 25 caracteres.",description:e=>e&&e.length<=255||!e||"Máximo de 255 caracteres."}}},watch:{dialog(e){e&&this.onOpenDialog()}},computed:{localDialog:{get(){return this.dialog},set(e){this.$emit("update:dialog",e)}},regionCenter(){const e=this.region.geometry.geometry_shape.coordinates[0],t=e.reduce(((e,[t,o])=>[e[0]+t,e[1]+o]),[0,0]),o=[t[0]/e.length,t[1]/e.length];return o},isDifferent(){return this.region?.crop?.crop_id!=this.oldRegion?.crop?.crop_id||this.region?.variety?.variety_id!=this.oldRegion?.variety?.variety_id||this.region?.region_description!=this.oldRegion?.region_description},canEdit(){return this.formValid&&this.isDifferent}},methods:{async onOpenDialog(){await this.getRegionDetail(),await this.getCrops(),this.region.crop&&await this.getVarieties()},editRegion(){this.isLoadingEdit=!0;let e={crop:{...this.region.crop,variety:this.region.variety},region_description:this.region.region_description};console.log(e),z.A.request({url:"api/regions/"+this.regionProp.region_id,method:"patch",headers:{Authorization:"Bearer "+this.accountStore.account.token},data:e}).then((e=>{this.isLoadingEdit=!1,this.localDialog=!1,this.generalStore.successSnackbar("Parcela editada com sucesso."),this.$emit("refresh")})).catch((e=>{console.log(e),this.isLoadingEdit=!1,this.generalStore.errorSnackbar("Erro ao editar parcela.")}))},async getOrgMembers(){this.isLoadingMembers=!0,await z.A.request({url:"api/organizations/"+this.regionProp.organization_id+"/organizationproducers",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.orgMembers=e.data,this.isLoadingMembers=!1})).catch((e=>{console.log(e),this.isLoadingMembers=!1,this.generalStore.errorSnackbar("Erro ao obter produtores.")}))},async getNearestStations(){this.isLoadingStations=!0;let e={location:this.regionCenter};await z.A.request({url:"api/closedatasources",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token},params:e}).then((e=>{this.stations=e.data.datasources,this.isLoadingStations=!1}))},async getCrops(){this.isLoadingCrops=!0,await z.A.request({url:"api/crops",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.crops=e.data,this.isLoadingCrops=!1})).catch((e=>{this.isLoadingCrops=!1,this.generalStore.errorSnackbar("Erro ao obter culturas.")}))},async refreshVarieties(){this.region.variety=null,await this.$refs.form.validate(),this.getVarieties()},async getVarieties(){this.isLoadingVarieties=!0,await z.A.request({url:"api/crops/"+this.region.crop.crop_id+"/varieties",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.varieties=e.data,this.isLoadingVarieties=!1})).catch((e=>{this.isLoadingVarieties=!1,this.generalStore.errorSnackbar("Erro ao obter variedades.")}))},async getRegionDetail(){this.isLoadingGet=!0,await z.A.request({url:"api/regions/"+this.regionProp.region_id,method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.region=e.data,this.oldRegion={...e.data},console.log(e.data),this.isLoadingGet=!1})).catch((e=>{console.log(e)}))},convertToKm(e){return(e/1e3).toFixed(2)+" km"},reset(){this.region=null,this.orgMembers=[]}}},B=o(1241);const M=(0,B.A)(O,[["render",W]]);var I=M,X={name:"RegionsTable",components:{RegionEdit:I},props:{regions:Array,isLoadingRegions:Boolean,hasMore:Boolean},setup(){const e=(0,T.T)(),t=(0,R.E)();return{generalStore:e,accountStore:t}},data(){return{isLoading:!1,editDialog:!1,isLoadingDelete:!1,deleteDialog:!1,editFormValid:!1,region:null}},computed:{tableHeight(){return window.innerHeight-350},headers(){switch(this.accountStore.Role()){case"Administrador":return[{title:"",align:"center"},{title:"Código da Parcela",key:"region_code"},{title:"Nome da Parcela",key:"region_name"},{title:"Tipo",key:"regiontype"},{title:"Localidade",key:"localidade"},{title:"Cultura",key:"crop"},{title:"Organização",key:"organization_name"},{title:"",align:"center"}];case"Agente de Campo":return[{title:"",align:"center"},{title:"Código da Parcela",key:"region_code"},{title:"Nome da Parcela",key:"region_name"},{title:"Tipo",key:"regiontype"},{title:"Localidade",key:"localidade"},{title:"Cultura",key:"crop"}];default:return[{title:"",align:"center"},{title:"Código da Parcela",key:"region_code"},{title:"Nome da Parcela",key:"region_name"},{title:"Tipo",key:"regiontype"},{title:"Localidade",key:"localidade"},{title:"Cultura",key:"crop"},{title:"",align:"center"}]}},tableItems(){return this.regions}},methods:{showInfo(e){this.$emit("showInfo",e)},openEditDialog(e){this.region=e,this.editDialog=!0},openRemoveDialog(e){this.region=e,this.deleteDialog=!0},loadMore(e){e&&this.$emit("loadMore")},deleteRegion(){this.isLoadingDelete=!0,z.A.request({url:"api/regions/"+this.region.region_id,method:"delete",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.isLoadingDelete=!1,this.deleteDialog=!1,this.generalStore.successSnackbar("Parcela removida com sucesso."),this.$emit("refresh")})).catch((e=>{console.error(e),this.isLoadingDelete=!1,this.generalStore.errorSnackbar(e.response.data.error,3e3)}))}}};const U=(0,B.A)(X,[["render",A]]);var q=U,j=o(373),G=o(6106),N=o(381),J=o(6686),$=o(7604),Q=o(4441);const K={class:""};function Y(e,t,o,a,r,g){const p=(0,i.g2)("RegionDetail"),m=(0,i.g2)("EOIsDetail"),f=(0,i.g2)("PeriodsDetail"),b=(0,i.g2)("DatasourcesDetail"),_=(0,i.g2)("RegionAgentsDetail"),k=(0,i.g2)("RegionVisitsDetails");return(0,i.uX)(),(0,i.Wv)(j.e,{location:"right",modelValue:r.drawer,"onUpdate:modelValue":t[3]||(t[3]=e=>r.drawer=e),width:"1000",temporary:"","disable-route-watcher":""},{default:(0,i.k6)((()=>[(0,i.bF)(n.J,{class:"fill-height"},{default:(0,i.k6)((()=>[(0,i.bF)(l.r,{class:"bg-primary white--text"},{default:(0,i.k6)((()=>[(0,i.Lk)("span",K,[(0,i.eW)("Detalhes da Parcela "),(0,i.Lk)("i",null,(0,h.v_)(r.region?.region_name),1)])])),_:1}),(0,i.bF)(s.O,{class:"fill-height pa-0"},{default:(0,i.k6)((()=>[(0,i.bF)(d.I,{class:"fill-height pa-0"},{default:(0,i.k6)((()=>[r.isLoading?((0,i.uX)(),(0,i.Wv)(c.L,{key:0,align:"center"},{default:(0,i.k6)((()=>[(0,i.bF)(u.B,{class:"d-flex align-center justify-center"},{default:(0,i.k6)((()=>[(0,i.bF)(G.x,{color:"secondary",size:"65",width:"7",indeterminate:""})])),_:1})])),_:1})):(0,i.Q3)("",!0),r.isLoading||null==r.region?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.Wv)(n.J,{key:1,elevation:"0",flat:"",rounded:"",width:"100%",height:"100%",class:"ma-0"},{default:(0,i.k6)((()=>[(0,i.bF)(N.h,{color:"secondary",modelValue:r.tab,"onUpdate:modelValue":t[0]||(t[0]=e=>r.tab=e),grow:""},{default:(0,i.k6)((()=>[(0,i.bF)(J.U,{value:"region"},{default:(0,i.k6)((()=>[(0,i.eW)(" Parcela ")])),_:1}),(0,i.bF)(J.U,{value:"eois"},{default:(0,i.k6)((()=>[(0,i.eW)(" EOIs ")])),_:1}),(0,i.bF)(J.U,{value:"regioninperiods"},{default:(0,i.k6)((()=>[(0,i.eW)(" Períodos")])),_:1}),(0,i.bF)(J.U,{value:"agents"},{default:(0,i.k6)((()=>[(0,i.eW)("Utilizadores")])),_:1}),(0,i.bF)(J.U,{value:"visits"},{default:(0,i.k6)((()=>[(0,i.eW)("Visitas")])),_:1})])),_:1},8,["modelValue"]),(0,i.bF)(s.O,{class:"fill-height"},{default:(0,i.k6)((()=>[(0,i.bF)($.l,{modelValue:r.tab,"onUpdate:modelValue":t[2]||(t[2]=e=>r.tab=e),class:"fill-height"},{default:(0,i.k6)((()=>[(0,i.bF)(Q.Y,{value:"region",class:"fill-height"},{default:(0,i.k6)((()=>[(0,i.bF)(p,{region:r.region,onRefresh:t[1]||(t[1]=e=>g.getRegionDetail(r.region.region_id))},null,8,["region"])])),_:1}),(0,i.bF)(Q.Y,{value:"eois",class:"fill-height"},{default:(0,i.k6)((()=>[(0,i.bF)(m,{ref:"EOIsDetail",region:r.region},null,8,["region"])])),_:1}),(0,i.bF)(Q.Y,{value:"regioninperiods",class:"fill-height"},{default:(0,i.k6)((()=>[(0,i.bF)(f,{region:r.region,onRefreshEOIs:g.refreshEOIs},null,8,["region","onRefreshEOIs"])])),_:1}),(0,i.bF)(Q.Y,{value:"regiondatasources",class:"fill-height"},{default:(0,i.k6)((()=>[(0,i.bF)(b,{region:r.region},null,8,["region"])])),_:1}),(0,i.bF)(Q.Y,{value:"agents",class:"fill-height"},{default:(0,i.k6)((()=>[(0,i.bF)(_,{region:r.region},null,8,["region"])])),_:1}),(0,i.bF)(Q.Y,{value:"visits",class:"fill-height"},{default:(0,i.k6)((()=>[(0,i.bF)(k,{region:r.region},null,8,["region"])])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}))])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])}const H=e=>((0,i.Qi)("data-v-047e9bac"),e=e(),(0,i.jt)(),e),Z=H((()=>(0,i.Lk)("span",{class:"text-h4"},"Informação Geral",-1))),ee=H((()=>(0,i.Lk)("span",{class:"text-h6 mx-2"},"Detalhes",-1))),te={class:"text-subtitle-1"},oe={class:"text-subtitle-1"},ie={class:"text-subtitle-1"},ae={class:"text-subtitle-1"},re={class:"text-subtitle-1"},ne={class:"text-subtitle-1"},le={key:0},se={key:1,class:"text-overline"},de=H((()=>(0,i.Lk)("span",{class:"text-h6 mx-2"},"Meteorologia",-1))),ce={class:"text-subtitle-1","full-width":""},ue={class:"d-flex align-center justify-space-around"},ge={key:0,class:"d-flex align-center"},pe={key:1,class:"text-overline"},me={class:"text-subtitle-1"},he={key:0,class:"d-flex align-center"},fe={key:1,class:"d-flex align-center"},be=H((()=>(0,i.Lk)("span",{class:"text-overline"},"Sem estação",-1))),_e=H((()=>(0,i.Lk)("br",null,null,-1)));function ke(e,t,o,a,d,p){const m=(0,i.g2)("EditClosestDatasource"),f=(0,i.g2)("StationData"),_=(0,i.g2)("VirtualStationDialog"),k=(0,i.g2)("RegionMap"),F=(0,i.g2)("RegionEdit");return(0,i.uX)(),(0,i.Wv)(n.J,{elevation:"0",border:"",rounded:"",class:"pa-5",height:"85%","min-height":"350"},{default:(0,i.k6)((()=>[(0,i.bF)(l.r,{class:"d-flex justify-space-between align-center"},{default:(0,i.k6)((()=>[Z,a.accountStore.hasRole(["Administrador","Organização","Produtor"])?((0,i.uX)(),(0,i.Wv)(r.D,{key:0,color:"warning",variant:"text",icon:"",size:"large",onClick:p.openEditRegionDialog},{default:(0,i.k6)((()=>[(0,i.bF)(g.w,null,{default:(0,i.k6)((()=>[(0,i.eW)("mdi-pencil")])),_:1}),(0,i.bF)(L.y,{activator:"parent",location:"bottom"},{default:(0,i.k6)((()=>[(0,i.eW)(" Editar Detalhes")])),_:1})])),_:1},8,["onClick"])):(0,i.Q3)("",!0)])),_:1}),(0,i.bF)(s.O,{class:"fill-height mt-5 scrollable-card"},{default:(0,i.k6)((()=>[(0,i.bF)(y.i,{border:"",rounded:"",class:"pa-5"},{default:(0,i.k6)((()=>[(0,i.bF)(c.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(u.B,{cols:"12",class:"d-flex align-center justify-space-between"},{default:(0,i.k6)((()=>[(0,i.bF)(v.G),ee,(0,i.bF)(v.G)])),_:1}),(0,i.bF)(u.B,{cols:"4"},{default:(0,i.k6)((()=>[(0,i.Lk)("span",te,[(0,i.eW)(" Código da Parcela: "),(0,i.Lk)("b",null,(0,h.v_)(o.region.region_code),1)])])),_:1}),(0,i.bF)(u.B,{cols:"4"},{default:(0,i.k6)((()=>[(0,i.Lk)("span",oe,[(0,i.eW)(" Nome da Parcela: "),(0,i.Lk)("b",null,(0,h.v_)(o.region.region_name),1)])])),_:1}),(0,i.bF)(u.B,{cols:"4"},{default:(0,i.k6)((()=>[(0,i.Lk)("span",ie,[(0,i.eW)(" Tipo da Parcela: "),(0,i.Lk)("b",null,[(0,i.bF)(b.x,{label:"",color:"info"},{default:(0,i.k6)((()=>[(0,i.eW)((0,h.v_)(o.region.region_type.regiontype_name),1)])),_:1})])])])),_:1}),(0,i.bF)(u.B,{cols:"4"},{default:(0,i.k6)((()=>[(0,i.Lk)("span",ae,[(0,i.eW)(" Localidade: "),(0,i.Lk)("b",null,(0,h.v_)(o.region.localidade),1)])])),_:1}),(0,i.bF)(u.B,{cols:"4"},{default:(0,i.k6)((()=>[(0,i.Lk)("span",re,[(0,i.eW)(" Cultura: "),(0,i.Lk)("b",null,(0,h.v_)(o.region.crop?.crop_name||"Sem cultura"),1)])])),_:1}),(0,i.bF)(u.B,{cols:"4"},{default:(0,i.k6)((()=>[(0,i.Lk)("span",ne,[(0,i.eW)("Organização: "),(0,i.bF)(b.x,{color:"warning"},{default:(0,i.k6)((()=>[(0,i.eW)((0,h.v_)(o.region.organization.organization_name),1)])),_:1})])])),_:1}),(0,i.bF)(u.B,{cols:"12",class:"d-flex flex-column"},{default:(0,i.k6)((()=>[o.region.region_description?((0,i.uX)(),(0,i.CE)("span",le,(0,h.v_)(o.region.region_description),1)):((0,i.uX)(),(0,i.CE)("span",se,"Sem descrição"))])),_:1}),(0,i.bF)(u.B,{cols:"12",class:"d-flex align-center justify-space-between"},{default:(0,i.k6)((()=>[(0,i.bF)(v.G),de,(0,i.bF)(v.G)])),_:1}),(0,i.bF)(u.B,{cols:"6",class:"d-flex align-center"},{default:(0,i.k6)((()=>[(0,i.Lk)("span",ce,[(0,i.eW)(" Estação meteorológica "),(0,i.Lk)("div",ue,[(0,i.bF)(m,{region:o.region,onRefresh:t[0]||(t[0]=()=>e.$emit("refresh"))},null,8,["region"]),o.region.closest_datasource?((0,i.uX)(),(0,i.CE)("div",ge,[(0,i.Lk)("a",{class:"text-secondary text-decoration-none cursor-pointer",onClick:t[1]||(t[1]=(...t)=>e.$refs.RegionMap.flyToStation&&e.$refs.RegionMap.flyToStation(...t))},(0,h.v_)(o.region.closest_datasource?.datasource_name),1),(0,i.bF)(f,{station_id:o.region.closest_datasource.datasource_id},null,8,["station_id"])])):((0,i.uX)(),(0,i.CE)("span",pe,"Sem estação"))])])])),_:1}),(0,i.bF)(u.B,{cols:"6"},{default:(0,i.k6)((()=>[(0,i.Lk)("span",me,[(0,i.eW)(" Estação virtual "),o.region.virtual_datasource?((0,i.uX)(),(0,i.CE)("div",he,[(0,i.bF)(_,{region:o.region,editMode:!0,onRefresh:t[2]||(t[2]=()=>e.$emit("refresh"))},null,8,["region"]),(0,i.Lk)("b",null,(0,h.v_)(o.region.virtual_datasource?.datasource_name),1),(0,i.bF)(f,{station_id:o.region.virtual_datasource.datasource_id},null,8,["station_id"])])):((0,i.uX)(),(0,i.CE)("div",fe,[be,(0,i.bF)(_,{region:o.region,editMode:!1,onRefresh:t[3]||(t[3]=()=>e.$emit("refresh"))},null,8,["region"])]))])])),_:1})])),_:1})])),_:1}),_e,(0,i.bF)(c.L,{class:"fill-height"},{default:(0,i.k6)((()=>[(0,i.bF)(u.B,{cols:"12",class:"fill-height"},{default:(0,i.k6)((()=>[(0,i.bF)(k,{ref:"RegionMap",region:o.region,zoom:15,height:"100%"},null,8,["region"])])),_:1})])),_:1})])),_:1}),(0,i.bF)(F,{regionProp:d.regionToEdit,dialog:d.editDialog,"onUpdate:dialog":t[4]||(t[4]=e=>d.editDialog=e),onRefresh:t[5]||(t[5]=()=>e.$emit("refresh"))},null,8,["regionProp","dialog"])])),_:1})}var ve=o(6593),ye=o(3245),Fe=o(7254);const Le=(0,i.Lk)("span",null,"Alterar estação",-1);function Ve(e,t,o,d,p,m){return(0,i.uX)(),(0,i.Wv)(k.p,{modelValue:p.dialog,"onUpdate:modelValue":t[4]||(t[4]=e=>p.dialog=e),onAfterLeave:t[5]||(t[5]=e=>m.reset()),width:"auto"},{activator:(0,i.k6)((({props:e})=>[(0,i.bF)(r.D,(0,i.v6)({color:"warning",variant:"text",icon:""},e),{default:(0,i.k6)((()=>[(0,i.bF)(g.w,null,{default:(0,i.k6)((()=>[(0,i.eW)("mdi-swap-vertical")])),_:1}),(0,i.bF)(L.y,{activator:"parent",location:"bottom"},{default:(0,i.k6)((()=>[(0,i.eW)(" Alterar Estação ")])),_:1})])),_:2},1040)])),default:(0,i.k6)((({})=>[(0,i.bF)(n.J,{class:"mx-auto",width:"400"},{default:(0,i.k6)((()=>[(0,i.bF)(l.r,{class:"bg-warning d-flex align-center"},{default:(0,i.k6)((()=>[(0,i.bF)(g.w,{class:"mr-2"},{default:(0,i.k6)((()=>[(0,i.eW)("mdi-swap-vertical")])),_:1}),Le])),_:1}),(0,i.bF)(s.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(w.n,{modelValue:p.formValid,"onUpdate:modelValue":t[1]||(t[1]=e=>p.formValid=e)},{default:(0,i.k6)((()=>[(0,i.bF)(c.L,{justify:"center"},{default:(0,i.k6)((()=>[(0,i.bF)(u.B,{cols:"10"},{default:(0,i.k6)((()=>[(0,i.bF)(a.V,{modelValue:p.datasource_id,"onUpdate:modelValue":t[0]||(t[0]=e=>p.datasource_id=e),items:p.datasources,"item-title":"datasource_name","item-value":"datasource_id",label:"Estação meteorológica",placeholder:"Escolhe uma estação","prepend-inner-icon":"mdi-tower-fire","no-data-text":"Nenhuma estação encontrada",color:"secondary",density:"compact",variant:"outlined",rules:p.rules.required,loading:p.isLoadingDatasources},{item:(0,i.k6)((({props:e,item:t})=>[(0,i.bF)(Fe.g,(0,i.v6)(e,{subtitle:m.convertToKm(t.raw.distance)}),null,16,["subtitle"])])),_:1},8,["modelValue","items","rules","loading"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,i.bF)(v.G),(0,i.bF)(f.S,{class:"d-flex justify-space-around"},{default:(0,i.k6)((()=>[(0,i.bF)(r.D,{color:"error",variant:"tonal",icon:"mdi-close",onClick:t[2]||(t[2]=e=>p.dialog=!1)}),(0,i.bF)(r.D,{color:"secondary",variant:"tonal",icon:"mdi-check",loading:p.isLoadingEdit,disabled:!p.formValid,onClick:t[3]||(t[3]=e=>m.editClosestDatasource())},null,8,["loading","disabled"])])),_:1})])),_:1})])),_:1},8,["modelValue"])}var De={name:"EditClosestDatasource",props:{region:{type:Object}},setup(){const e=(0,T.T)(),t=(0,R.E)();return{generalStore:e,accountStore:t}},data(){return{dialog:!1,datasource_id:null,formValid:!1,rules:{required:[e=>!!e||"Campo obrigatório"]},datasources:[],isLoadingDatasources:!1,isLoadingEdit:!1}},watch:{dialog(e){e&&this.onOpenDialog()}},computed:{regionCenter(){const e=this.region.geometry.geometry_shape.coordinates[0],t=e.reduce(((e,[t,o])=>[e[0]+t,e[1]+o]),[0,0]),o=[t[0]/e.length,t[1]/e.length];return o}},methods:{onOpenDialog(){this.datasource_id=this.region.closestdatasource_id,this.getClosestDatasources()},reset(){this.datasource_id=null,this.datasources=[],this.isLoadingDatasources=!1},async getClosestDatasources(){this.isLoadingDatasources=!0;let e={location:this.regionCenter};await z.A.request({url:"api/closedatasources",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token},params:e}).then((e=>{this.datasources=e.data.datasources,this.isLoadingDatasources=!1}))},convertToKm(e){return(e/1e3).toFixed(2)+" km"},editClosestDatasource(){this.isLoadingEdit=!0;let e={datasource_id:this.datasource_id};z.A.request({url:`api/regions/${this.region.region_id}/closestdatasource`,method:"PATCH",headers:{Authorization:"Bearer "+this.accountStore.account.token},data:e}).then((e=>{this.isLoadingEdit=!1,this.dialog=!1,this.generalStore.successSnackbar("Estação da parcela alterada com sucesso."),this.$emit("refresh")})).catch((e=>{console.log(e),this.isLoadingEdit=!1,this.generalStore.errorSnackbar("Erro ao alterar estação da parcela.")}))}}};const Se=(0,B.A)(De,[["render",Ve]]);var Ee=Se,Pe=o(594);const Ae=e=>((0,i.Qi)("data-v-03170b78"),e=e(),(0,i.jt)(),e),we={key:0,class:"d-flex align-center"},xe=Ae((()=>(0,i.Lk)("span",null,"Criar Estação Virtual",-1))),Ce={key:1,class:"d-flex align-center"},We=Ae((()=>(0,i.Lk)("span",null,"Alterar dados a recolher",-1))),Te={key:0},Re={key:1},ze=Ae((()=>(0,i.Lk)("span",null,"Selecionar todos",-1)));function Oe(e,t,o,a,d,c){return(0,i.uX)(),(0,i.Wv)(k.p,{modelValue:d.dialog,"onUpdate:modelValue":t[5]||(t[5]=e=>d.dialog=e),onAfterLeave:t[6]||(t[6]=e=>c.reset()),width:"auto"},{activator:(0,i.k6)((({props:e})=>[o.editMode?((0,i.uX)(),(0,i.Wv)(r.D,(0,i.v6)({key:0,color:"warning",size:"small",icon:"",variant:"text"},e),{default:(0,i.k6)((()=>[(0,i.bF)(g.w,null,{default:(0,i.k6)((()=>[(0,i.eW)("mdi-pencil")])),_:1}),(0,i.bF)(L.y,{activator:"parent",location:"bottom"},{default:(0,i.k6)((()=>[(0,i.eW)(" Alterar dados a recolher ")])),_:1})])),_:2},1040)):((0,i.uX)(),(0,i.Wv)(r.D,(0,i.v6)({key:1,color:"success",variant:"text",icon:""},e),{default:(0,i.k6)((()=>[(0,i.bF)(g.w,null,{default:(0,i.k6)((()=>[(0,i.eW)("mdi-plus-circle-outline")])),_:1}),(0,i.bF)(L.y,{activator:"parent",location:"bottom"},{default:(0,i.k6)((()=>[(0,i.eW)(" Criar estação virtual ")])),_:1})])),_:2},1040))])),default:(0,i.k6)((({})=>[(0,i.bF)(n.J,null,{default:(0,i.k6)((()=>[(0,i.bF)(l.r,{class:(0,h.C4)(["bg-success pl-2",{"bg-warning":o.editMode}])},{default:(0,i.k6)((()=>[o.editMode?((0,i.uX)(),(0,i.CE)("div",Ce,[(0,i.bF)(g.w,{size:"small",class:"mr-2"},{default:(0,i.k6)((()=>[(0,i.eW)("mdi-pencil")])),_:1}),We])):((0,i.uX)(),(0,i.CE)("div",we,[(0,i.bF)(g.w,{size:"small",class:"mr-2"},{default:(0,i.k6)((()=>[(0,i.eW)("mdi-plus-circle-outline")])),_:1}),xe]))])),_:1},8,["class"]),(0,i.bF)(v.G),(0,i.bF)(s.O,{class:"scrollable-card"},{default:(0,i.k6)((()=>[d.isLoading?((0,i.uX)(),(0,i.CE)("div",Te,[((0,i.uX)(),(0,i.CE)(i.FK,null,(0,i.pI)(5,(e=>(0,i.bF)(F.V8,{key:e,type:"heading"}))),64))])):((0,i.uX)(),(0,i.CE)("div",Re,[(0,i.bF)(r.D,{class:"mr-2",color:"info",variant:"text",icon:"",onClick:t[0]||(t[0]=e=>c.selectAll())},{default:(0,i.k6)((()=>[(0,i.bF)(g.w,null,{default:(0,i.k6)((()=>[(0,i.eW)("mdi-playlist-check")])),_:1})])),_:1}),ze,((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(d.seriesVariables,((e,t)=>((0,i.uX)(),(0,i.Wv)(Pe.N,{key:t,modelValue:e.active,"onUpdate:modelValue":t=>e.active=t,label:e.seriesvariable_longname,color:"secondary",density:"comfortable","hide-details":""},null,8,["modelValue","onUpdate:modelValue","label"])))),128))]))])),_:1}),(0,i.bF)(v.G),o.editMode?((0,i.uX)(),(0,i.Wv)(f.S,{key:0,class:"d-flex justify-space-around"},{default:(0,i.k6)((()=>[(0,i.bF)(r.D,{color:"error",variant:"tonal",icon:"mdi-close",onClick:t[1]||(t[1]=e=>d.dialog=!1)}),(0,i.bF)(r.D,{color:"secondary",variant:"tonal",icon:"mdi-check",loading:d.isLoadingEdit,disabled:!c.activeSeriesVariables.length,onClick:t[2]||(t[2]=e=>c.editVirtualStation())},null,8,["loading","disabled"])])),_:1})):((0,i.uX)(),(0,i.Wv)(f.S,{key:1,class:"d-flex justify-space-between"},{default:(0,i.k6)((()=>[(0,i.bF)(r.D,{color:"error",variant:"tonal",onClick:t[3]||(t[3]=e=>d.dialog=!1)},{default:(0,i.k6)((()=>[(0,i.eW)(" Cancelar ")])),_:1}),(0,i.bF)(r.D,{color:"info",variant:"tonal",loading:d.isLoadingPost,disabled:!c.activeSeriesVariables.length,onClick:t[4]||(t[4]=e=>c.postVirtualStation())},{default:(0,i.k6)((()=>[(0,i.eW)(" Criar")])),_:1},8,["loading","disabled"])])),_:1}))])),_:1})])),_:1},8,["modelValue"])}var Be={name:"VirtualStationDialog",props:{region:{type:Object},editMode:{type:Boolean,default:!1}},setup(){const e=(0,R.E)(),t=(0,T.T)();return{accountStore:e,generalStore:t}},data(){return{dialog:!1,seriesVariables:[],active:[],isLoading:!1,isLoadingPost:!1,isLoadingEdit:!1}},watch:{async dialog(e){e&&this.onOpenDialog()},active(e){console.log(e)}},computed:{activeSeriesVariables(){return this.seriesVariables.filter((e=>e.active))}},methods:{async onOpenDialog(){if(await this.getSeriesVariables(),this.editMode){let e=this.region.virtual_datasource.series.map((e=>e.seriesvariable_id));this.seriesVariables=this.seriesVariables.map((t=>e.includes(t.seriesvariable_id)?{...t,active:!0}:{...t,active:!1}))}else this.seriesVariables=this.seriesVariables.map((e=>({...e,active:!1})));console.log(this.seriesVariables)},selectAll(){this.seriesVariables=this.seriesVariables.map((e=>({...e,active:!0})))},reset(){this.seriesVariables=[],this.active=[],this.isLoading=!1},async getSeriesVariables(){this.isLoading=!0,await z.A.request({url:"api/dataprovider/6/seriesvariables",method:"get",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.seriesVariables=e.data,this.isLoading=!1})).catch((e=>{console.log(e),this.isLoading=!1}))},postVirtualStation(){this.isLoadingPost=!0;let e={region_id:this.region.region_id,seriesvariables:this.seriesVariables};console.log(e),z.A.request({url:"api/virtualdatasources",method:"post",headers:{Authorization:"Bearer "+this.accountStore.account.token},data:e}).then((e=>{console.log(e),this.isLoadingPost=!1,this.generalStore.successSnackbar("Estação virtual criada com sucesso"),this.$emit("refresh"),this.dialog=!1})).catch((e=>{console.log(e),this.isLoadingPost=!1,this.generalStore.errorSnackbar("Erro ao criar a estação virtual")}))},async editVirtualStation(){this.isLoadingEdit=!0;let e={datasource_name:this.region.virtual_datasource.datasource_name,seriesvariables:this.seriesVariables};console.log(e),await z.A.request({url:"api/virtualdatasources/"+this.region.virtual_datasource.datasource_id,method:"patch",headers:{Authorization:"Bearer "+this.accountStore.account.token},data:e}).then((e=>{this.isLoadingEdit=!1,this.dialog=!1,this.generalStore.successSnackbar("Estação virtual editada com sucesso"),this.$emit("refresh")})).catch((e=>{console.log(e),this.isLoadingEdit=!1,this.generalStore.errorSnackbar("Erro ao editar a estação virtual")}))}}};const Me=(0,B.A)(Be,[["render",Oe],["__scopeId","data-v-03170b78"]]);var Ie=Me,Xe={name:"RegionDetail",components:{RegionMap:ve.A,RegionEdit:I,StationData:ye.A,VirtualStationDialog:Ie,EditClosestDatasource:Ee},props:{region:{type:Object}},setup(){const e=(0,T.T)(),t=(0,R.E)();return{generalStore:e,accountStore:t}},data(){return{map:null,mapCenter:[-9,39],editDialog:!1,regionToEdit:{}}},computed:{eoisShapes(){let e=this.region.elements_of_interest.filter((e=>null!==e.geometry));return e.map((e=>({type:"Feature",properties:{title:e.eoi_name,type:e.eoi_description},geometry:e.geometry})))},regionShape(){let e=[{type:"Feature",properties:{},geometry:this.region.geometry.geometry_shape}];return this.eoisShapes.length>0&&(e=e.concat(this.eoisShapes)),{type:"FeatureCollection",features:e}}},methods:{openEditRegionDialog(){this.$emit("openEditRegionDialog"),this.editDialog=!0,this.regionToEdit=JSON.parse(JSON.stringify(this.region)),this.regionToEdit.organization_id=this.region.organization.organization_id}}};const Ue=(0,B.A)(Xe,[["render",ke],["__scopeId","data-v-047e9bac"]]);var qe=Ue,je=o(8815),Ge=o(9336),Ne=o(9562);const Je=e=>((0,i.Qi)("data-v-33686690"),e=e(),(0,i.jt)(),e),$e=Je((()=>(0,i.Lk)("span",{class:"text-h4"},"Pesquisa",-1))),Qe={class:"d-flex align-center"},Ke={key:0},Ye={class:"px-4"},He={key:0,class:"mb-5"},Ze=Je((()=>(0,i.Lk)("br",null,null,-1)));function et(e,t,o,d,m,b){const _=(0,i.g2)("AddEoi"),y=(0,i.g2)("EoiEdit"),D=(0,i.g2)("EoiDetail");return(0,i.uX)(),(0,i.Wv)(n.J,{elevation:"0",border:"",rounded:"",class:"pa-5",height:"85%","min-height":"350"},{default:(0,i.k6)((()=>[(0,i.bF)(l.r,null,{default:(0,i.k6)((()=>[$e,(0,i.bF)(c.L,{class:"d-flex align-center justify-space-between"},{default:(0,i.k6)((()=>[(0,i.bF)(u.B,{cols:"3"},{default:(0,i.k6)((()=>[(0,i.bF)(p.W,{modelValue:m.filter.eoi_name,"onUpdate:modelValue":t[0]||(t[0]=e=>m.filter.eoi_name=e),color:"secondary",placeholder:"Nome",density:"compact",variant:"solo","hide-details":"",class:"mt-5",clearable:"","onClick:clear":b.searchEOIs},null,8,["modelValue","onClick:clear"])])),_:1}),(0,i.bF)(u.B,{cols:"6"},{default:(0,i.k6)((()=>[(0,i.bF)(a.V,{modelValue:m.filter.regioninperiod_id,"onUpdate:modelValue":t[1]||(t[1]=e=>m.filter.regioninperiod_id=e),items:m.regionPeriods,"item-title":"period.period_name","item-value":"regioninperiod_id",color:"secondary",placeholder:"Período",density:"compact",variant:"solo","hide-details":"",class:"mt-5",clearable:"","append-icon":"mdi-magnify","menu-props":{"max-height":"200px"},"onClick:clear":b.searchEOIs,"onClick:append":b.searchEOIs},(0,i.eX)({item:(0,i.k6)((({props:e,item:t})=>[(0,i.bF)(Fe.g,(0,i.v6)(e,{subtitle:"Permanente"!=t.raw.period.period_name?b.formatDate(t.raw.period.period_startdate)+" - "+b.formatDate(t.raw.period.period_enddate):""}),null,16,["subtitle"])])),_:2},[m.hasMorePeriods?{name:"append-item",fn:(0,i.k6)((()=>[(0,i.bo)(((0,i.uX)(),(0,i.CE)("div",null,[(0,i.bF)(F.V8,{type:"list-item"})])),[[V.o,b.loadMorePeriods,void 0,{quiet:!0}]])])),key:"0"}:void 0]),1032,["modelValue","items","onClick:clear","onClick:append"])])),_:1}),(0,i.bF)(u.B,{cols:"3",class:"d-flex justify-end"},{default:(0,i.k6)((()=>[d.accountStore.hasRole(["Produtor","Organização","Administrador"])?((0,i.uX)(),(0,i.Wv)(_,{key:0,region:o.region,class:"mb-5",onRefreshEois:t[2]||(t[2]=e=>b.searchEOIs())},null,8,["region"])):(0,i.Q3)("",!0)])),_:1})])),_:1})])),_:1}),(0,i.bF)(s.O,{class:"scrollable-card mt-5"},{default:(0,i.k6)((()=>[m.isLoading?((0,i.uX)(),(0,i.Wv)(Ge.Z,{key:0,color:"primary",indeterminate:""})):((0,i.uX)(),(0,i.Wv)(je.$,{key:1,items:m.eois,"item-value":"eoi_id","items-per-page":m.eois.length},{default:(0,i.k6)((({items:e,isExpanded:a,toggleExpand:s})=>[(0,i.bF)(c.L,null,{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e,(e=>((0,i.uX)(),(0,i.Wv)(u.B,{cols:"12",key:e.raw.eoi_id},{default:(0,i.k6)((()=>[(0,i.bF)(n.J,null,{default:(0,i.k6)((()=>[(0,i.bF)(l.r,{class:"d-flex align-center justify-space-between"},{default:(0,i.k6)((()=>[(0,i.Lk)("div",Qe,[(0,i.bF)(g.w,{color:"secondary",start:""},{default:(0,i.k6)((()=>[(0,i.eW)((0,h.v_)(b.getEoiIcon(e.raw)),1)])),_:2},1024),(0,i.Lk)("h4",null,(0,h.v_)(e.raw.eoi_name),1)]),d.accountStore.hasRole(["Produtor","Organização","Administrador"])?((0,i.uX)(),(0,i.CE)("div",Ke,[(0,i.bF)(y,{eoi_id:e.raw.eoi_id,region:o.region,onRefresh:t[3]||(t[3]=e=>b.searchEOIs())},null,8,["eoi_id","region"]),(0,i.bF)(r.D,{color:"error",variant:"text",icon:"",onClick:t=>b.openDeleteDialog(e.raw)},{default:(0,i.k6)((()=>[(0,i.bF)(g.w,null,{default:(0,i.k6)((()=>[(0,i.eW)("mdi-delete-outline")])),_:1}),(0,i.bF)(L.y,{activator:"parent",location:"bottom"},{default:(0,i.k6)((()=>[(0,i.eW)(" Remover ")])),_:1})])),_:2},1032,["onClick"])])):(0,i.Q3)("",!0)])),_:2},1024),(0,i.Lk)("div",Ye,[(0,i.bF)(Pe.N,{label:(a(e)?"Esconder":"Mostrar")+" Detalhes","model-value":a(e),density:"compact",color:"secondary",onClick:()=>s(e)},null,8,["label","model-value","onClick"]),(0,i.bF)(Ne.Qo,null,{default:(0,i.k6)((()=>[a(e)?((0,i.uX)(),(0,i.CE)("div",He,[(0,i.bF)(D,{eoi_id:e.raw.eoi_id},null,8,["eoi_id"])])):(0,i.Q3)("",!0)])),_:2},1024)])])),_:2},1024)])),_:2},1024)))),128)),m.hasMore?((0,i.uX)(),(0,i.Wv)(u.B,{key:0,cols:"12"},{default:(0,i.k6)((()=>[(0,i.bo)((0,i.bF)(F.V8,{type:"card"},null,512),[[V.o,{handler:b.loadMore,options:{threshold:.3}},void 0,{quiet:!0}]])])),_:1})):((0,i.uX)(),(0,i.Wv)(u.B,{key:1,cols:"12"},{default:(0,i.k6)((()=>[Ze])),_:1}))])),_:2},1024)])),_:1},8,["items","items-per-page"])),(0,i.bF)(k.p,{modelValue:m.deleteDialog,"onUpdate:modelValue":t[6]||(t[6]=e=>m.deleteDialog=e),persistent:"",width:"auto",onAfterLeave:b.resetDeleteDialog},{default:(0,i.k6)((()=>[(0,i.bF)(n.J,{width:"40rem"},{default:(0,i.k6)((()=>[(0,i.bF)(l.r,{class:"bg-error d-flex align-center"},{default:(0,i.k6)((()=>[(0,i.bF)(g.w,{size:"small",class:"mr-2"},{default:(0,i.k6)((()=>[(0,i.eW)("mdi-delete-outline")])),_:1}),(0,i.eW)("Remover elemento de interesse da região")])),_:1}),(0,i.bF)(s.O,null,{default:(0,i.k6)((()=>[(0,i.Lk)("span",null,[(0,i.eW)("Tem a certeza que quer remover "),(0,i.Lk)("b",null,(0,h.v_)(m.eoiToDelete.eoi_type),1),(0,i.eW)(" com o nome "),(0,i.Lk)("b",null,(0,h.v_)(m.eoiToDelete.eoi_name),1),(0,i.eW)("? ")])])),_:1}),(0,i.bF)(v.G),(0,i.bF)(f.S,{class:"d-flex justify-space-around"},{default:(0,i.k6)((()=>[(0,i.bF)(r.D,{color:"error",variant:"tonal",icon:"mdi-close",onClick:t[4]||(t[4]=e=>m.deleteDialog=!1)}),(0,i.bF)(r.D,{color:"secondary",variant:"tonal",icon:"mdi-check",loading:m.isLoadingDelete,onClick:t[5]||(t[5]=e=>b.deleteEOI())},null,8,["loading"])])),_:1})])),_:1})])),_:1},8,["modelValue","onAfterLeave"])])),_:1})])),_:1})}const tt={class:"d-flex flex-column justify-space-evenly"},ot={class:"text-subtitle-1"},it={class:"text-subtitle-1"},at={class:"text-subtitle-1"},rt={key:0,class:"d-flex flex-column"},nt=(0,i.Lk)("br",null,null,-1),lt={class:"text-h6"},st=(0,i.Lk)("br",null,null,-1),dt={class:"text-subtitle-1"},ct={class:"text-subtitle-1"},ut={class:"text-subtitle-1"},gt={key:0},pt={key:1},mt={key:2};function ht(e,t,o,a,r,n){const l=(0,i.g2)("PolyMap"),s=(0,i.g2)("LineMap"),d=(0,i.g2)("PointMap");return(0,i.uX)(),(0,i.Wv)(y.i,null,{default:(0,i.k6)((()=>[r.isLoading?((0,i.uX)(),(0,i.Wv)(c.L,{key:0,align:"center"},{default:(0,i.k6)((()=>[(0,i.bF)(u.B,{class:"d-flex align-center justify-center"},{default:(0,i.k6)((()=>[(0,i.bF)(Ge.Z,{color:"secondary",indeterminate:""})])),_:1})])),_:1})):r.isLoading||null==this.eoi?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.Wv)(c.L,{key:1},{default:(0,i.k6)((()=>[(0,i.bF)(u.B,{cols:"6",class:"d-flex flex-column justify-space-evenly"},{default:(0,i.k6)((()=>[(0,i.Lk)("div",tt,[(0,i.Lk)("span",ot,[(0,i.eW)("Nome: "),(0,i.Lk)("b",null,(0,h.v_)(r.eoi.eoi_name),1)]),(0,i.Lk)("span",it,[(0,i.eW)("Tipo: "),(0,i.Lk)("b",null,(0,h.v_)(r.eoi.element_of_interest_type.eoitype_name),1)]),(0,i.Lk)("span",at,[(0,i.eW)(" Descrição: "),(0,i.Lk)("b",null,(0,h.v_)(r.eoi.eoi_description?r.eoi.eoi_description:"Sem descrição"),1)])]),r.eoi.region_in_period?((0,i.uX)(),(0,i.CE)("div",rt,[(0,i.bF)(v.G),nt,(0,i.Lk)("span",lt,(0,h.v_)(r.eoi.region_in_period.period.period_type.periodtype_name),1),st,(0,i.Lk)("span",dt,[(0,i.eW)("Nome: "),(0,i.Lk)("b",null,(0,h.v_)(r.eoi.region_in_period.period.period_name),1)]),(0,i.Lk)("span",ct,[(0,i.eW)("Data Início: "),(0,i.Lk)("b",null,(0,h.v_)(n.formatDate(r.eoi.region_in_period.period.period_startdate)),1)]),(0,i.Lk)("span",ut,[(0,i.eW)("Data Fim: "),(0,i.Lk)("b",null,(0,h.v_)(n.formatDate(r.eoi.region_in_period.period.period_enddate)),1)])])):(0,i.Q3)("",!0)])),_:1}),(0,i.bF)(u.B,{cols:"6"},{default:(0,i.k6)((()=>[(0,i.bF)(c.L,null,{default:(0,i.k6)((()=>[r.eoi.geometry?((0,i.uX)(),(0,i.Wv)(u.B,{key:0,cols:"12"},{default:(0,i.k6)((()=>["Polygon"==r.eoi.geometry.geometry_shape.type?((0,i.uX)(),(0,i.CE)("div",gt,[(0,i.bF)(l,{polygon:r.eoi.geometry.geometry_shape,height:"300px"},null,8,["polygon"])])):"LineString"==r.eoi.geometry.geometry_shape.type?((0,i.uX)(),(0,i.CE)("div",pt,[(0,i.bF)(s,{line:r.eoi.geometry.geometry_shape,height:"300px"},null,8,["line"])])):"Point"==r.eoi.geometry.geometry_shape.type?((0,i.uX)(),(0,i.CE)("div",mt,[(0,i.bF)(d,{point:r.eoi.geometry.geometry_shape,height:"300px"},null,8,["point"])])):(0,i.Q3)("",!0)])),_:1})):((0,i.uX)(),(0,i.Wv)(u.B,{key:1},{default:(0,i.k6)((()=>[(0,i.bF)(c.L,{align:"center"},{default:(0,i.k6)((()=>[(0,i.bF)(u.B,{class:"d-flex align-center justify-center"},{default:(0,i.k6)((()=>[(0,i.bF)(g.w,{size:"100"},{default:(0,i.k6)((()=>[(0,i.eW)("mdi-map-marker-off")])),_:1})])),_:1})])),_:1})])),_:1}))])),_:1})])),_:1})])),_:1}))])),_:1})}function ft(e,t,o,a,r,n){const l=(0,i.g2)("MapboxMap");return(0,i.uX)(),(0,i.Wv)(y.i,{class:"pa-2",border:"",rounded:"lg",height:o.height},{default:(0,i.k6)((()=>[(0,i.bF)(l,{ref:"mapboxMap",accessToken:a.accessToken,mapStyle:"mapbox://styles/mapbox/satellite-streets-v12",onMbCreated:t[0]||(t[0]=e=>r.map=e),center:n.mapCenter,zoom:o.zoom,style:{height:"100%"}},null,8,["accessToken","center","zoom"])])),_:1},8,["height"])}var bt=o(8035),_t={name:"PolyMap",components:{MapboxMap:bt.ae},props:{polygon:{type:Object,default:()=>({type:"Polygon",coordinates:[[]]})},zoom:{type:Number,default:16},height:{type:String,default:"100%"},width:{type:String,default:"100%"}},setup(){const e="pk.eyJ1IjoibXJiYWlhbyIsImEiOiJjbHlzamJ3NzgwZTF2MmlxdjI1aWFvMDJ3In0.iLJP5hiKMbSd113vFLBRtg";return{accessToken:e}},data(){return{map:null}},watch:{polygon:{handler(e){this.map&&this.map.getSource("polygon").setData({type:"Feature",geometry:e})},deep:!0}},computed:{mapCenter(){const e=this.polygon.coordinates[0],t=e.reduce(((e,[t,o])=>[e[0]+t,e[1]+o]),[0,0]),o=[t[0]/e.length,t[1]/e.length];return o}},mounted(){this.map.on("load",(()=>{this.map.addSource("polygon",{type:"geojson",data:{type:"Feature",geometry:this.polygon}}),this.map.addLayer({id:"polygon",type:"fill",source:"polygon",layout:{},paint:{"fill-color":"#088","fill-opacity":.8}})}))}};const kt=(0,B.A)(_t,[["render",ft]]);var vt=kt;function yt(e,t,o,a,r,n){const l=(0,i.g2)("MapboxMap");return(0,i.uX)(),(0,i.Wv)(y.i,{class:"pa-2",border:"",rounded:"lg",height:o.height},{default:(0,i.k6)((()=>[(0,i.bF)(l,{ref:"mapboxMap",accessToken:a.accessToken,mapStyle:"mapbox://styles/mapbox/satellite-streets-v12",onMbCreated:t[0]||(t[0]=e=>r.map=e),center:n.mapCenter,zoom:o.zoom,style:{height:"100%"}},null,8,["accessToken","center","zoom"])])),_:1},8,["height"])}var Ft={name:"LineMap",components:{MapboxMap:bt.ae},props:{line:{type:Object,default:()=>({type:"LineString",coordinates:[[]]})},zoom:{type:Number,default:16},height:{type:String,default:"100%"},width:{type:String,default:"100%"}},setup(){const e="pk.eyJ1IjoibXJiYWlhbyIsImEiOiJjbHlzamJ3NzgwZTF2MmlxdjI1aWFvMDJ3In0.iLJP5hiKMbSd113vFLBRtg";return{accessToken:e}},data(){return{map:null}},watch:{line:{handler(e){this.map&&this.map.getSource("line").setData({type:"Feature",geometry:e})},deep:!0}},computed:{mapCenter(){const e=this.line.coordinates,t=e.reduce(((e,[t,o])=>[e[0]+t,e[1]+o]),[0,0]),o=[t[0]/e.length,t[1]/e.length];return o}},mounted(){this.map.on("load",(()=>{this.map.addSource("line",{type:"geojson",data:{type:"Feature",geometry:this.line}}),this.map.addLayer({id:"line",type:"line",source:"line",paint:{"line-color":"#088","line-width":8}})}))}};const Lt=(0,B.A)(Ft,[["render",yt]]);var Vt=Lt;function Dt(e,t,o,a,r,n){const l=(0,i.g2)("MapboxMap");return(0,i.uX)(),(0,i.Wv)(y.i,{class:"pa-2",border:"",rounded:"lg",height:o.height},{default:(0,i.k6)((()=>[(0,i.bF)(l,{ref:"mapboxMap",accessToken:a.accessToken,mapStyle:"mapbox://styles/mapbox/satellite-streets-v12",onMbCreated:t[0]||(t[0]=e=>r.map=e),center:n.mapCenter,zoom:o.zoom,style:{height:"100%"}},null,8,["accessToken","center","zoom"])])),_:1},8,["height"])}var St={name:"PointMap",components:{MapboxMap:bt.ae},props:{point:{type:Object,default:()=>({type:"Point",coordinates:[0,0]})},zoom:{type:Number,default:16},height:{type:String,default:"100%"},width:{type:String,default:"100%"}},setup(){const e="pk.eyJ1IjoibXJiYWlhbyIsImEiOiJjbHlzamJ3NzgwZTF2MmlxdjI1aWFvMDJ3In0.iLJP5hiKMbSd113vFLBRtg";return{accessToken:e}},data(){return{map:null}},watch:{point:{handler(e){this.map&&this.map.getSource("point").setData({type:"Feature",geometry:e})},deep:!0}},computed:{mapCenter(){return this.point.coordinates}},mounted(){this.map.on("load",(()=>{this.map.addSource("point",{type:"geojson",data:{type:"Feature",geometry:this.point}}),this.map.addLayer({id:"point",type:"circle",source:"point",paint:{"circle-radius":6,"circle-color":"#880","circle-stroke-width":2,"circle-stroke-color":"#fff"}})}))}};const Et=(0,B.A)(St,[["render",Dt]]);var Pt=Et,At={name:"EoiDetail",components:{PolyMap:vt,LineMap:Vt,PointMap:Pt},props:{eoi_id:Number},setup(){const e=(0,R.E)();return{accountStore:e}},data(){return{eoi:null,isLoading:!1}},methods:{async getEoi(){this.isLoading=!0,await z.A.request({url:"api/eois/"+this.eoi_id,method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.eoi=e.data,this.isLoading=!1})).catch((e=>{console.log(e)}))},formatDate(e){return new Date(e).toLocaleDateString("pt-PT")},reset(){this.eoi=null}},mounted(){this.getEoi()},unmounted(){this.reset()}};const wt=(0,B.A)(At,[["render",ht]]);var xt=wt,Ct=o(1622),Wt=o(4577),Tt=o(5035),Rt=o(6935),zt=o(1950),Ot=o(5296),Bt=o(2067),Mt=o(144),It=o(4587),Xt=o(9094),Ut=o(1247),qt=o(4600);const jt=(0,It.j)({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},hideInput:Boolean,multiple:Boolean,showSize:{type:[Boolean,Number,String],default:!1,validator:e=>"boolean"===typeof e||[1e3,1024].includes(Number(e))},...(0,Tt.V)({prependIcon:"$file"}),modelValue:{type:[Array,Object],default:e=>e.multiple?[]:null,validator:e=>(0,Xt.BN)(e).every((e=>null!=e&&"object"===typeof e))},...(0,Wt.tG)({clearable:!0})},"VFileInput"),Gt=(0,Ut.RW)()({name:"VFileInput",inheritAttrs:!1,props:jt(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,t){let{attrs:o,emit:a,slots:r}=t;const{t:n}=(0,Ot.Ym)(),l=(0,Bt.q)(e,"modelValue",e.modelValue,(e=>(0,Xt.BN)(e)),(t=>e.multiple||Array.isArray(e.modelValue)?t:t[0]??null)),{isFocused:s,focus:d,blur:c}=(0,Rt.i)(e),u=(0,i.EW)((()=>"boolean"!==typeof e.showSize?e.showSize:void 0)),g=(0,i.EW)((()=>(l.value??[]).reduce(((e,t)=>{let{size:o=0}=t;return e+o}),0))),p=(0,i.EW)((()=>(0,Xt.hA)(g.value,u.value))),m=(0,i.EW)((()=>(l.value??[]).map((t=>{const{name:o="",size:i=0}=t;return e.showSize?`${o} (${(0,Xt.hA)(i,u.value)})`:o})))),h=(0,i.EW)((()=>{const t=l.value?.length??0;return e.showSize?n(e.counterSizeString,t,p.value):n(e.counterString,t)})),f=(0,Mt.KR)(),_=(0,Mt.KR)(),k=(0,Mt.KR)(),v=(0,i.EW)((()=>s.value||e.active)),y=(0,i.EW)((()=>["plain","underlined"].includes(e.variant)));function F(){k.value!==document.activeElement&&k.value?.focus(),s.value||d()}function L(e){k.value?.click()}function V(e){a("mousedown:control",e)}function D(e){k.value?.click(),a("click:control",e)}function S(t){t.stopPropagation(),F(),(0,i.dY)((()=>{l.value=[],(0,Xt.P)(e["onClick:clear"],t)}))}return(0,i.wB)(l,(e=>{const t=!Array.isArray(e)||!e.length;t&&k.value&&(k.value.value="")})),(0,qt.C)((()=>{const t=!(!r.counter&&!e.counter),a=!(!t&&!r.details),[n,d]=(0,Xt.ph)(o),{modelValue:u,...E}=Tt.Z.filterProps(e),P=(0,Wt.jz)(e);return(0,i.bF)(Tt.Z,(0,i.v6)({ref:f,modelValue:l.value,"onUpdate:modelValue":e=>l.value=e,class:["v-file-input",{"v-file-input--chips":!!e.chips,"v-file-input--hide":e.hideInput,"v-input--plain-underlined":y.value},e.class],style:e.style,"onClick:prepend":L},n,E,{centerAffix:!y.value,focused:s.value}),{...r,default:t=>{let{id:o,isDisabled:a,isDirty:n,isReadonly:u,isValid:h}=t;return(0,i.bF)(Wt.xR,(0,i.v6)({ref:_,"prepend-icon":e.prependIcon,onMousedown:V,onClick:D,"onClick:clear":S,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},P,{id:o.value,active:v.value||n.value,dirty:n.value||e.dirty,disabled:a.value,focused:s.value,error:!1===h.value}),{...r,default:t=>{let{props:{class:o,...n}}=t;return(0,i.bF)(i.FK,null,[(0,i.bF)("input",(0,i.v6)({ref:k,type:"file",readonly:u.value,disabled:a.value,multiple:e.multiple,name:e.name,onClick:e=>{e.stopPropagation(),u.value&&e.preventDefault(),F()},onChange:e=>{if(!e.target)return;const t=e.target;l.value=[...t.files??[]]},onFocus:F,onBlur:c},n,d),null),(0,i.bF)("div",{class:o},[!!l.value?.length&&!e.hideInput&&(r.selection?r.selection({fileNames:m.value,totalBytes:g.value,totalBytesReadable:p.value}):e.chips?m.value.map((e=>(0,i.bF)(b.x,{key:e,size:"small",text:e},null))):m.value.join(", "))])])}})},details:a?o=>(0,i.bF)(i.FK,null,[r.details?.(o),t&&(0,i.bF)(i.FK,null,[(0,i.bF)("span",null,null),(0,i.bF)(Ct.p,{active:!!l.value?.length,value:h.value,disabled:e.disabled},r.counter)])]):void 0})})),(0,zt.O)({},f,_,k)}});var Nt=o(1720),Jt=o(105),$t=o(6048),Qt=o(1781);const Kt={key:0};function Yt(e,t,o,a,d,g){const m=(0,i.g2)("PolyMap"),b=(0,i.g2)("LineMap"),_=(0,i.g2)("PointMap");return(0,i.uX)(),(0,i.Wv)(k.p,{modelValue:d.dialog,"onUpdate:modelValue":t[12]||(t[12]=e=>d.dialog=e),onAfterLeave:t[13]||(t[13]=e=>g.reset()),width:"auto"},{activator:(0,i.k6)((({props:e})=>[(0,i.bF)(r.D,(0,i.v6)({color:"success",icon:"mdi-plus"},e),null,16)])),default:(0,i.k6)((({})=>[(0,i.bF)(n.J,{class:"mx-auto","min-width":"500"},{default:(0,i.k6)((()=>[(0,i.bF)(l.r,{class:"bg-success d-flex align-center"},{default:(0,i.k6)((()=>[(0,i.eW)((0,h.v_)(d.steps[d.step].title),1)])),_:1}),(0,i.bF)($t.r3,{modelValue:d.step,"onUpdate:modelValue":t[8]||(t[8]=e=>d.step=e)},{default:(0,i.k6)((()=>[(0,i.bF)(Qt.m,{value:0},{default:(0,i.k6)((()=>[(0,i.bF)(s.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(c.L,{justify:"center"},{default:(0,i.k6)((()=>[(0,i.bF)(u.B,{cols:"10"},{default:(0,i.k6)((()=>[(0,i.bF)(w.n,{modelValue:d.steps[d.step].formValid,"onUpdate:modelValue":t[1]||(t[1]=e=>d.steps[d.step].formValid=e)},{default:(0,i.k6)((()=>[(0,i.bF)(Jt.d4,{modelValue:d.eoi.regioninperiod_id,"onUpdate:modelValue":t[0]||(t[0]=e=>d.eoi.regioninperiod_id=e),class:"mt-4",items:d.regionPeriods,label:"Período",placeholder:"Selecione um período","prepend-inner-icon":"mdi-calendar","no-data-text":"Nenhum período encontrado","item-title":"period.period_name","item-value":"regioninperiod_id",density:"compact",variant:"outlined",disabled:d.isLoadingPeriods},{item:(0,i.k6)((({props:e,item:t})=>[(0,i.bF)(Fe.g,(0,i.v6)(e,{subtitle:"Permanente"!=t.raw.period.period_name?g.formatDate(t.raw.period.period_startdate)+" - "+g.formatDate(t.raw.period.period_enddate):""}),null,16,["subtitle"])])),_:1},8,["modelValue","items","disabled"])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),(0,i.bF)(Qt.m,{value:1},{default:(0,i.k6)((()=>[(0,i.bF)(s.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(w.n,{modelValue:d.steps[d.step].formValid,"onUpdate:modelValue":t[4]||(t[4]=e=>d.steps[d.step].formValid=e)},{default:(0,i.k6)((()=>[(0,i.bF)(c.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(u.B,{cols:"6"},{default:(0,i.k6)((()=>[(0,i.bF)(Jt.d4,{modelValue:d.eoi.eoitype_id,"onUpdate:modelValue":t[2]||(t[2]=e=>d.eoi.eoitype_id=e),class:"mt-4",items:d.eoiTypes,label:"Tipo de EOI*",placeholder:"Selecione um tipo","prepend-inner-icon":"mdi-map-marker-alert-outline","no-data-text":"Nenhum tipo de EOI encontrado","item-title":"eoitype_name","item-value":"eoitype_id",density:"compact",variant:"outlined",disabled:d.isLoadingTypes,rules:[d.rules.required]},null,8,["modelValue","items","disabled","rules"])])),_:1}),(0,i.bF)(u.B,{cols:"6"},{default:(0,i.k6)((()=>[(0,i.bF)(Gt,{accept:".json",class:"mt-4",label:"Ficheiro GeoJSON*",placeholder:"Selecione um ficheiro GeoJSON",density:"compact",variant:"outlined",chips:"",clearable:"","prepend-icon":"","prepend-inner-icon":"mdi-file-outline",rules:[d.rules.requiredfile],"onUpdate:modelValue":g.readFile,"onClick:clear":t[3]||(t[3]=e=>d.eoi.eoi_geometry=null)},null,8,["rules","onUpdate:modelValue"])])),_:1}),(0,i.bF)(u.B,{cols:"12"},{default:(0,i.k6)((()=>[d.eoi.eoi_geometry?((0,i.uX)(),(0,i.CE)("div",Kt,["Polygon"==d.eoi.eoi_geometry.type?((0,i.uX)(),(0,i.Wv)(m,{key:0,polygon:d.eoi.eoi_geometry,zoom:17,height:"300px"},null,8,["polygon"])):"LineString"==d.eoi.eoi_geometry.type?((0,i.uX)(),(0,i.Wv)(b,{key:1,line:d.eoi.eoi_geometry,zoom:17,height:"300px"},null,8,["line"])):"Point"==d.eoi.eoi_geometry.type?((0,i.uX)(),(0,i.Wv)(_,{key:2,point:d.eoi.eoi_geometry,zoom:17,height:"300px"},null,8,["point"])):(0,i.Q3)("",!0)])):(0,i.Q3)("",!0)])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}),(0,i.bF)(Qt.m,{value:2},{default:(0,i.k6)((()=>[(0,i.bF)(s.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(w.n,{modelValue:d.steps[2].formValid,"onUpdate:modelValue":t[7]||(t[7]=e=>d.steps[2].formValid=e)},{default:(0,i.k6)((()=>[(0,i.bF)(c.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(u.B,{cols:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(p.W,{modelValue:d.eoi.eoi_name,"onUpdate:modelValue":t[5]||(t[5]=e=>d.eoi.eoi_name=e),modelModifiers:{trim:!0},label:"Nome do EOI*",placeholder:"Insira um nome","prepend-inner-icon":"mdi-tag-text-outline",density:"compact",variant:"outlined",rules:[d.rules.required,d.rules.maxLength]},null,8,["modelValue","rules"])])),_:1}),(0,i.bF)(u.B,{cols:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(x.J,{modelValue:d.eoi.eoi_description,"onUpdate:modelValue":t[6]||(t[6]=e=>d.eoi.eoi_description=e),modelModifiers:{trim:!0},label:"Descrição",placeholder:"Insira a descrição","prepend-inner-icon":"mdi-text-box-outline",density:"compact",variant:"outlined",rules:[d.rules.description]},null,8,["modelValue","rules"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,i.bF)(v.G),(0,i.bF)(f.S,null,{default:(0,i.k6)((()=>[d.step>0?((0,i.uX)(),(0,i.Wv)(r.D,{key:0,"prepend-icon":"mdi-chevron-left",color:"info",variant:"tonal",onClick:t[9]||(t[9]=e=>d.step--)},{default:(0,i.k6)((()=>[(0,i.eW)(" Anterior ")])),_:1})):(0,i.Q3)("",!0),(0,i.bF)(Nt.h),d.step<2?((0,i.uX)(),(0,i.Wv)(r.D,{key:1,disabled:!d.steps[d.step].formValid,"append-icon":"mdi-chevron-right",color:"info",variant:"tonal",onClick:t[10]||(t[10]=e=>d.step++)},{default:(0,i.k6)((()=>[(0,i.eW)(" Próximo ")])),_:1},8,["disabled"])):2===d.step?((0,i.uX)(),(0,i.Wv)(r.D,{key:2,disabled:!d.steps[d.step].formValid,"append-icon":"mdi-check",color:"success",variant:"flat",loading:d.isLoadingPost,onClick:t[11]||(t[11]=e=>g.postEoi())},{default:(0,i.k6)((()=>[(0,i.eW)(" Adicionar ")])),_:1},8,["disabled","loading"])):(0,i.Q3)("",!0)])),_:1})])),_:1})])),_:1},8,["modelValue"])}var Ht={name:"AddEoi",components:{PolyMap:vt,LineMap:Vt,PointMap:Pt},props:{region:{type:Object}},setup(){const e=(0,R.E)(),t=(0,T.T)();return{accountStore:e,generalStore:t}},data(){return{dialog:!1,step:0,steps:[{title:"Período do EOI",formValid:!1},{title:"Tipo e Localização do EOI",formValid:!1},{title:"Dados adicionais do EOI",formValid:!1}],eoiTypes:[],regionPeriods:[{regioninperiod_id:null,period:{period_id:null,period_name:"Permanente",period_startdate:null,period_enddate:null}}],eoi:{eoitype_id:null,region_id:this.region.region_id,regioninperiod_id:null,eoi_name:null,eoi_description:null,eoi_geometry:null},file:null,rules:{required:e=>!!e||"Campo obrigatório",maxLength:e=>e&&e.length<=25||"Máximo de 25 caracteres.",description:e=>e&&e.length<=255||!e||"Máximo de 255 caracteres.",requiredfile:e=>0!=e.length||"Must select at least one file."},isLoadingTypes:!1,isLoadingPeriods:!1,isLoadingPost:!1}},watch:{dialog(e){e&&this.onOpenDialog()},file(e){e&&console.log(e)}},computed:{},methods:{onOpenDialog(){this.getEoiTypes(),this.getRegionPeriods()},async postEoi(){this.isLoadingPost=!0,console.log(this.eoi),await(0,z.A)({url:"api/regions/"+this.region.region_id+"/eois",method:"POST",headers:{Authorization:"Bearer "+this.accountStore.account.token},data:this.eoi}).then((e=>{this.isLoadingPost=!1,this.generalStore.successSnackbar("EOI adicionada com sucesso"),this.dialog=!1,this.$emit("refreshEois")})).catch((e=>{console.error(e),this.isLoadingPost=!1,this.generalStore.errorSnackbar("Erro ao adicionar EOI")}))},async getEoiTypes(){this.isLoadingTypes=!0,await z.A.request({url:"api/eoitypes",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.eoiTypes=e.data,this.isLoadingTypes=!1})).catch((e=>{console.error(e),this.generalStore.errorSnackbar("Erro ao buscar tipos de EOI")}))},async getRegionPeriods(){this.isLoadingPeriods=!0,await z.A.request({url:"api/regions/"+this.region.region_id+"/regionsinperiods",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.regionPeriods.push(...e.data.regioninperiods),this.isLoadingPeriods=!1})).catch((e=>{console.error(e),this.generalStore.errorSnackbar("Erro ao buscar períodos da região")}))},formatDate(e){return new Date(e).toLocaleDateString("pt-PT")},reset(){this.eoi={eoi_type_id:null,region_id:this.region.region_id,regioninperiod_id:null,eoi_name:null,eoi_description:null,eoi_geometry:null},this.file=null,this.step=0,this.eoiTypes=[],this.regionPeriods=[{regioninperiod_id:null,period:{period_id:null,period_name:"Permanente",period_startdate:null,period_enddate:null}}]},readFile(e){if(!e)return;const t=new FileReader;t.onload=e=>{let t=JSON.parse(e.target.result);const o=t.features[0];this.eoi.eoi_geometry=o.geometry,this.eoi.eoi_name=o.properties?.name,this.eoi.eoi_description=o.properties?.description},t.readAsText(e)}}};const Zt=(0,B.A)(Ht,[["render",Yt]]);var eo=Zt;const to=(0,i.Lk)("span",null,"Editar EOI",-1);function oo(e,t,o,d,m,h){return(0,i.uX)(),(0,i.Wv)(k.p,{modelValue:m.dialog,"onUpdate:modelValue":t[7]||(t[7]=e=>m.dialog=e),onAfterLeave:t[8]||(t[8]=e=>h.reset()),width:"auto"},{activator:(0,i.k6)((({props:e})=>[(0,i.bF)(r.D,(0,i.v6)({color:"warning",variant:"text",icon:""},e),{default:(0,i.k6)((()=>[(0,i.bF)(g.w,null,{default:(0,i.k6)((()=>[(0,i.eW)("mdi-pencil")])),_:1}),(0,i.bF)(L.y,{activator:"parent",location:"bottom"},{default:(0,i.k6)((()=>[(0,i.eW)(" Editar ")])),_:1})])),_:2},1040)])),default:(0,i.k6)((({})=>[(0,i.bF)(n.J,{class:"mx-auto",width:"500"},{default:(0,i.k6)((()=>[(0,i.bF)(l.r,{class:"bg-warning d-flex align-center"},{default:(0,i.k6)((()=>[(0,i.bF)(g.w,{size:"small",class:"mr-2"},{default:(0,i.k6)((()=>[(0,i.eW)("mdi-pencil")])),_:1}),to])),_:1}),(0,i.bF)(s.O,null,{default:(0,i.k6)((()=>[m.isLoadingEoi?((0,i.uX)(),(0,i.Wv)(F.V8,{key:0,type:"text",class:"mb-5"})):((0,i.uX)(),(0,i.Wv)(w.n,{key:1,modelValue:m.formValid,"onUpdate:modelValue":t[4]||(t[4]=e=>m.formValid=e)},{default:(0,i.k6)((()=>[(0,i.bF)(c.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(u.B,{cols:"6"},{default:(0,i.k6)((()=>[(0,i.bF)(p.W,{modelValue:m.eoi.eoi_name,"onUpdate:modelValue":t[0]||(t[0]=e=>m.eoi.eoi_name=e),modelModifiers:{trim:!0},label:"Nome",placeholder:"Insira o nome","prepend-inner-icon":"mdi-tag-text-outline",density:"compact",variant:"outlined",rules:[m.rules.required,m.rules.maxLength]},null,8,["modelValue","rules"])])),_:1}),(0,i.bF)(u.B,{cols:"6"},{default:(0,i.k6)((()=>[(0,i.bF)(Jt.d4,{modelValue:m.eoi.eoitype_id,"onUpdate:modelValue":t[1]||(t[1]=e=>m.eoi.eoitype_id=e),items:m.eoiTypes,"item-title":"eoitype_name","item-value":"eoitype_id",label:"Tipo de EOI",placeholder:"Selecione um tipo","prepend-inner-icon":"mdi-map-marker-alert-outline","no-data-text":"Nenhum tipo de EOI encontrado",density:"compact",variant:"outlined",rules:[m.rules.required],disabled:m.isLoadingTypes},null,8,["modelValue","items","rules","disabled"])])),_:1}),(0,i.bF)(u.B,{cols:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(a.V,{modelValue:m.eoi.regioninperiod_id,"onUpdate:modelValue":t[2]||(t[2]=e=>m.eoi.regioninperiod_id=e),items:m.regionPeriods,"item-title":"period.period_name","item-value":"regioninperiod_id",label:"Período",placeholder:"Selecione um período","prepend-inner-icon":"mdi-calendar","no-data-text":"Nenhum período encontrado",density:"compact",variant:"outlined",disabled:m.isLoadingPeriods},{item:(0,i.k6)((({props:e,item:t})=>[(0,i.bF)(Fe.g,(0,i.v6)(e,{subtitle:"Permanente"!=t.raw.period.period_name?h.formatDate(t.raw.period.period_startdate)+" - "+h.formatDate(t.raw.period.period_enddate):""}),null,16,["subtitle"])])),_:1},8,["modelValue","items","disabled"])])),_:1}),(0,i.bF)(u.B,{cols:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(x.J,{modelValue:m.eoi.eoi_description,"onUpdate:modelValue":t[3]||(t[3]=e=>m.eoi.eoi_description=e),modelModifiers:{trim:!0},label:"Descrição",placeholder:"Insira a descrição","prepend-inner-icon":"mdi-text-box-outline",density:"compact",variant:"outlined",rules:[m.rules.description]},null,8,["modelValue","rules"])])),_:1})])),_:1})])),_:1},8,["modelValue"]))])),_:1}),(0,i.bF)(v.G),(0,i.bF)(f.S,{class:"d-flex justify-space-around"},{default:(0,i.k6)((()=>[(0,i.bF)(r.D,{color:"error",variant:"tonal",icon:"mdi-close",onClick:t[5]||(t[5]=e=>m.dialog=!1)}),(0,i.bF)(r.D,{color:"secondary",variant:"tonal",icon:"mdi-check",loading:m.isLoadingEdit,disabled:!m.formValid,onClick:t[6]||(t[6]=e=>h.editEoi())},null,8,["loading","disabled"])])),_:1})])),_:1})])),_:1},8,["modelValue"])}var io={name:"EoiEdit",props:{eoi_id:Number,region:{type:Object}},setup(){const e=(0,R.E)(),t=(0,T.T)();return{accountStore:e,generalStore:t}},data(){return{isLoadingEdit:!1,dialog:!1,eoi:null,isLoadingEoi:!1,formValid:!1,rules:{required:e=>!!e||"Campo obrigatório",maxLength:e=>e&&e.length<=25||"Máximo de 25 caracteres.",description:e=>e&&e.length<=255||!e||"Máximo de 255 caracteres."},isLoadingTypes:!1,eoiTypes:[],isLoadingPeriods:!1,regionPeriods:[{regioninperiod_id:null,period:{period_id:null,period_name:"Permanente",period_startdate:null,period_enddate:null}}]}},watch:{dialog(e){e&&this.onOpenDialog()}},methods:{async onOpenDialog(){this.isLoadingEoi=!0,await this.getEoi(),await this.getEoiTypes(),await this.getRegionPeriods(),this.isLoadingEoi=!1},async getEoi(){this.isLoadingEoi=!0,await z.A.request({url:"api/eois/"+this.eoi_id,method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.eoi={eoi_name:e.data.eoi_name,eoitype_id:e.data.element_of_interest_type.eoitype_id,regioninperiod_id:e.data.region_in_period?.regioninperiod_id,eoi_description:e.data.eoi_description},this.isLoadingEoi=!1})).catch((e=>{this.isLoadingEoi=!1,console.log(e)}))},async editEoi(){this.isLoadingEdit=!0;let e={eoitype_id:this.eoi.eoitype_id,regioninperiod_id:this.eoi.regioninperiod_id,eoi_name:this.eoi.eoi_name,eoi_description:this.eoi.eoi_description};console.log(e),await z.A.request({url:"api/eois/"+this.eoi_id,method:"patch",headers:{Authorization:"Bearer "+this.accountStore.account.token},data:e}).then((()=>{this.isLoadingEdit=!1,this.dialog=!1,this.generalStore.successSnackbar("EOI editado com sucesso"),this.$emit("refresh")})).catch((e=>{console.error(e),this.isLoadingEdit=!1,this.generalStore.errorSnackbar("Erro ao editar EOI")}))},async getEoiTypes(){this.isLoadingTypes=!0,await z.A.request({url:"api/eoitypes",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.isLoadingTypes=!1,this.eoiTypes=e.data})).catch((e=>{console.error(e),this.isLoadingTypes=!1,this.generalStore.errorSnackbar("Erro ao buscar tipos de EOI")}))},async getRegionPeriods(){this.isLoadingPeriods=!0,await z.A.request({url:"api/regions/"+this.region.region_id+"/regionsinperiods",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.isLoadingPeriods=!1,this.regionPeriods.push(...e.data.regioninperiods)})).catch((e=>{console.error(e),this.isLoadingPeriods=!1,this.generalStore.errorSnackbar("Erro ao buscar períodos da região")}))},formatDate(e){return new Date(e).toLocaleDateString("pt-PT")},reset(){this.eoi=null,this.eoiTypes=[],this.isLoadingEdit=!1,this.isLoadingEoi=!1,this.regionPeriods=[{regioninperiod_id:null,period:{period_id:null,period_name:"Permanente",period_startdate:null,period_enddate:null}}]}}};const ao=(0,B.A)(io,[["render",oo]]);var ro=ao,no={name:"EOIsDetail",components:{EoiDetail:xt,AddEoi:eo,EoiEdit:ro},props:{region:{type:Object}},setup(){const e=(0,R.E)(),t=(0,T.T)();return{accountStore:e,generalStore:t}},data(){return{isLoading:!1,eois:[],limit:5,offset:0,hasMore:!1,filter:{eoi_name:null,regioninperiod_id:null},regionPeriods:[{regioninperiod_id:0,period:{period_name:"Permanente"}}],isPeriodsLoading:!1,limitPeriods:5,offsetPeriods:0,hasMorePeriods:!1,deleteDialog:!1,eoiToDelete:{eoi_id:0,eoi_name:"",eoi_type:""},isLoadingDelete:!1}},computed:{},methods:{formatDate(e){return new Date(e).toLocaleDateString("pt-PT")},async getRegionPeriods(){this.isPeriodsLoading=!0,await z.A.request({url:"api/regions/"+this.region.region_id+"/regionsinperiods",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token},params:{limit:this.limitPeriods,offset:this.offsetPeriods}}).then((e=>{let t=e.data.regioninperiods;this.regionPeriods.push(...t),this.offsetPeriods+=t.length,this.hasMorePeriods=e.data.hasMore,this.isPeriodsLoading=!1})).catch((e=>{console.error(e),this.isPeriodsLoading=!1}))},loadMorePeriods(e){e&&this.getRegionPeriods()},async getRegionEOIs(){await z.A.request({url:"api/regions/"+this.region.region_id+"/eois",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token},params:{limit:this.limit,offset:this.offset,eoi_name:this.filter.eoi_name,regioninperiod_id:this.filter.regioninperiod_id}}).then((e=>{let t=e.data.eois;this.eois.push(...t),this.offset+=t.length,this.hasMore=e.data.hasMore})).catch((e=>{console.error(e)}))},loadMore(e){e&&this.getRegionEOIs()},getEoiIcon(e){switch(e.element_of_interest_type.eoitype_name){case"Árvore":return"mdi-tree";case"Linha":return"mdi-vector-line";case"Entrada":return"mdi-gate";case"Lago":return"mdi-water";case"Armadilha":return"mdi-bug";default:return"mdi-help-circle"}},openDeleteDialog(e){this.eoiToDelete={eoi_id:e.eoi_id,eoi_name:e.eoi_name,eoi_type:e.element_of_interest_type.eoitype_name},this.deleteDialog=!0},resetDeleteDialog(){this.eoiToDelete={eoi_id:0,eoi_name:"",eoi_type:""}},deleteEOI(){this.isLoadingDelete=!0,z.A.request({url:"api/regions/"+this.region.region_id+"/eois/"+this.eoiToDelete.eoi_id,method:"DELETE",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.isLoadingDelete=!1,this.generalStore.successSnackbar("Elemento de interesse removido com sucesso"),this.searchEOIs(),this.deleteDialog=!1})).catch((e=>{console.error(e),this.isLoadingDelete=!1,this.generalStore.errorSnackbar(e.response.data.error,3e3)}))},searchEOIs(){this.eois=[],this.offset=0,this.hasMore=!1,this.getRegionEOIs()},refreshEOIs(){console.log("refreshing EOIs"),this.eois=[],this.offset=0,this.hasMore=!0,this.getRegionEOIs(),this.regionPeriods=[{regioninperiod_id:0,period:{period_name:"Permanente"}}],this.offsetPeriods=0,this.hasMorePeriods=!0,this.getRegionPeriods()}},mounted(){this.isLoading=!0,this.getRegionEOIs().then((()=>{this.isLoading=!1})),this.getRegionPeriods()},unmounted(){this.eois=[],this.filter={eoi_name:null}}};const lo=(0,B.A)(no,[["render",et],["__scopeId","data-v-33686690"]]);var so=lo;const co=e=>((0,i.Qi)("data-v-ee95d61e"),e=e(),(0,i.jt)(),e),uo=co((()=>(0,i.Lk)("span",{class:"text-h4"},"Períodos associados",-1))),go=["colspan"],po=co((()=>(0,i.Lk)("span",null,"Remover perído da região",-1)));function mo(e,t,o,a,d,c){const u=(0,i.g2)("AddRegionPeriod"),p=(0,i.g2)("EnemiesinPeriod");return(0,i.uX)(),(0,i.Wv)(n.J,{elevation:"0",border:"",rounded:"",class:"pa-5",height:"85%","min-height":"350"},{default:(0,i.k6)((()=>[(0,i.bF)(l.r,{class:"d-flex justify-space-between align-center"},{default:(0,i.k6)((()=>[uo,a.accountStore.hasRole(["Produtor","Organização","Administrador"])?((0,i.uX)(),(0,i.Wv)(u,{key:0,region:o.region,regioninperiods:d.periods,class:"mb-5",onRefreshRegionPeriods:t[0]||(t[0]=e=>c.refreshPeriods())},null,8,["region","regioninperiods"])):(0,i.Q3)("",!0)])),_:1}),(0,i.bF)(s.O,{class:"mt-5"},{default:(0,i.k6)((()=>[(0,i.bF)(_.g,{"fixed-headers":"","no-data-text":"Sem períodos associados",headers:d.headers,items:c.tableItems,loading:d.isLoading},(0,i.eX)({item:(0,i.k6)((e=>[(0,i.Lk)("tr",{class:(0,h.C4)(c.isCurrent(e)?"current":"")},[(0,i.Lk)("td",null,(0,h.v_)(e.item.name),1),(0,i.Lk)("td",null,(0,h.v_)(e.item.type),1),(0,i.Lk)("td",null,(0,h.v_)(e.item.start_date),1),(0,i.Lk)("td",null,(0,h.v_)(e.item.end_date),1),(0,i.Lk)("td",null,[(0,i.bF)(r.D,{color:"secondary",variant:"text",icon:"",onClick:t=>c.openEnemiesDialog(e.item)},{default:(0,i.k6)((()=>[(0,i.bF)(g.w,null,{default:(0,i.k6)((()=>[(0,i.eW)("mdi-bug")])),_:1}),(0,i.bF)(L.y,{activator:"parent",location:"bottom"},{default:(0,i.k6)((()=>[(0,i.eW)(" Inimigos ")])),_:1})])),_:2},1032,["onClick"]),a.accountStore.hasRole(["Produtor","Organização","Administrador"])?((0,i.uX)(),(0,i.Wv)(r.D,{key:0,color:"error",variant:"text",icon:"",onClick:t=>c.openDeleteDialog(e.item)},{default:(0,i.k6)((()=>[(0,i.bF)(g.w,null,{default:(0,i.k6)((()=>[(0,i.eW)("mdi-delete-outline")])),_:1}),(0,i.bF)(L.y,{activator:"parent",location:"bottom"},{default:(0,i.k6)((()=>[(0,i.eW)(" Remover ")])),_:1})])),_:2},1032,["onClick"])):(0,i.Q3)("",!0)])],2)])),_:2},[d.hasMore&&!d.isLoading?{name:"body.append",fn:(0,i.k6)((()=>[(0,i.bo)(((0,i.uX)(),(0,i.CE)("tr",null,[(0,i.Lk)("td",{colspan:d.headers.length,class:"text-center"},[(0,i.bF)(F.V8,{type:"table-row"})],8,go)])),[[V.o,{handler:c.loadMore,options:{threshold:.5}},void 0,{quiet:!0}]])])),key:"0"}:void 0]),1032,["headers","items","loading"]),(0,i.bF)(k.p,{modelValue:d.deleteDialog,"onUpdate:modelValue":t[3]||(t[3]=e=>d.deleteDialog=e),persistent:"",width:"auto",onAfterLeave:c.resetDeleteDialog},{default:(0,i.k6)((()=>[(0,i.bF)(n.J,{width:"40rem"},{default:(0,i.k6)((()=>[(0,i.bF)(l.r,{class:"bg-error d-flex align-center"},{default:(0,i.k6)((()=>[(0,i.bF)(g.w,{size:"small",class:"mr-2"},{default:(0,i.k6)((()=>[(0,i.eW)("mdi-delete-outline")])),_:1}),po])),_:1}),(0,i.bF)(s.O,null,{default:(0,i.k6)((()=>[(0,i.Lk)("span",null,[(0,i.eW)("Tem a certeza que quer remover: "),(0,i.Lk)("b",null,(0,h.v_)(d.periodToDelete.period_name),1)])])),_:1}),(0,i.bF)(v.G),(0,i.bF)(f.S,{class:"d-flex justify-space-around"},{default:(0,i.k6)((()=>[(0,i.bF)(r.D,{color:"error",variant:"tonal",icon:"mdi-close",onClick:t[1]||(t[1]=e=>d.deleteDialog=!1)}),(0,i.bF)(r.D,{color:"secondary",variant:"tonal",icon:"mdi-check",loading:d.isLoadingDelete,onClick:t[2]||(t[2]=e=>c.deleteRegionPeriod())},null,8,["loading"])])),_:1})])),_:1})])),_:1},8,["modelValue","onAfterLeave"]),(0,i.bF)(p,{region:o.region,regioninperiod:d.period,dialog:d.enemiesDialog,"onUpdate:dialog":t[4]||(t[4]=e=>d.enemiesDialog=e)},null,8,["region","regioninperiod","dialog"])])),_:1})])),_:1})}function ho(e,t,o,d,g,p){return(0,i.uX)(),(0,i.Wv)(k.p,{modelValue:g.dialog,"onUpdate:modelValue":t[8]||(t[8]=e=>g.dialog=e),onAfterLeave:t[9]||(t[9]=e=>p.reset()),width:"auto"},{activator:(0,i.k6)((({props:e})=>[(0,i.bF)(r.D,(0,i.v6)({color:"success",icon:"mdi-plus"},e),null,16)])),default:(0,i.k6)((({})=>[(0,i.bF)(n.J,{class:"mx-auto","min-width":"500"},{default:(0,i.k6)((()=>[(0,i.bF)(l.r,{class:"bg-success"},{default:(0,i.k6)((()=>[(0,i.eW)((0,h.v_)(g.steps[g.step].title),1)])),_:1}),(0,i.bF)($t.r3,{modelValue:g.step,"onUpdate:modelValue":t[4]||(t[4]=e=>g.step=e)},{default:(0,i.k6)((()=>[(0,i.bF)(Qt.m,{value:0},{default:(0,i.k6)((()=>[(0,i.bF)(s.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(c.L,{justify:"center"},{default:(0,i.k6)((()=>[(0,i.bF)(u.B,{cols:"10"},{default:(0,i.k6)((()=>[(0,i.bF)(w.n,{modelValue:g.steps[g.step].formValid,"onUpdate:modelValue":t[1]||(t[1]=e=>g.steps[g.step].formValid=e)},{default:(0,i.k6)((()=>[(0,i.bF)(a.V,{modelValue:g.periodTypeSelected,"onUpdate:modelValue":t[0]||(t[0]=e=>g.periodTypeSelected=e),class:"mt-4",items:g.periodTypes,label:"Tipo de Período*",placeholder:"Selecione um tipo","no-data-text":"Sem resultados","item-title":"periodtype_name","item-value":"periodtype_id",density:"compact",variant:"outlined",clearable:"",disabled:g.isLoadingTypes,loading:g.isLoadingPeriods,rules:[e=>!!e||"Selecione um tipo"]},null,8,["modelValue","items","disabled","loading","rules"])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),(0,i.bF)(Qt.m,{value:1},{default:(0,i.k6)((()=>[(0,i.bF)(s.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(c.L,{justify:"center"},{default:(0,i.k6)((()=>[(0,i.bF)(u.B,{cols:"10"},{default:(0,i.k6)((()=>[(0,i.bF)(w.n,{modelValue:g.steps[g.step].formValid,"onUpdate:modelValue":t[3]||(t[3]=e=>g.steps[g.step].formValid=e)},{default:(0,i.k6)((()=>[(0,i.bF)(a.V,{modelValue:g.regioninperiod.period_id,"onUpdate:modelValue":t[2]||(t[2]=e=>g.regioninperiod.period_id=e),class:"mt-4",items:p.selectPeriodItems,label:"Período*",placeholder:"Selecione um período","no-data-text":"Sem resultados","item-title":"period_name","item-value":"period_id",density:"compact",variant:"outlined",clearable:"",disabled:g.isLoadingPeriods,rules:[e=>!!e||"Selecione um período"]},{item:(0,i.k6)((({props:e,item:t})=>[(0,i.bF)(Fe.g,(0,i.v6)(e,{subtitle:p.formatDate(t.raw.period_startdate)+" - "+p.formatDate(t.raw.period_enddate)}),null,16,["subtitle"])])),_:1},8,["modelValue","items","disabled","rules"])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,i.bF)(v.G),(0,i.bF)(f.S,null,{default:(0,i.k6)((()=>[g.step>0?((0,i.uX)(),(0,i.Wv)(r.D,{key:0,"prepend-icon":"mdi-chevron-left",color:"info",variant:"tonal",onClick:t[5]||(t[5]=e=>g.step--)},{default:(0,i.k6)((()=>[(0,i.eW)(" Anterior ")])),_:1})):(0,i.Q3)("",!0),(0,i.bF)(Nt.h),g.step<1?((0,i.uX)(),(0,i.Wv)(r.D,{key:1,disabled:!g.steps[g.step].formValid,"append-icon":"mdi-chevron-right",color:"info",variant:"tonal",onClick:t[6]||(t[6]=e=>g.step++)},{default:(0,i.k6)((()=>[(0,i.eW)(" Próximo ")])),_:1},8,["disabled"])):1===g.step?((0,i.uX)(),(0,i.Wv)(r.D,{key:2,disabled:!g.steps[g.step].formValid,"append-icon":"mdi-check",color:"success",variant:"flat",loading:g.isLoadingPost,onClick:t[7]||(t[7]=e=>p.postRegionPeriod())},{default:(0,i.k6)((()=>[(0,i.eW)(" Adicionar ")])),_:1},8,["disabled","loading"])):(0,i.Q3)("",!0)])),_:1})])),_:1})])),_:1},8,["modelValue"])}var fo={name:"AddRegionPeriod",props:{region:Object,regioninperiods:Array},setup(){const e=(0,R.E)(),t=(0,T.T)();return{accountStore:e,generalStore:t}},data(){return{dialog:!1,step:0,steps:[{title:"Tipo de Período",formValid:!1},{title:"Período",formValid:!1}],periodTypes:[],periodTypeSelected:null,periods:[],regioninperiod:{region_id:this.region.region_id,period_id:null},isLoadingTypes:!1,isLoadingPeriods:!1,isLoadingPost:!1}},watch:{dialog(e){e&&this.onOpenDialog()},periodTypeSelected(e){e&&this.getPeriods()}},computed:{selectPeriodItems(){return this.periods.filter((e=>!this.existingPeriods.includes(e.period_id)))},existingPeriods(){return this.regioninperiods.map((e=>e.period_id))}},methods:{onOpenDialog(){this.getPeriodTypes()},async postRegionPeriod(){this.isLoadingPost=!0,console.log(this.regioninperiod),await z.A.request({url:"api/regionsinperiods",method:"POST",headers:{Authorization:"Bearer "+this.accountStore.account.token},data:this.regioninperiod}).then((e=>{this.isLoadingPost=!1,this.generalStore.successSnackbar("Período adicionado com sucesso"),this.$emit("refreshRegionPeriods"),this.dialog=!1})).catch((e=>{console.error(e),this.generalStore.errorSnackbar("Erro ao adicionar período"),this.isLoadingPost=!1}))},async getPeriodTypes(){this.isLoadingTypes=!0,await z.A.request({url:"api/periodtypes",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token},params:{periodtype_id:this.periodTypeSelected}}).then((e=>{this.periodTypes=e.data,this.isLoadingTypes=!1})).catch((e=>{console.error(e),this.generalStore.errorSnackbar("Erro ao buscar tipos de período"),this.isLoadingTypes=!1}))},async getPeriods(){this.isLoadingPeriods=!0,await z.A.request({url:"api/periods",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.periods=e.data.periods,this.isLoadingPeriods=!1})).catch((e=>{console.error(e),this.generalStore.errorSnackbar("Erro ao buscar períodos"),this.isLoadingPeriods=!1}))},formatDate(e){return new Date(e).toLocaleDateString("pt-PT")},reset(){this.regioninperiod={region_id:this.region.region_id,period_id:null},this.periodTypeSelected=null,this.periodTypes=[],this.periods=[],this.isLoadingTypes=!1,this.isLoadingPeriods=!1,this.isLoadingPost=!1,this.step=0}}};const bo=(0,B.A)(fo,[["render",ho]]);var _o=bo;const ko=e=>((0,i.Qi)("data-v-24609b08"),e=e(),(0,i.jt)(),e),vo=ko((()=>(0,i.Lk)("span",null," Protocolos ",-1))),yo={class:"text-subtitle-1"},Fo=ko((()=>(0,i.Lk)("br",null,null,-1))),Lo={class:"text-subtitle-1"},Vo={class:"text-end"};function Do(e,t,o,a,d,p){const m=(0,i.g2)("AddProtocolToPeriod");return(0,i.uX)(),(0,i.Wv)(k.p,{modelValue:p.localDialog,"onUpdate:modelValue":t[1]||(t[1]=e=>p.localDialog=e),onAfterLeave:t[2]||(t[2]=e=>p.reset()),width:"auto"},{default:(0,i.k6)((()=>[(0,i.bF)(n.J,{class:"mx-auto","min-width":"500"},{default:(0,i.k6)((()=>[(0,i.bF)(l.r,{class:"bg-secondary"},{default:(0,i.k6)((()=>[vo])),_:1}),(0,i.bF)(s.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(c.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(u.B,{cols:"10"},{default:(0,i.k6)((()=>[(0,i.Lk)("span",yo,[(0,i.eW)(" Parcela: "),(0,i.Lk)("b",null,(0,h.v_)(o.region.region_name),1)]),Fo,(0,i.Lk)("span",Lo,[(0,i.eW)(" Periodo: "),(0,i.Lk)("b",null,(0,h.v_)(o.regioninperiod.name),1)])])),_:1}),(0,i.bF)(u.B,{cols:"2"},{default:(0,i.k6)((()=>[a.accountStore.hasRole(["Administrador","Organização","Produtor"])?((0,i.uX)(),(0,i.Wv)(m,{key:0,region:o.region,regioninperiod:o.regioninperiod,onRefresh:t[0]||(t[0]=e=>p.getProtocols())},null,8,["region","regioninperiod"])):(0,i.Q3)("",!0)])),_:1})])),_:1}),(0,i.bF)(c.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(y.i,{class:"pa-2 scrollable",border:"",rounded:""},{default:(0,i.k6)((()=>[(0,i.bF)(_.g,{headers:d.headers,items:d.protocols,loading:d.isLoadingProtocols,"no-data-text":"Sem protocolos"},{item:(0,i.k6)((e=>[(0,i.Lk)("tr",null,[(0,i.Lk)("td",null,(0,h.v_)(e.item.protocol_shortname),1),(0,i.Lk)("td",Vo,[a.accountStore.hasRole(["Produtor","Organização","Administrador"])?((0,i.uX)(),(0,i.Wv)(r.D,{key:0,color:"red",variant:"text",icon:"",onClick:t=>p.deleteProtocolInPeriod(e.item)},{default:(0,i.k6)((()=>[(0,i.bF)(g.w,null,{default:(0,i.k6)((()=>[(0,i.eW)("mdi-delete-outline")])),_:1}),(0,i.bF)(L.y,{activator:"parent",location:"bottom"},{default:(0,i.k6)((()=>[(0,i.eW)(" Remover ")])),_:1})])),_:2},1032,["onClick"])):(0,i.Q3)("",!0)])])])),_:1},8,["headers","items","loading"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])}const So=(0,i.Lk)("span",{class:"text-subtitle-1 text-medium-emphasis"}," Protocolo ",-1);function Eo(e,t,o,d,c,u){return(0,i.uX)(),(0,i.Wv)(k.p,{modelValue:c.dialog,"onUpdate:modelValue":t[3]||(t[3]=e=>c.dialog=e),onAfterLeave:t[4]||(t[4]=e=>u.reset()),width:"auto"},{activator:(0,i.k6)((({props:e})=>[(0,i.bF)(r.D,(0,i.v6)({color:"info",icon:"mdi-plus"},e),null,16)])),default:(0,i.k6)((({})=>[(0,i.bF)(n.J,{class:"mx-auto","min-width":"400"},{default:(0,i.k6)((()=>[(0,i.bF)(l.r,{class:"bg-secondary"},{default:(0,i.k6)((()=>[(0,i.eW)(" Adicionar Protocolo ")])),_:1}),(0,i.bF)(s.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(w.n,{modelValue:c.formValid,"onUpdate:modelValue":t[1]||(t[1]=e=>c.formValid=e)},{default:(0,i.k6)((()=>[So,(0,i.bF)(a.V,{modelValue:c.protocol,"onUpdate:modelValue":t[0]||(t[0]=e=>c.protocol=e),class:"mt-4",items:c.protocols,"item-title":"protocol_shortname","item-value":"protocol_id",placeholder:"Selecione um protocolo",color:"secondary",density:"compact",variant:"outlined",disabled:c.isLoadingProtocols,rules:[e=>!!e||"Selecione um protocolo"]},null,8,["modelValue","items","disabled","rules"])])),_:1},8,["modelValue"])])),_:1}),(0,i.bF)(v.G),(0,i.bF)(f.S,{class:"d-flex justify-space-between"},{default:(0,i.k6)((()=>[(0,i.bF)(r.D,{onClick:t[2]||(t[2]=e=>c.dialog=!1)},{default:(0,i.k6)((()=>[(0,i.eW)("Cancelar")])),_:1}),(0,i.bF)(r.D,{color:"info",variant:"flat",onClick:u.addProtocol,loading:c.isLoadingPost,disabled:!c.formValid},{default:(0,i.k6)((()=>[(0,i.eW)(" Adicionar ")])),_:1},8,["onClick","loading","disabled"])])),_:1})])),_:1})])),_:1},8,["modelValue"])}var Po={name:"AddProtocolToPeriod",props:{region:Object,regioninperiod:Object},setup(){const e=(0,R.E)(),t=(0,T.T)();return{accountStore:e,generalStore:t}},data(){return{dialog:!1,protocols:[],isLoadingProtocols:!1,protocol:null,isLoadingPost:!1,formValid:!1}},watch:{dialog(e){e&&this.onOpenDialog()}},methods:{onOpenDialog(){this.getProtocols()},reset(){this.protocols=[],this.isLoadingProtocols=!1,this.protocol=null,this.isLoadingPost=!1},async getProtocols(){this.isLoadingProtocols=!0,await z.A.request({url:"api/protocols",method:"GET",headers:{Authorization:`Bearer ${this.accountStore.account.token}`}}).then((e=>{this.protocols=e.data,this.isLoadingProtocols=!1})).catch((e=>{console.error(e),this.isLoadingProtocols=!1,this.generalStore.errorSnackbar("Erro ao buscar protocolos")}))},async addProtocol(){this.isLoadingPost=!0;let e={regioninperiod_id:this.regioninperiod.regioninperiod_id,protocol_id:this.protocol};console.log(e),await z.A.request({url:"api/protocolsinregions",method:"POST",headers:{Authorization:`Bearer ${this.accountStore.account.token}`},data:e}).then((e=>{this.isLoadingPost=!1,this.generalStore.successSnackbar("Protocolo adicionado com sucesso"),this.$emit("refresh"),this.dialog=!1})).catch((e=>{console.error(e),this.isLoadingPost=!1,this.generalStore.errorSnackbar("Erro ao adicionar protocolo")}))}}};const Ao=(0,B.A)(Po,[["render",Eo]]);var wo=Ao,xo={name:"ProtocolsinPeriod",components:{AddProtocolToPeriod:wo},props:{region:{type:Object},regioninperiod:{type:Object,required:!0},dialog:{type:Boolean,required:!0}},setup(){const e=(0,T.T)(),t=(0,R.E)();return{generalStore:e,accountStore:t}},data(){return{protocols:[],isLoadingProtocols:!1,headers:[{title:"Nome do Protocolo"},{title:""}],isLoadingDelete:!1}},watch:{dialog(e){e&&this.onOpenDialog()}},computed:{localDialog:{get(){return this.dialog},set(e){this.$emit("update:dialog",e)}}},methods:{onOpenDialog(){console.log(this.regioninperiod),this.getProtocols()},reset(){this.protocols=[]},async getProtocols(){this.isLoadingProtocols=!0,await z.A.request({url:`api/regionsinperiods/${this.regioninperiod.regioninperiod_id}/protocolsinregions`,method:"GET",headers:{Authorization:`Bearer ${this.accountStore.account.token}`}}).then((e=>{this.isLoadingProtocols=!1,this.protocols=e.data.protocols})).catch((e=>{this.isLoadingProtocols=!1,console.error(e),this.generalStore.errorSnackbar("Erro ao carregar protocolos.")}))},async deleteProtocolInPeriod(e){this.isLoadingDelete=!0,console.log(e),await z.A.request({url:`api/protocolsinregions/${e.protocolonregioninperiod_id}`,method:"DELETE",headers:{Authorization:`Bearer ${this.accountStore.account.token}`}}).then((()=>{this.isLoadingDelete=!1,this.generalStore.successSnackbar("Protocolo removido com sucesso."),this.getProtocols()})).catch((e=>{this.isLoadingDelete=!1,console.error(e),this.generalStore.errorSnackbar("Erro ao remover protocolo.")}))}}};const Co=(0,B.A)(xo,[["render",Do],["__scopeId","data-v-24609b08"]]);var Wo=Co;const To=e=>((0,i.Qi)("data-v-7cb0c926"),e=e(),(0,i.jt)(),e),Ro={class:"text-subtitle-1"},zo=To((()=>(0,i.Lk)("br",null,null,-1))),Oo={class:"text-subtitle-1"},Bo={class:"text-end"};function Mo(e,t,o,a,d,p){const m=(0,i.g2)("AddEnemyToPeriod");return(0,i.uX)(),(0,i.Wv)(k.p,{modelValue:p.localDialog,"onUpdate:modelValue":t[1]||(t[1]=e=>p.localDialog=e),onAfterLeave:t[2]||(t[2]=e=>p.reset()),width:"auto"},{default:(0,i.k6)((()=>[(0,i.bF)(n.J,{class:"mx-auto","min-width":"500"},{default:(0,i.k6)((()=>[(0,i.bF)(l.r,{class:"bg-secondary"},{default:(0,i.k6)((()=>[(0,i.eW)("Inimigos a Estudar")])),_:1}),(0,i.bF)(s.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(c.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(u.B,{cols:"10"},{default:(0,i.k6)((()=>[(0,i.Lk)("span",Ro,[(0,i.eW)(" Parcela: "),(0,i.Lk)("b",null,(0,h.v_)(o.region.region_name),1)]),zo,(0,i.Lk)("span",Oo,[(0,i.eW)(" Periodo: "),(0,i.Lk)("b",null,(0,h.v_)(o.regioninperiod.name),1)])])),_:1}),(0,i.bF)(u.B,{cols:"2"},{default:(0,i.k6)((()=>[a.accountStore.hasRole(["Administrador","Organização","Produtor"])?((0,i.uX)(),(0,i.Wv)(m,{key:0,region:o.region,regioninperiod:o.regioninperiod,existingEnemies:p.existingEnemies,onRefresh:t[0]||(t[0]=e=>p.getEnemies())},null,8,["region","regioninperiod","existingEnemies"])):(0,i.Q3)("",!0)])),_:1}),(0,i.bF)(c.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(y.i,{class:"pa-2 ma-2 scrollable",border:"",rounded:""},{default:(0,i.k6)((()=>[(0,i.bF)(_.g,{headers:d.headers,items:d.enemies,loading:d.isLoadingEnemies,"no-data-text":"Sem inimigos"},{item:(0,i.k6)((e=>[(0,i.Lk)("tr",null,[(0,i.Lk)("td",null,(0,h.v_)(e.item.enemy.enemy_name),1),(0,i.Lk)("td",Bo,[a.accountStore.hasRole(["Produtor","Organização","Administrador"])?((0,i.uX)(),(0,i.Wv)(r.D,{key:0,color:"error",variant:"text",disabled:d.isLoadingDelete,icon:"",onClick:t=>p.deleteEnemyInPeriod(e.item)},{default:(0,i.k6)((()=>[(0,i.bF)(g.w,null,{default:(0,i.k6)((()=>[(0,i.eW)("mdi-delete-outline")])),_:1}),(0,i.bF)(L.y,{activator:"parent",location:"bottom"},{default:(0,i.k6)((()=>[(0,i.eW)(" Remover ")])),_:1})])),_:2},1032,["disabled","onClick"])):(0,i.Q3)("",!0)])])])),_:1},8,["headers","items","loading"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])}function Io(e,t,o,d,c,u){return(0,i.uX)(),(0,i.Wv)(k.p,{modelValue:c.dialog,"onUpdate:modelValue":t[3]||(t[3]=e=>c.dialog=e),onAfterLeave:t[4]||(t[4]=e=>u.reset()),width:"auto"},{activator:(0,i.k6)((({props:e})=>[(0,i.bF)(r.D,(0,i.v6)({color:"success",icon:"mdi-plus"},e),null,16)])),default:(0,i.k6)((({})=>[(0,i.bF)(n.J,{class:"mx-auto","min-width":"400"},{default:(0,i.k6)((()=>[(0,i.bF)(l.r,{class:"bg-success"},{default:(0,i.k6)((()=>[(0,i.eW)("Adicionar Inimigo")])),_:1}),(0,i.bF)(s.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(w.n,{modelValue:c.formValid,"onUpdate:modelValue":t[1]||(t[1]=e=>c.formValid=e)},{default:(0,i.k6)((()=>[(0,i.bF)(a.V,{modelValue:c.enemy,"onUpdate:modelValue":t[0]||(t[0]=e=>c.enemy=e),class:"mt-4",label:"Inimigo",placeholder:"Selecione um inimigo","prepend-inner-icon":"mdi-bug",items:u.selectItems,"item-title":"enemy_name","item-value":"enemy_id",density:"compact",variant:"outlined",loading:c.isLoadingEnemies,rules:[e=>!!e||"Campo obrigatório"]},null,8,["modelValue","items","loading","rules"])])),_:1},8,["modelValue"])])),_:1}),(0,i.bF)(v.G),(0,i.bF)(f.S,{class:"d-flex justify-space-between"},{default:(0,i.k6)((()=>[(0,i.bF)(r.D,{color:"error",variant:"tonal",onClick:t[2]||(t[2]=e=>c.dialog=!1)},{default:(0,i.k6)((()=>[(0,i.eW)("Cancelar")])),_:1}),(0,i.bF)(r.D,{color:"success",variant:"flat",onClick:u.postEnemy,loading:c.isLoadingPost,disabled:!c.formValid},{default:(0,i.k6)((()=>[(0,i.eW)(" Adicionar ")])),_:1},8,["onClick","loading","disabled"])])),_:1})])),_:1})])),_:1},8,["modelValue"])}var Xo={name:"AddEnemyToPeriod",props:{region:Object,regioninperiod:Object,existingEnemies:Array},setup(){const e=(0,R.E)(),t=(0,T.T)();return{accountStore:e,generalStore:t}},data(){return{dialog:!1,enemies:[],isLoadingEnemies:!1,enemy:null,isLoadingPost:!1,formValid:!1}},watch:{dialog(e){e&&this.onOpenDialog()}},computed:{selectItems(){let e=this.enemies.filter((e=>1!=e.enemytype_id));return e.filter((e=>!this.existingEnemies.some((t=>t.enemy_id===e.enemy_id))))}},methods:{onOpenDialog(){this.getEnemies()},reset(){this.enemies=[],this.isLoadingEnemies=!1,this.enemy=null,this.isLoadingPost=!1},async getEnemies(){this.isLoadingEnemies=!0,await z.A.request({url:"api/enemies",method:"GET",headers:{Authorization:`Bearer ${this.accountStore.account.token}`}}).then((e=>{this.enemies=e.data,this.isLoadingEnemies=!1})).catch((e=>{console.log(e),this.isLoadingEnemies=!1,this.generalStore.errorSnackbar("Erro ao buscar inimigos")}))},async postEnemy(){this.isLoadingPost=!0;let e={enemy_id:this.enemy,regioninperiod_id:this.regioninperiod.regioninperiod_id};console.log(e),await z.A.request({url:"api/enemiesmonitored",method:"POST",headers:{Authorization:`Bearer ${this.accountStore.account.token}`},data:e}).then((()=>{this.isLoadingPost=!1,this.dialog=!1,this.$emit("refresh"),this.generalStore.successSnackbar("Inimigo adicionado com sucesso")})).catch((e=>{this.isLoadingPost=!1,console.error(e),this.generalStore.errorSnackbar("Erro ao adicionar inimigo")}))}}};const Uo=(0,B.A)(Xo,[["render",Io]]);var qo=Uo,jo={name:"EnemiesinPeriod",components:{AddEnemyToPeriod:qo},props:{region:{type:Object},regioninperiod:{type:Object,required:!0},dialog:{type:Boolean,required:!0}},setup(){const e=(0,T.T)(),t=(0,R.E)();return{generalStore:e,accountStore:t}},data(){return{enemies:[],isLoadingEnemies:!1,headers:[{title:"Inimigo"},{title:""}],isLoadingDelete:!1}},watch:{dialog(e){e&&this.onOpenDialog()}},computed:{localDialog:{get(){return this.dialog},set(e){this.$emit("update:dialog",e)}},existingEnemies(){return this.enemies.map((e=>e.enemy))}},methods:{onOpenDialog(){this.getEnemies()},reset(){this.enemies=[]},async getEnemies(){this.isLoadingEnemies=!0,await z.A.request({url:`api/regionsinperiods/${this.regioninperiod.regioninperiod_id}/enemiesmonitored`,method:"GET",headers:{Authorization:`Bearer ${this.accountStore.account.token}`}}).then((e=>{this.isLoadingEnemies=!1,this.enemies=e.data,console.log(this.enemies)})).catch((e=>{this.isLoadingEnemies=!1,console.log(e),this.generalStore.errorSnackbar("Erro ao buscar inimigos")}))},async deleteEnemyInPeriod(e){console.log(e),this.isLoadingDelete=!0,await z.A.request({url:`api/enemiesmonitored/${e.enemymonitored_id}`,method:"DELETE",headers:{Authorization:`Bearer ${this.accountStore.account.token}`}}).then((()=>{this.isLoadingDelete=!1,this.generalStore.successSnackbar("Inimigo removido com sucesso"),this.getEnemies()})).catch((e=>{console.error(e),this.isLoadingDelete=!1,this.generalStore.errorSnackbar("Erro ao remover inimigo")}))}}};const Go=(0,B.A)(jo,[["render",Mo],["__scopeId","data-v-7cb0c926"]]);var No=Go,Jo={name:"PeriodsDetail",components:{AddRegionPeriod:_o,ProtocolsinPeriod:Wo,EnemiesinPeriod:No},props:{region:Object},setup(){const e=(0,R.E)(),t=(0,T.T)();return{accountStore:e,generalStore:t}},data(){return{isLoading:!1,periods:[],limit:10,offset:0,hasMore:!1,headers:[{title:"Nome",key:"name"},{title:"Tipo",key:"type"},{title:"Data de Início",key:"start_date"},{title:"Data de Fim",key:"end_date"},{title:"",key:"actions"}],deleteDialog:!1,periodToDelete:{regioninperiod_id:0,period_name:""},isLoadingDelete:!1,enemiesDialog:!1,period:{}}},computed:{tableItems(){return this.periods.map((e=>({regioninperiod_id:e.regioninperiod_id,name:e.period.period_name,type:e.period.period_type.periodtype_name,start_date:this.formatDate(e.period.period_startdate),end_date:this.formatDate(e.period.period_enddate)})))}},methods:{async getRegionPeriods(){this.isLoading=!0,await z.A.request({url:"api/regions/"+this.region.region_id+"/regionsinperiods",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token},params:{limit:this.limit,offset:this.offset}}).then((e=>{let t=e.data.regioninperiods;this.periods.push(...t),this.offset+=t.length,this.hasMore=e.data.hasMore,this.isLoading=!1})).catch((e=>{console.error(e),this.isLoading=!1}))},loadMore(e){e&&this.getRegionPeriods()},refreshPeriods(){this.periods=[],this.offset=0,this.hasMore=!1,this.$emit("refreshEOIs"),this.getRegionPeriods()},deleteRegionPeriod(){this.isLoadingDelete=!0,z.A.request({url:"api/regionsinperiods/"+this.periodToDelete.regioninperiod_id,method:"DELETE",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.isLoadingDelete=!1,this.deleteDialog=!1,this.generalStore.successSnackbar("Período removido com sucesso da região"),this.refreshPeriods()})).catch((e=>{console.error(e),this.isLoadingDelete=!1,this.generalStore.errorSnackbar(e.response.data.error,3e3)}))},formatDate(e){return new Date(e).toLocaleDateString("pt-PT")},openDeleteDialog(e){this.periodToDelete={regioninperiod_id:e.regioninperiod_id,period_name:e.name},this.deleteDialog=!0},resetDeleteDialog(){this.periodToDelete={regioninperiod_id:0,period_name:""}},openEnemiesDialog(e){this.period=e,this.enemiesDialog=!0},isCurrent(e){const t=(new Date).getTime(),o=new Date(e.item.start_date).getTime(),i=new Date(e.item.end_date).getTime();return o<=t&&t<=i}},mounted(){this.getRegionPeriods()},unmounted(){this.periods=[]}};const $o=(0,B.A)(Jo,[["render",mo],["__scopeId","data-v-ee95d61e"]]);var Qo=$o;const Ko=e=>((0,i.Qi)("data-v-504fb49c"),e=e(),(0,i.jt)(),e),Yo=Ko((()=>(0,i.Lk)("span",{class:"text-h4"},"Estações Meterológicas",-1))),Ho={class:"text-h5"},Zo={class:"px-4"},ei={key:0,class:"mb-5"},ti=Ko((()=>(0,i.Lk)("br",null,null,-1)));function oi(e,t,o,a,r,d){const g=(0,i.g2)("DatasourceDetail");return(0,i.uX)(),(0,i.Wv)(n.J,{elevation:"0",border:"",rounded:"",class:"pa-5",height:"85%","min-height":"350"},{default:(0,i.k6)((()=>[(0,i.bF)(l.r,{class:"d-flex justify-space-between align-center"},{default:(0,i.k6)((()=>[(0,i.Lk)("div",null,[Yo,(0,i.bF)(p.W,{modelValue:r.filter.datasource_name,"onUpdate:modelValue":t[0]||(t[0]=e=>r.filter.datasource_name=e),color:"secondary",placeholder:"Pesquisar",density:"compact",variant:"solo","hide-details":"","append-icon":"mdi-magnify",class:"mt-5",clearable:"","onClick:append":t[1]||(t[1]=e=>d.refreshDatasources()),"onClick:clear":t[2]||(t[2]=e=>d.refreshDatasources())},null,8,["modelValue"])])])),_:1}),(0,i.bF)(s.O,{class:"scrollable-card mt-5"},{default:(0,i.k6)((()=>[r.isLoadingList?((0,i.uX)(),(0,i.Wv)(Ge.Z,{key:0,color:"primary",indeterminate:""})):((0,i.uX)(),(0,i.Wv)(je.$,{key:1,items:r.datasources,"item-value":"regiondatasource_id","items-per-page":r.datasources.length+1},{default:(0,i.k6)((({items:e,isExpanded:t,toggleExpand:o})=>[(0,i.bF)(c.L,null,{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e,(e=>((0,i.uX)(),(0,i.Wv)(u.B,{cols:"12",key:e.raw.regiondatasource_id},{default:(0,i.k6)((()=>[(0,i.bF)(n.J,null,{default:(0,i.k6)((()=>[(0,i.bF)(l.r,null,{default:(0,i.k6)((()=>[(0,i.Lk)("span",Ho,(0,h.v_)(e.raw.datasource_name),1)])),_:2},1024),(0,i.Lk)("div",Zo,[(0,i.bF)(Pe.N,{label:(t(e)?"Esconder":"Mostrar")+" Detalhes","model-value":t(e),density:"compact",color:"secondary",onClick:()=>o(e)},null,8,["label","model-value","onClick"]),(0,i.bF)(Ne.Qo,null,{default:(0,i.k6)((()=>[t(e)?((0,i.uX)(),(0,i.CE)("div",ei,[(0,i.bF)(g,{datasource_id:e.raw.datasource_id},null,8,["datasource_id"])])):(0,i.Q3)("",!0)])),_:2},1024)])])),_:2},1024)])),_:2},1024)))),128)),r.hasMore?((0,i.uX)(),(0,i.Wv)(u.B,{key:0,cols:"12"},{default:(0,i.k6)((()=>[(0,i.bo)((0,i.bF)(F.V8,{type:"card"},null,512),[[V.o,{handler:d.loadMore,options:{threshold:.3}},void 0,{quiet:!0}]])])),_:1})):((0,i.uX)(),(0,i.Wv)(u.B,{key:1,cols:"12"},{default:(0,i.k6)((()=>[ti])),_:1}))])),_:2},1024)])),_:1},8,["items","items-per-page"]))])),_:1})])),_:1})}const ii={class:"text-subtitle-1"},ai={class:"text-subtitle-1"},ri={class:"text-subtitle-1"},ni={key:0},li={key:1},si={class:"text-subtitle-1"};function di(e,t,o,a,r,n){const l=(0,i.g2)("PointMap");return(0,i.uX)(),(0,i.Wv)(y.i,null,{default:(0,i.k6)((()=>[r.isLoading?((0,i.uX)(),(0,i.Wv)(c.L,{key:0,align:"center"},{default:(0,i.k6)((()=>[(0,i.bF)(u.B,{class:"d-flex align-center justify-center"},{default:(0,i.k6)((()=>[(0,i.bF)(Ge.Z,{color:"secondary",indeterminate:""})])),_:1})])),_:1})):r.isLoading||null==this.datasource?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.Wv)(c.L,{key:1},{default:(0,i.k6)((()=>[(0,i.bF)(u.B,{cols:"6",class:"d-flex flex-column justify-space-evenly"},{default:(0,i.k6)((()=>[(0,i.Lk)("span",ii,[(0,i.eW)("Nome: "),(0,i.Lk)("b",null,(0,h.v_)(r.datasource?.datasource_name),1)]),(0,i.Lk)("span",ai,[(0,i.eW)(" Tipo: "),(0,i.Lk)("b",null,(0,h.v_)(n.isVirtual?"Estação Virtual":"Estação Física"),1)]),(0,i.Lk)("span",ri,[(0,i.eW)("Fornecedor: "),n.isVirtual?((0,i.uX)(),(0,i.CE)("b",li,"SISTEMA")):((0,i.uX)(),(0,i.CE)("b",ni,(0,h.v_)(r.datasource.dataprovider?.dataprovider_name),1))]),(0,i.Lk)("span",si,[(0,i.eW)(" ID de Fornecedor: "),(0,i.Lk)("b",null,(0,h.v_)(r.datasource?.datasource_externalid),1)])])),_:1}),r.datasource.datasource_location?((0,i.uX)(),(0,i.Wv)(u.B,{key:0,cols:"6"},{default:(0,i.k6)((()=>[(0,i.bF)(l,{point:r.datasource.datasource_location,height:"200px"},null,8,["point"])])),_:1})):(0,i.Q3)("",!0)])),_:1}))])),_:1})}var ci={name:"DatasourceDetail",components:{PointMap:Pt},props:{datasource_id:Number},setup(){const e=(0,R.E)();return{accountStore:e}},data(){return{datasource:null,isLoading:!1}},computed:{isVirtual(){return"SYSTEM"==this.datasource.dataprovider?.dataprovider_name}},methods:{async getDatasource(){console.log(this.datasource_id),this.isLoading=!0,await z.A.request({url:"api/datasources/"+this.datasource_id,method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{console.log(e.data),this.datasource=e.data,this.isLoading=!1})).catch((e=>{console.log(e)}))}},mounted(){this.getDatasource()},unmounted(){this.datasource=null}};const ui=(0,B.A)(ci,[["render",di]]);var gi=ui,pi={name:"DatasourcesDetail",components:{DatasourceDetail:gi},props:{region:Object},setup(){const e=(0,R.E)(),t=(0,T.T)();return{accountStore:e,generalStore:t}},data(){return{datasources:[],isLoadingList:!1,limit:5,offset:0,hasMore:!1,filter:{datasource_name:null}}},computed:{},methods:{async getDatasources(){await z.A.request({url:"api/regions/"+this.region.region_id+"/regionsdatasources",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token},params:{limit:this.limit,offset:this.offset,datasource_name:this.filter.datasource_name}}).then((e=>{let t=e.data.datasources;this.datasources.push(...t),this.offset+=t.length,this.hasMore=e.data.hasMore})).catch((e=>{console.error(e)}))},refreshDatasources(){this.datasources=[],this.offset=0,this.hasMore=!1,this.getDatasources()},loadMore(e){e&&this.getDatasources()}},mounted(){this.isLoadingList=!0,this.getDatasources().then((()=>{this.isLoadingList=!1}))},unmounted(){this.datasources=[]}};const mi=(0,B.A)(pi,[["render",oi],["__scopeId","data-v-504fb49c"]]);var hi=mi,fi=o(1321);const bi=(0,i.Lk)("span",{class:"text-h4"},"Utilizadores Associados",-1),_i={key:0},ki={class:"font-weight-light"},vi={class:"mt-4"},yi={class:"font-weight-light"},Fi={class:"mt-4"};function Li(e,t,o,a,d,c){const u=(0,i.g2)("AddRegionAgent"),p=(0,i.g2)("v-date-input");return(0,i.uX)(),(0,i.Wv)(n.J,{elevation:"0",border:"",rounded:"",class:"pa-5",height:"85%","min-height":"350"},{default:(0,i.k6)((()=>[(0,i.bF)(l.r,{class:"d-flex justify-space-between align-center"},{default:(0,i.k6)((()=>[bi,this.accountStore.hasRole("Organização")?((0,i.uX)(),(0,i.Wv)(u,{key:0,region:o.region,existingAgents:c.tableItems,class:"mb-5",onRefresh:c.refreshAgents},null,8,["region","existingAgents","onRefresh"])):(0,i.Q3)("",!0)])),_:1}),(0,i.bF)(s.O,{class:"mt-5"},{default:(0,i.k6)((()=>[(0,i.bF)(_.g,{"fixed-headers":"","no-data-text":"Sem utilizadores associados",headers:c.headers,items:c.tableItems,loading:d.isLoadingList},{item:(0,i.k6)((e=>[(0,i.Lk)("tr",null,[(0,i.Lk)("td",null,[(0,i.bF)(b.x,{color:c.roleColor(e.item.agent.type.name),variant:"flat"},{default:(0,i.k6)((()=>[(0,i.eW)((0,h.v_)(e.item.role),1)])),_:2},1032,["color"])]),(0,i.Lk)("td",null,(0,h.v_)(e.item.agent.username),1),(0,i.Lk)("td",null,(0,h.v_)(e.item.agent.name),1),(0,i.Lk)("td",null,(0,h.v_)(e.item.startDate),1),this.accountStore.hasRole("Organização")?((0,i.uX)(),(0,i.CE)("td",_i,[(0,i.bF)(r.D,{color:"warning",variant:"text",icon:"",onClick:t=>c.openEditDialog(e.item)},{default:(0,i.k6)((()=>[(0,i.bF)(g.w,null,{default:(0,i.k6)((()=>[(0,i.eW)("mdi-pencil")])),_:1}),(0,i.bF)(L.y,{activator:"parent",location:"bottom"},{default:(0,i.k6)((()=>[(0,i.eW)("Editar data de início")])),_:1})])),_:2},1032,["onClick"]),(0,i.bF)(r.D,{color:"error",variant:"text",icon:"",onClick:t=>c.openDeleteDialog(e.item)},{default:(0,i.k6)((()=>[(0,i.bF)(g.w,null,{default:(0,i.k6)((()=>[(0,i.eW)("mdi-delete-outline")])),_:1}),(0,i.bF)(L.y,{activator:"parent",location:"bottom"},{default:(0,i.k6)((()=>[(0,i.eW)(" Remover ")])),_:1})])),_:2},1032,["onClick"])])):(0,i.Q3)("",!0)])])),_:1},8,["headers","items","loading"]),(0,i.bF)(k.p,{modelValue:d.editDialog,"onUpdate:modelValue":t[4]||(t[4]=e=>d.editDialog=e),onAfterLeave:c.resetEditDialog,width:"auto"},{default:(0,i.k6)((()=>[(0,i.bF)(n.J,{width:"400"},{default:(0,i.k6)((()=>[(0,i.bF)(l.r,{class:"bg-warning d-flex align-center"},{default:(0,i.k6)((()=>[(0,i.bF)(g.w,{size:"small",class:"mr-2"},{default:(0,i.k6)((()=>[(0,i.eW)("mdi-pencil")])),_:1}),(0,i.Lk)("span",null,[(0,i.eW)("Editar data de início de "),(0,i.Lk)("span",ki,(0,h.v_)(d.agentToEdit?.agent?.name),1)])])),_:1}),(0,i.bF)(s.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(w.n,{modelValue:d.editFormValid,"onUpdate:modelValue":t[1]||(t[1]=e=>d.editFormValid=e)},{default:(0,i.k6)((()=>[(0,i.Lk)("div",vi,[(0,i.bF)(fi.i,{locale:"pt"},{default:(0,i.k6)((()=>[(0,i.bF)(p,{modelValue:d.startDate,"onUpdate:modelValue":t[0]||(t[0]=e=>d.startDate=e),label:"Data de início",placeholder:"dd/mm/aaaa","prepend-icon":"","prepend-inner-icon":"mdi-calendar-start",density:"compact",variant:"outlined",rules:[e=>!!e||"Campo obrigatório"]},null,8,["modelValue","rules"])])),_:1})])])),_:1},8,["modelValue"])])),_:1}),(0,i.bF)(v.G),(0,i.bF)(f.S,{class:"d-flex justify-space-around"},{default:(0,i.k6)((()=>[(0,i.bF)(r.D,{color:"error",variant:"tonal",icon:"mdi-close",onClick:t[2]||(t[2]=e=>d.editDialog=!1)}),(0,i.bF)(r.D,{color:"secondary",variant:"tonal",icon:"mdi-check",loading:d.isLoadingEdit,disabled:!d.editFormValid,onClick:t[3]||(t[3]=e=>c.editAgent())},null,8,["loading","disabled"])])),_:1})])),_:1})])),_:1},8,["modelValue","onAfterLeave"]),(0,i.bF)(k.p,{modelValue:d.deleteDialog,"onUpdate:modelValue":t[9]||(t[9]=e=>d.deleteDialog=e),onAfterLeave:c.resetDeleteDialog,width:"auto"},{default:(0,i.k6)((()=>[(0,i.bF)(n.J,null,{default:(0,i.k6)((()=>[(0,i.bF)(l.r,{class:"bg-error d-flex align-center"},{default:(0,i.k6)((()=>[(0,i.bF)(g.w,{size:"small",class:"mr-2"},{default:(0,i.k6)((()=>[(0,i.eW)("mdi-delete-outline")])),_:1}),(0,i.Lk)("span",null,[(0,i.eW)("Desassociar "),(0,i.Lk)("span",yi,(0,h.v_)(d.agentToDelete?.agent?.type?.name),1)])])),_:1}),(0,i.bF)(s.O,null,{default:(0,i.k6)((()=>[(0,i.Lk)("span",null,[(0,i.eW)("Tem a certeza que quer remover o "),(0,i.Lk)("strong",null,(0,h.v_)(d.agentToDelete?.role)+" "+(0,h.v_)(d.agentToDelete?.agent?.name),1),(0,i.eW)("?")]),(0,i.bF)(w.n,{modelValue:d.deleteFormValid,"onUpdate:modelValue":t[6]||(t[6]=e=>d.deleteFormValid=e)},{default:(0,i.k6)((()=>[(0,i.Lk)("div",Fi,[(0,i.bF)(fi.i,{locale:"pt"},{default:(0,i.k6)((()=>[(0,i.bF)(p,{modelValue:d.endDate,"onUpdate:modelValue":t[5]||(t[5]=e=>d.endDate=e),label:" Ultima data de atuação",placeholder:"dd/mm/aaaa","prepend-icon":"","prepend-inner-icon":"mdi-calendar",density:"compact",variant:"outlined",rules:[e=>!!e||"Campo obrigatório"]},null,8,["modelValue","rules"])])),_:1})])])),_:1},8,["modelValue"])])),_:1}),(0,i.bF)(f.S,{class:"d-flex justify-space-around"},{default:(0,i.k6)((()=>[(0,i.bF)(r.D,{color:"error",variant:"tonal",icon:"mdi-close",onClick:t[7]||(t[7]=e=>d.deleteDialog=!1)}),(0,i.bF)(r.D,{color:"secondary",variant:"tonal",icon:"mdi-check",loading:d.isLoadingDelete,disabled:!d.deleteFormValid,onClick:t[8]||(t[8]=e=>c.deleteAgent())},null,8,["loading","disabled"])])),_:1})])),_:1})])),_:1},8,["modelValue","onAfterLeave"])])),_:1})])),_:1})}const Vi={class:"mt-4"};function Di(e,t,o,d,c,u){const g=(0,i.g2)("v-date-input");return(0,i.uX)(),(0,i.Wv)(k.p,{modelValue:c.dialog,"onUpdate:modelValue":t[10]||(t[10]=e=>c.dialog=e),onAfterLeave:t[11]||(t[11]=e=>u.reset()),width:"auto"},{activator:(0,i.k6)((({props:e})=>[(0,i.bF)(r.D,(0,i.v6)({color:"success",icon:"mdi-plus"},e),null,16)])),default:(0,i.k6)((({})=>[(0,i.bF)(n.J,{class:"mx-auto","min-width":"400"},{default:(0,i.k6)((()=>[(0,i.bF)(l.r,{class:"bg-success"},{default:(0,i.k6)((()=>[(0,i.eW)((0,h.v_)(c.steps[c.step].title),1)])),_:1}),(0,i.bF)($t.r3,{modelValue:c.step,"onUpdate:modelValue":t[6]||(t[6]=e=>c.step=e)},{default:(0,i.k6)((()=>[(0,i.bF)(Qt.m,{value:0},{default:(0,i.k6)((()=>[(0,i.bF)(s.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(w.n,{modelValue:c.steps[0].formValid,"onUpdate:modelValue":t[1]||(t[1]=e=>c.steps[0].formValid=e)},{default:(0,i.k6)((()=>[(0,i.bF)(Jt.d4,{class:"mt-4",modelValue:c.roleSelected,"onUpdate:modelValue":t[0]||(t[0]=e=>c.roleSelected=e),items:c.roles,"item-title":"title","item-value":"value",label:"Cargo do Utilizador",placeholder:"Escolha o cargo do utilizador","prepend-inner-icon":"mdi-account-cog-outline","no-data-text":"Nenhum cargo encontrado",density:"compact",variant:"outlined",rules:[e=>!!e||"Campo obrigatório"],loading:c.isLoadingAgents},null,8,["modelValue","items","rules","loading"])])),_:1},8,["modelValue"])])),_:1})])),_:1}),(0,i.bF)(Qt.m,{value:1},{default:(0,i.k6)((()=>[(0,i.bF)(s.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(w.n,{modelValue:c.steps[1].formValid,"onUpdate:modelValue":t[3]||(t[3]=e=>c.steps[1].formValid=e)},{default:(0,i.k6)((()=>[(0,i.bF)(a.V,{class:"mt-4",modelValue:c.agent,"onUpdate:modelValue":t[2]||(t[2]=e=>c.agent=e),items:u.selectItemsAgents,"item-title":"agent_username","prepend-inner-icon":"mdi-account-outline","return-object":"",label:"Produtor"===c.roleSelected?"Produtor":"Agente de Campo",placeholder:"Produtor"===c.roleSelected?"Escolha o produtor":"Escolha o agente de campo","no-data-text":"Produtor"===c.roleSelected?"Nenhum produtor encontrado":"Nenhum agente de campo encontrado",density:"compact",variant:"outlined",rules:[e=>!!e||"Campo obrigatório"],disabled:c.isLoadingAgents},{item:(0,i.k6)((({props:e,item:t})=>[(0,i.bF)(Fe.g,(0,i.v6)(e,{subtitle:t.raw.agent_name}),null,16,["subtitle"])])),_:1},8,["modelValue","items","label","placeholder","no-data-text","rules","disabled"])])),_:1},8,["modelValue"])])),_:1})])),_:1}),(0,i.bF)(Qt.m,{value:3},{default:(0,i.k6)((()=>[(0,i.bF)(w.n,{modelValue:c.steps[2].formValid,"onUpdate:modelValue":t[5]||(t[5]=e=>c.steps[2].formValid=e)},{default:(0,i.k6)((()=>[(0,i.bF)(fi.i,{locale:"pt"},{default:(0,i.k6)((()=>[(0,i.bF)(s.O,null,{default:(0,i.k6)((()=>[(0,i.Lk)("div",Vi,[(0,i.bF)(g,{modelValue:c.startDate,"onUpdate:modelValue":t[4]||(t[4]=e=>c.startDate=e),label:"Data de Início",placeholder:"dd/mm/aaaa","prepend-icon":"","prepend-inner-icon":"mdi-calendar-end",density:"compact",variant:"outlined",rules:[e=>!!e||"Campo obrigatório"]},null,8,["modelValue","rules"])])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["modelValue"]),(0,i.bF)(v.G),(0,i.bF)(f.S,null,{default:(0,i.k6)((()=>[c.step>0?((0,i.uX)(),(0,i.Wv)(r.D,{key:0,"prepend-icon":"mdi-chevron-left",color:"info",variant:"tonal",onClick:t[7]||(t[7]=e=>c.step--)},{default:(0,i.k6)((()=>[(0,i.eW)(" Anterior ")])),_:1})):(0,i.Q3)("",!0),(0,i.bF)(Nt.h),u.lastStep?((0,i.uX)(),(0,i.Wv)(r.D,{key:2,disabled:!c.steps[c.step].formValid,"append-icon":"mdi-check",color:"success",variant:"flat",loading:c.isLoadingPost,onClick:t[9]||(t[9]=e=>u.postAgentRegion())},{default:(0,i.k6)((()=>[(0,i.eW)(" Adicionar ")])),_:1},8,["disabled","loading"])):((0,i.uX)(),(0,i.Wv)(r.D,{key:1,disabled:!c.steps[c.step].formValid,"append-icon":"mdi-chevron-right",color:"info",variant:"tonal",onClick:t[8]||(t[8]=e=>c.step++)},{default:(0,i.k6)((()=>[(0,i.eW)(" Próximo ")])),_:1},8,["disabled"]))])),_:1})])),_:1})])),_:1},8,["modelValue"])}var Si={name:"AddRegionAgent",props:{region:Object,existingAgents:Array},setup(){const e=(0,R.E)(),t=(0,T.T)();return{accountStore:e,generalStore:t}},data(){return{dialog:!1,agents:[],isLoadingAgents:!1,agent:null,startDate:new Date,isLoadingPost:!1,step:0,steps:[{title:"Cargo do utilizador",icon:"mdi-account",formValid:!1},{title:"Utilizador",icon:"mdi-account",formValid:!1},{title:"Data de Início",icon:"mdi-calendar",formValid:!1}],roles:[{title:"Proprietário",value:"Produtor"},{title:"Agente de Campo",value:"Agente de Campo"}],roleSelected:null}},watch:{roleSelected(e){e&&(this.agent=null,this.listAgents())}},computed:{lastStep(){return this.step===this.steps.length-1},selectItemsAgents(){return this.agents.filter((e=>!this.existingAgentIds.includes(e.agent_id)))},existingAgentIds(){return this.existingAgents.map((e=>e.agent.id))},startDateFormatted(){return this.startDate.toLocaleDateString("pt-PT")}},methods:{async listAgents(){this.isLoadingAgents=!0;let e="Produtor"===this.roleSelected?"api/organizations/"+this.region.organization.organization_id+"/organizationproducers":"api/organizations/"+this.region.organization.organization_id+"/organizationfieldagents";await z.A.request({url:e,method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.agents=e.data,this.isLoadingAgents=!1})).catch((e=>{console.error(e),this.isLoadingAgents=!1}))},async postAgentRegion(){this.isLoadingPost=!0;let e={region_id:this.region.region_id,agent_id:this.agent.agent_id,startDate:this.startDateFormatted};await z.A.request({url:"api/agentsregions",method:"POST",headers:{Authorization:"Bearer "+this.accountStore.account.token},data:e}).then((e=>{this.isLoadingPost=!1,this.dialog=!1,this.generalStore.successSnackbar("Utilizador adicionado com sucesso."),this.$emit("refresh")})).catch((e=>{console.error(e),this.isLoadingPost=!1,this.generalStore.errorSnackbar("Erro ao adicionar agente.")}))},reset(){this.step=0,this.roleSelected=null,this.agents=[],this.agent=null}}};const Ei=(0,B.A)(Si,[["render",Di]]);var Pi=Ei,Ai={name:"RegionAgentsDetail",components:{AddRegionAgent:Pi},props:{region:Object},setup(){const e=(0,R.E)(),t=(0,T.T)();return{accountStore:e,generalStore:t}},data(){return{agentsregions:[],isLoadingList:!1,limit:10,offset:0,hasMore:!1,editDialog:!1,agentToEdit:{agent_id:0,agent_name:""},editFormValid:!1,startDate:new Date,isLoadingEdit:!1,deleteDialog:!1,agentToDelete:{agent_id:0,agent_name:""},deleteFormValid:!1,endDate:new Date,isLoadingDelete:!1}},computed:{headers(){let e=[{title:"Tipo",key:"type"},{title:"Conta",key:"username"},{title:"Nome",key:"name"},{title:"Data de Início",key:"startDate"}];return this.accountStore.hasRole("Organização")&&e.push({title:"",key:"actions"}),e},tableItems(){return this.agentsregions.map((e=>({agentregion_id:e.id,agent:e.agent,role:"Produtor"==e.agent.type.name?"Proprietário":e.agent.type.name,startDate:e.metadata?.startDate})))},startDateFormatted(){return this.startDate.toLocaleDateString("pt-PT")},endDateFormatted(){return this.endDate.toLocaleDateString("pt-PT")}},methods:{async listAgents(){this.isLoadingList=!0,await z.A.request({url:"api/agentsregions",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token},params:{region_id:this.region.region_id,limit:this.limit,offset:this.offset}}).then((e=>{let t=e.data.agentsregions;this.agentsregions.push(...t),this.offset+=t.length,this.hasMore=e.data.hasMore,this.isLoadingList=!1})).catch((e=>{console.error(e),this.isLoadingList=!1}))},loadMore(e){e&&this.listAgents()},refreshAgents(){this.offset=0,this.agentsregions=[],this.listAgents()},roleColor(e){switch(e){case"Administrador":return"error";case"Organização":return"warning";case"Produtor":return"success";case"Agente de Campo":return"info";default:return"primary"}},openEditDialog(e){console.log(e),this.agentToEdit=e,this.startDate=new Date(e.startDate),this.editDialog=!0},resetEditDialog(){this.agentToEdit={agent_id:0,agent_name:""},this.startDate=new Date,this.editDialog=!1},async editAgent(){this.isLoadingEdit=!0,await z.A.request({url:"api/agentsregions/"+this.agentToEdit.agentregion_id,method:"PATCH",headers:{Authorization:"Bearer "+this.accountStore.account.token},data:{startDate:this.startDateFormatted}}).then((e=>{this.isLoadingEdit=!1,this.generalStore.successSnackbar("Data de início atualizada."),this.refreshAgents(),this.resetEditDialog()})).catch((e=>{console.error(e),this.generalStore.errorSnackbar("Erro ao atualizar data de início."),this.isLoadingEdit=!1}))},openDeleteDialog(e){console.log(e),this.agentToDelete=e,this.deleteDialog=!0},resetDeleteDialog(){this.agentToDelete={agent_id:0,agent_name:""},this.endDate=new Date,this.deleteDialog=!1},async deleteAgent(){this.isLoadingDelete=!0,await z.A.request({url:"api/agentsregions/"+this.agentToDelete.agentregion_id,method:"DELETE",headers:{Authorization:"Bearer "+this.accountStore.account.token},data:{endDate:this.endDateFormatted}}).then((e=>{this.isLoadingDelete=!1,this.generalStore.successSnackbar("Agente removido com sucesso."),this.refreshAgents(),this.resetDeleteDialog()})).catch((e=>{console.error(e),this.generalStore.errorSnackbar("Erro ao remover agente."),this.isLoadingDelete=!1}))}},mounted(){this.listAgents()},unmounted(){this.agentsregions=[]}};const wi=(0,B.A)(Ai,[["render",Li]]);var xi=wi,Ci=o(2164),Wi=o(8249);const Ti=e=>((0,i.Qi)("data-v-5d065c47"),e=e(),(0,i.jt)(),e),Ri=Ti((()=>(0,i.Lk)("span",{class:"text-h4"},"Observações na Parcela",-1))),zi=Ti((()=>(0,i.Lk)("span",null,"Períodos Datas",-1))),Oi=Ti((()=>(0,i.Lk)("span",null,"Outros Filtros",-1))),Bi=Ti((()=>(0,i.Lk)("h2",{class:"text-h5"},"Nenhuma observação encontrada",-1)));function Mi(e,t,o,d,m,h){const f=(0,i.g2)("v-date-input"),b=(0,i.g2)("VisitCard"),_=(0,i.g2)("ObservationDetail");return(0,i.uX)(),(0,i.Wv)(n.J,{elevation:"0",class:"pa-5",height:"90%","min-height":"350"},{default:(0,i.k6)((()=>[(0,i.bF)(l.r,null,{default:(0,i.k6)((()=>[Ri,(0,i.bF)(c.L,{class:"mt-5"},{default:(0,i.k6)((()=>[(0,i.bF)(u.B,{cols:"5",class:"d-flex align-center mb-5"},{default:(0,i.k6)((()=>[(0,i.bF)(fi.i,{locale:"pt"},{default:(0,i.k6)((()=>[(0,i.bF)(f,{modelValue:m.filter.dates,"onUpdate:modelValue":t[0]||(t[0]=e=>m.filter.dates=e),placeholder:"Datas","prepend-icon":"","prepend-inner-icon":"mdi-calendar",multiple:"range",density:"comfortable",variant:"solo","hide-details":"",clearable:"","onClick:clear":t[1]||(t[1]=e=>m.filter.dates=[])},null,8,["modelValue"]),(0,i.bF)(Wi.q,{"close-on-content-click":!1},{activator:(0,i.k6)((({props:e})=>[(0,i.bF)(r.D,(0,i.v6)({icon:"",variant:"plain"},e),{default:(0,i.k6)((()=>[(0,i.bF)(g.w,null,{default:(0,i.k6)((()=>[(0,i.eW)("mdi-view-list")])),_:1}),(0,i.bF)(L.y,{activator:"parent",location:"top"},{default:(0,i.k6)((()=>[zi])),_:1})])),_:2},1040)])),default:(0,i.k6)((()=>[(0,i.bF)(n.J,{"min-width":"250","max-height":"300"},{default:(0,i.k6)((()=>[(0,i.bF)(l.r,null,{default:(0,i.k6)((()=>[(0,i.bF)(p.W,{density:"compact",modelValue:m.filter_periods.period_name,"onUpdate:modelValue":t[2]||(t[2]=e=>m.filter_periods.period_name=e),label:"Pesquisa o nome",color:"primary","append-icon":"mdi-magnify",variant:"underlined","hide-details":"",clearable:"","onClick:append":t[3]||(t[3]=e=>h.searchRegionInPeriods())},null,8,["modelValue"])])),_:1}),(0,i.bF)(Ci.x8,{class:"scrollable-menu"},{default:(0,i.k6)((()=>[(0,i.bF)(v.G),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(m.regioninperiods,(e=>((0,i.uX)(),(0,i.Wv)(Fe.g,{key:e.regioninperiod_id,title:e.period.period_name,subtitle:`${h.formatDate(e.period.period_startdate)} - ${h.formatDate(e.period.period_enddate)}`,onClick:t=>h.updateDates(e)},null,8,["title","subtitle","onClick"])))),128)),m.periods_hasMore?((0,i.uX)(),(0,i.Wv)(Fe.g,{key:0},{default:(0,i.k6)((()=>[(0,i.bo)(((0,i.uX)(),(0,i.CE)("div",null,[(0,i.bF)(F.V8,{type:"list-item"})])),[[V.o,h.loadMoreRegionsInPeriods,void 0,{quiet:!0}]])])),_:1})):(0,i.Q3)("",!0)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),(0,i.bF)(u.B,{cols:"2"},{default:(0,i.k6)((()=>[(0,i.bF)(p.W,{modelValue:m.filter.nea,"onUpdate:modelValue":t[4]||(t[4]=e=>m.filter.nea=e),modelModifiers:{trim:!0},label:"NEA",type:"number",prefix:"%",color:"primary",density:"comfortable",variant:"solo",rules:[m.rules.percentage],clearable:""},null,8,["modelValue","rules"])])),_:1}),(0,i.bF)(u.B,{cols:"2"},{default:(0,i.k6)((()=>[(0,i.bF)(a.V,{modelValue:m.filter.ef,"onUpdate:modelValue":t[5]||(t[5]=e=>m.filter.ef=e),loading:m.isLoadingStages,items:m.stages,"no-data-text":"Sem resultados","item-title":"phenologicalstage_code","item-value":"phenologicalstage_code",label:"EF",color:"primary",density:"comfortable",variant:"solo",clearable:""},{item:(0,i.k6)((({props:e,item:t})=>[(0,i.bF)(Fe.g,(0,i.v6)(e,{title:t.raw.phenologicalstage_code,subtitle:t.raw.phenologicalstage_name}),null,16,["title","subtitle"])])),_:1},8,["modelValue","loading","items"])])),_:1}),(0,i.bF)(u.B,{"align-self":"stretch",cols:"2",class:"text-center"},{default:(0,i.k6)((()=>[(0,i.bF)(Wi.q,{"close-on-content-click":!1},{activator:(0,i.k6)((({props:e})=>[(0,i.bF)(r.D,(0,i.v6)({size:"large",block:"",variant:"text"},e),{default:(0,i.k6)((()=>[(0,i.bF)(g.w,{size:"large"},{default:(0,i.k6)((()=>[(0,i.eW)("mdi-filter-plus-outline")])),_:1}),(0,i.bF)(L.y,{activator:"parent",location:"top"},{default:(0,i.k6)((()=>[Oi])),_:1})])),_:2},1040)])),default:(0,i.k6)((()=>[(0,i.bF)(Ci.x8,{lines:"one"},{default:(0,i.k6)((()=>[(0,i.bF)(Fe.g,null,{default:(0,i.k6)((()=>[(0,i.bF)(Pe.N,{label:"Visita",modelValue:m.filter.visited,"onUpdate:modelValue":t[6]||(t[6]=e=>m.filter.visited=e),indeterminate:null===m.filter.visited,color:"info","prepend-icon":"mdi-close-circle","hide-details":"","onClick:prepend":t[7]||(t[7]=e=>m.filter.visited=null)},null,8,["modelValue","indeterminate"])])),_:1}),(0,i.bF)(v.G),(0,i.bF)(Fe.g,null,{default:(0,i.k6)((()=>[(0,i.bF)(Pe.N,{label:"GPS",modelValue:m.filter.gps,"onUpdate:modelValue":t[8]||(t[8]=e=>m.filter.gps=e),indeterminate:null===m.filter.gps,color:"info","prepend-icon":"mdi-close-circle","hide-details":"","onClick:prepend":t[9]||(t[9]=e=>m.filter.gps=null)},null,8,["modelValue","indeterminate"])])),_:1}),(0,i.bF)(v.G),(0,i.bF)(Fe.g,null,{default:(0,i.k6)((()=>[(0,i.bF)(Pe.N,{label:"Fotos",modelValue:m.filter.hasPhotos,"onUpdate:modelValue":t[10]||(t[10]=e=>m.filter.hasPhotos=e),indeterminate:null===m.filter.hasPhotos,color:"info","prepend-icon":"mdi-close-circle","hide-details":"","onClick:prepend":t[11]||(t[11]=e=>m.filter.hasPhotos=null)},null,8,["modelValue","indeterminate"])])),_:1}),(0,i.bF)(v.G),(0,i.bF)(Fe.g,null,{default:(0,i.k6)((()=>[(0,i.bF)(Pe.N,{label:"Chuva",modelValue:m.filter.rain,"onUpdate:modelValue":t[12]||(t[12]=e=>m.filter.rain=e),indeterminate:null===m.filter.rain,color:"info","prepend-icon":"mdi-close-circle","hide-details":"","onClick:prepend":t[13]||(t[13]=e=>m.filter.rain=null)},null,8,["modelValue","indeterminate"])])),_:1}),(0,i.bF)(v.G),(0,i.bF)(Fe.g,null,{default:(0,i.k6)((()=>[(0,i.bF)(Pe.N,{label:"Tratamento",modelValue:m.filter.treatment,"onUpdate:modelValue":t[14]||(t[14]=e=>m.filter.treatment=e),indeterminate:null===m.filter.treatment,color:"info","prepend-icon":"mdi-close-circle","hide-details":"","onClick:prepend":t[15]||(t[15]=e=>m.filter.treatment=null)},null,8,["modelValue","indeterminate"])])),_:1})])),_:1})])),_:1})])),_:1}),(0,i.bF)(u.B,null,{default:(0,i.k6)((()=>[(0,i.bF)(r.D,{color:"secondary",icon:"",variant:"text",disabled:m.isLoading,onClick:t[16]||(t[16]=e=>h.searchVisits())},{default:(0,i.k6)((()=>[(0,i.bF)(g.w,{size:"x-large"},{default:(0,i.k6)((()=>[(0,i.eW)("mdi-magnify")])),_:1})])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1}),(0,i.bF)(s.O,{style:{height:"100%"}},{default:(0,i.k6)((()=>[(0,i.bF)(n.J,{height:"75%",class:"pa-5",elevation:"8",rounded:""},{default:(0,i.k6)((()=>[(0,i.bF)(l.r,null,{default:(0,i.k6)((()=>[m.isLoading?((0,i.uX)(),(0,i.Wv)(Ge.Z,{key:0,color:"primary",indeterminate:""})):(0,i.Q3)("",!0)])),_:1}),(0,i.bF)(s.O,{class:"scrollable"},{default:(0,i.k6)((()=>[(0,i.bF)(c.L,{class:"fill-width"},{default:(0,i.k6)((()=>[0!=m.visits.length||m.isLoading?((0,i.uX)(!0),(0,i.CE)(i.FK,{key:1},(0,i.pI)(m.visits,(e=>((0,i.uX)(),(0,i.Wv)(u.B,{key:e.fileId,cols:"6"},{default:(0,i.k6)((()=>[(0,i.bF)(b,{visit:e,onDetail:t[17]||(t[17]=e=>h.openDetail(e))},null,8,["visit"])])),_:2},1024)))),128)):((0,i.uX)(),(0,i.Wv)(u.B,{key:0},{default:(0,i.k6)((()=>[(0,i.bF)(n.J,{class:"fill-width",elevation:"0"},{default:(0,i.k6)((()=>[(0,i.bF)(s.O,{class:"text-center"},{default:(0,i.k6)((()=>[(0,i.bF)(g.w,{size:"100"},{default:(0,i.k6)((()=>[(0,i.eW)("mdi-file-search")])),_:1}),Bi])),_:1})])),_:1})])),_:1})),m.vis_hasMore&&!m.isLoading?((0,i.uX)(),(0,i.Wv)(u.B,{key:2,cols:"6"},{default:(0,i.k6)((()=>[(0,i.bo)((0,i.bF)(F.V8,{type:"card"},null,512),[[V.o,{handler:h.loadMoreVisits,options:{threshold:.3}},void 0,{quiet:!0}]])])),_:1})):(0,i.Q3)("",!0)])),_:1})])),_:1})])),_:1}),(0,i.bF)(_,{visit:m.selected_visit,dialog:m.detailDialog,"onUpdate:dialog":t[18]||(t[18]=e=>m.detailDialog=e)},null,8,["visit","dialog"])])),_:1})])),_:1})}var Ii=o(9473),Xi=o(94),Ui={name:"RegionVisitsDetails",props:{region:Object},components:{VisitCard:Ii.A,ObservationDetail:Xi.A},setup(){const e=(0,R.E)(),t=(0,T.T)();return{accountStore:e,generalStore:t}},data(){return{isLoading:!1,observations:[],visits:[],vis_offset:0,vis_limit:8,vis_hasMore:!1,detailDialog:!1,selected_visit:null,stages:[],isLoadingStages:!1,regioninperiods:[],isLoadingPeriods:!1,filter_periods:{period_name:null},periods_offset:0,periods_limit:5,periods_hasMore:!1,filter:{dates:[],email:null,fileId:null,nea:null,ef:null,visited:null,gps:null,hasPhotos:null,numPhotos:null,rain:null,treatment:null},rules:{percentage:e=>null===e||""===e||(e>=0&&e<=100||"Valor inválido"),gtZero:e=>null===e||""===e||(e>0||"Valor inválido")}}},computed:{dateRange(){return this.filter.dates.length>0?this.filter.dates[0]+" - "+this.filter.dates[this.filter.dates.length-1]:null}},methods:{handleClick(e){console.log(e)},openDetail(e){this.selected_visit=JSON.parse(JSON.stringify(e)),this.detailDialog=!0},async listObservations(){this.isLoading=!0,await z.A.request({url:"api/observations",method:"GET",headers:{Authorization:`Bearer ${this.accountStore.account.token}`},params:{region_code:this.region.region_code,date_range:this.dateRange,nea:this.filter.nea,ef:this.filter.ef,visited:this.filter.visited,gps:this.filter.gps,hasPhotos:this.filter.hasPhotos,rain:this.filter.rain,treatment:this.filter.treatment}}).then((e=>{this.observations=e.data})).catch((e=>{console.error(e),this.generalStore.errorSnackbar("Erro ao carregar observações")})).finally((()=>{this.isLoading=!1}))},async listVisits(){this.isLoading=!0,await z.A.request({url:"api/visits",method:"GET",headers:{Authorization:`Bearer ${this.accountStore.account.token}`},params:{offset:this.vis_offset,limit:this.vis_limit,region_code:this.region.region_code,date_range:this.dateRange,nea:this.filter.nea,ef:this.filter.ef,visited:this.filter.visited,gps:this.filter.gps,hasPhotos:this.filter.hasPhotos,rain:this.filter.rain,treatment:this.filter.treatment}}).then((e=>{this.visits.push(...e.data.visits),this.vis_offset+=e.data.visits.length,this.vis_hasMore=e.data.hasMore})).catch((e=>{console.error(e),this.generalStore.errorSnackbar("Erro ao carregar visitas")})).finally((()=>{this.isLoading=!1}))},searchVisits(){this.visits=[],this.vis_offset=0,this.listVisits()},loadMoreVisits(e){e&&this.listVisits()},listPhenologicalStages(){this.isLoadingStages=!0,z.A.request({url:"api/phenologicalstages",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.stages=e.data,this.isLoadingStages=!1})).catch((e=>{console.error(e),this.generalStore.errorSnackbar("Erro ao carregar estágios fenológicos")}))},listRegioninPeriods(){this.isLoadingPeriods=!0,z.A.request({url:"api/regions/"+this.region.region_id+"/regionsinperiods",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token},params:{limit:this.periods_limit,offset:this.periods_offset,period_name:this.filter_periods.period_name}}).then((e=>{this.regioninperiods.push(...e.data.regioninperiods),this.periods_offset+=e.data.regioninperiods.length,this.periods_hasMore=e.data.hasMore,this.isLoadingPeriods=!1})).catch((e=>{console.error(e),this.isLoadingPeriods=!1,this.generalStore.errorSnackbar("Erro ao carregar períodos")}))},loadMoreRegionsInPeriods(e){e&&this.listRegioninPeriods()},searchRegionInPeriods(){this.regioninperiods=[],this.periods_offset=0,this.listRegioninPeriods()},formatDate(e){return new Date(e).toLocaleDateString("pt-PT")},updateDates(e){const t=new Date(e.period.period_startdate),o=new Date(e.period.period_enddate);this.filter.dates=[t,o]}},mounted(){this.listRegioninPeriods(),this.listPhenologicalStages(),this.listVisits()},unmounted(){this.observations=[]}};const qi=(0,B.A)(Ui,[["render",Mi],["__scopeId","data-v-5d065c47"]]);var ji=qi,Gi={name:"RegionDrawer",components:{RegionDetail:qe,EOIsDetail:so,PeriodsDetail:Qo,DatasourcesDetail:hi,RegionAgentsDetail:xi,RegionVisitsDetails:ji},setup(){const e=(0,R.E)();return{accountStore:e}},data(){return{drawer:!1,tab:null,isLoading:!1,region:null}},watch:{drawer(e){e||this.reset()}},methods:{openDrawer(e){this.drawer=!0,this.getRegionDetail(e)},async getRegionDetail(e){this.isLoading=!0,await z.A.request({url:"api/regions/"+e,method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.region=e.data,this.isLoading=!1})).catch((e=>{console.log(e)}))},reset(){this.region=null,this.isLoading=!1,this.tab=null},refreshEOIs(){console.log("refreshEOIs"),this.$refs.EOIsDetail?.refreshEOIs()}}};const Ni=(0,B.A)(Gi,[["render",Y]]);var Ji=Ni;const $i={key:0};function Qi(e,t,o,d,g,m){const b=(0,i.g2)("PolyMap");return(0,i.uX)(),(0,i.Wv)(k.p,{modelValue:g.dialog,"onUpdate:modelValue":t[19]||(t[19]=e=>g.dialog=e),onAfterLeave:t[20]||(t[20]=e=>m.reset()),width:"auto"},{activator:(0,i.k6)((({props:e})=>[(0,i.bF)(r.D,(0,i.v6)({color:"success","append-icon":"mdi-plus"},e),{default:(0,i.k6)((()=>[(0,i.eW)("Nova Parcela")])),_:2},1040)])),default:(0,i.k6)((({})=>[(0,i.bF)(n.J,{class:"mx-auto",width:"500"},{default:(0,i.k6)((()=>[(0,i.bF)(l.r,{class:"bg-success"},{default:(0,i.k6)((()=>[(0,i.eW)((0,h.v_)(g.steps[g.step].title),1)])),_:1}),(0,i.bF)($t.r3,{modelValue:g.step,"onUpdate:modelValue":t[15]||(t[15]=e=>g.step=e)},{default:(0,i.k6)((()=>[(0,i.bF)(Qt.m,null,{default:(0,i.k6)((()=>[(0,i.bF)(s.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(w.n,{modelValue:g.steps[g.step].formValid,"onUpdate:modelValue":t[3]||(t[3]=e=>g.steps[g.step].formValid=e)},{default:(0,i.k6)((()=>[(0,i.bF)(c.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(u.B,null,{default:(0,i.k6)((()=>[(0,i.bF)(a.V,{class:"mt-4",modelValue:g.region.regiontype_id,"onUpdate:modelValue":t[0]||(t[0]=e=>g.region.regiontype_id=e),items:g.regiontypes,"item-title":"regiontype_name","item-value":"regiontype_id",label:"Tipo de Região*","prepend-inner-icon":"mdi-land-plots-circle-variant","no-data-text":"Nenhum tipo de região encontrado",density:"compact",variant:"outlined",rules:[g.rules.required],loading:g.isLoadingRegionTypes},null,8,["modelValue","items","rules","loading"])])),_:1}),(0,i.bF)(u.B,null,{default:(0,i.k6)((()=>[(0,i.bF)(Gt,{modelValue:g.file,"onUpdate:modelValue":[t[1]||(t[1]=e=>g.file=e),m.readFile],accept:".json",class:"mt-4",label:"Ficheiro GeoJSON",density:"compact",variant:"outlined",chips:"",clearable:"","prepend-icon":"","prepend-inner-icon":"mdi-file-outline",rules:[g.rules.requiredfile],"onClick:clear":t[2]||(t[2]=e=>g.region.geometry=null)},null,8,["modelValue","rules","onUpdate:modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),null!=g.region?.geometry?((0,i.uX)(),(0,i.CE)("div",$i,[(0,i.bF)(b,{polygon:g.region.geometry,zoom:15,height:"300px"},null,8,["polygon"])])):(0,i.Q3)("",!0)])),_:1})])),_:1}),(0,i.bF)(Qt.m,null,{default:(0,i.k6)((()=>[(0,i.bF)(s.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(w.n,{modelValue:g.steps[g.step].formValid,"onUpdate:modelValue":t[11]||(t[11]=e=>g.steps[g.step].formValid=e),ref:"form1"},{default:(0,i.k6)((()=>[(0,i.bF)(c.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(u.B,{cols:"8"},{default:(0,i.k6)((()=>[(0,i.bF)(p.W,{modelValue:g.region.region_name,"onUpdate:modelValue":t[4]||(t[4]=e=>g.region.region_name=e),modelModifiers:{trim:!0},label:"Nome*","prepend-inner-icon":"mdi-tag-text-outline",density:"compact",variant:"outlined",rules:[g.rules.required,g.rules.maxLength]},null,8,["modelValue","rules"])])),_:1}),(0,i.bF)(u.B,{cols:"4"},{default:(0,i.k6)((()=>[(0,i.bF)(p.W,{modelValue:g.region.region_code,"onUpdate:modelValue":t[5]||(t[5]=e=>g.region.region_code=e),modelModifiers:{trim:!0},label:"Código*","prepend-inner-icon":"mdi-tag-outline",density:"compact",variant:"outlined",rules:[g.rules.required,g.rules.code]},null,8,["modelValue","rules"])])),_:1}),(0,i.bF)(u.B,{cols:"6"},{default:(0,i.k6)((()=>[(0,i.bF)(a.V,{modelValue:g.region.crop,"onUpdate:modelValue":[t[6]||(t[6]=e=>g.region.crop=e),t[7]||(t[7]=e=>m.refreshVarieties())],items:g.crops,"item-title":"crop_name","return-object":"",label:"Cultura*","prepend-inner-icon":"mdi-tree-outline","no-data-text":"Nenhuma cultura encontrada",density:"compact",variant:"outlined",rules:[g.rules.required],loading:g.isLoadingCrops},null,8,["modelValue","items","rules","loading"])])),_:1}),(0,i.bF)(u.B,{cols:"6"},{default:(0,i.k6)((()=>[(0,i.bF)(a.V,{modelValue:g.region.variety,"onUpdate:modelValue":t[8]||(t[8]=e=>g.region.variety=e),items:g.varieties,"item-title":"variety_name","return-object":"",label:"Variedade*","prepend-inner-icon":"mdi-food-apple-outline","no-data-text":"Nenhuma variedade encontrada",density:"compact",variant:"outlined",rules:[g.rules.required],disabled:!g.region.crop,loading:g.isLoadingVarieties},null,8,["modelValue","items","rules","disabled","loading"])])),_:1}),(0,i.bF)(u.B,{cols:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(p.W,{modelValue:g.region.local,"onUpdate:modelValue":t[9]||(t[9]=e=>g.region.local=e),modelModifiers:{trim:!0},label:"Localidade*","prepend-inner-icon":"mdi-map-marker-outline",density:"compact",variant:"outlined"},null,8,["modelValue"])])),_:1}),(0,i.bF)(u.B,{cols:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(x.J,{modelValue:g.region.region_description,"onUpdate:modelValue":t[10]||(t[10]=e=>g.region.region_description=e),modelModifiers:{trim:!0},label:"Descrição","prepend-inner-icon":"mdi-text-box-outline",density:"compact",variant:"outlined",rules:[g.rules.description]},null,8,["modelValue","rules"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}),(0,i.bF)(Qt.m,null,{default:(0,i.k6)((()=>[(0,i.bF)(s.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(w.n,{modelValue:g.steps[g.step].formValid,"onUpdate:modelValue":t[14]||(t[14]=e=>g.steps[g.step].formValid=e)},{default:(0,i.k6)((()=>[(0,i.bF)(c.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(u.B,{cols:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(a.V,{modelValue:g.region.periods,"onUpdate:modelValue":t[12]||(t[12]=e=>g.region.periods=e),class:"mt-4",items:e.periods,label:"Período(s)*",placeholder:"Selecione um período","prepend-inner-icon":"mdi-calendar","no-data-text":"Nenhum período encontrado","item-title":"period_name","item-value":"period_id",density:"compact",variant:"outlined",clearable:"",multiple:"",chips:"",loading:e.isLoadingPeriods,rules:[g.rules.requiredArray]},{item:(0,i.k6)((({props:e,item:t})=>[(0,i.bF)(Fe.g,(0,i.v6)(e,{subtitle:m.formatDate(t.raw.period_startdate)+" - "+m.formatDate(t.raw.period_enddate)}),null,16,["subtitle"])])),_:1},8,["modelValue","items","loading","rules"])])),_:1}),(0,i.bF)(u.B,{cols:"12"},{default:(0,i.k6)((()=>[(0,i.bF)(a.V,{modelValue:g.region.enemies,"onUpdate:modelValue":t[13]||(t[13]=e=>g.region.enemies=e),class:"mt-4",items:m.enemiesSelectItems,label:"Inimigo(s)*",placeholder:"Selecione um inimigo","prepend-inner-icon":"mdi-bug-outline","no-data-text":"Nenhum inimigo encontrado","item-title":"enemy_name","item-value":"enemy_id",density:"compact",variant:"outlined",clearable:"",multiple:"",chips:"",loading:g.isLoadingEnemies,rules:[g.rules.requiredArray]},null,8,["modelValue","items","loading","rules"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,i.bF)(v.G),(0,i.bF)(f.S,null,{default:(0,i.k6)((()=>[g.step>0?((0,i.uX)(),(0,i.Wv)(r.D,{key:0,"prepend-icon":"mdi-chevron-left",variant:"tonal",onClick:t[16]||(t[16]=e=>g.step--)},{default:(0,i.k6)((()=>[(0,i.eW)(" Anterior ")])),_:1})):(0,i.Q3)("",!0),(0,i.bF)(Nt.h),g.step<m.lasStep?((0,i.uX)(),(0,i.Wv)(r.D,{key:1,disabled:!g.steps[g.step].formValid,"append-icon":"mdi-chevron-right",color:"secondary",variant:"tonal",onClick:t[17]||(t[17]=e=>g.step++)},{default:(0,i.k6)((()=>[(0,i.eW)(" Próximo ")])),_:1},8,["disabled"])):g.step===m.lasStep?((0,i.uX)(),(0,i.Wv)(r.D,{key:2,disabled:!g.steps[m.lasStep].formValid,color:"success",variant:"flat",loading:g.isLoadingPost,onClick:t[18]||(t[18]=e=>m.postRegion())},{default:(0,i.k6)((()=>[(0,i.eW)(" Adicionar ")])),_:1},8,["disabled","loading"])):(0,i.Q3)("",!0)])),_:1})])),_:1})])),_:1},8,["modelValue"])}var Ki={name:"AddRegionOrg",components:{PolyMap:vt},setup(){const e=(0,R.E)(),t=(0,T.T)();return{accountStore:e,generalStore:t}},data(){return{owners:null,region:{region_code:null,region_name:null,crop:null,variety:null,region_description:null,local:null,geometry:null,periods:[],enemies:[]},file:null,dialog:!1,step:0,steps:[{title:"Região",formValid:!1},{title:"Detalhes",formValid:!1},{title:"Períodos e Inimigos",formValid:!1}],rules:{required:e=>!!e||"Campo obrigatório.",requiredArray:e=>e.length>0||"Campo obrigatório.",code:e=>e&&e.length<=3&&e.toUpperCase()===e||"Código inválido",maxLength:e=>e&&e.length<=25||"Máximo de 25 caracteres.",description:e=>e&&e.length<=255||!e||"Máximo de 255 caracteres.",requiredfile:e=>0!=e.length||"Selecione um ficheiro JSON."},isLoadingPost:!1,regiontypes:[],isLoadingRegionTypes:!1,orgMembers:[],isLoadingMembers:!1,crops:[],isLoadingCrops:!1,varieties:[],isLoadingVarieties:!1,"períods":[],"isLoadingPeríods":!1,enemies:[],isLoadingEnemies:!1}},watch:{dialog(e){e&&this.onOpendDialog()}},computed:{lasStep(){return this.steps.length-1},enemiesSelectItems(){return this.enemies.filter((e=>1!=e.enemytype_id))}},methods:{onOpendDialog(){this.getRegionTypes(),this.getCrops(),this.getPeriods(),this.getEnemies()},getRegionTypes(){this.isLoadingRegionTypes=!0,z.A.request({url:"api/regiontypes",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.regiontypes=e.data,this.isLoadingRegionTypes=!1})).catch((e=>{console.error(e),this.isLoadingRegionTypes=!1,this.generalStore.errorSnackbar("Erro ao obter tipos de região.")}))},getOrgMembers(){this.isLoadingMembers=!0,z.A.request({url:"api/organizations/"+this.accountStore.account.organization+"/organizationproducers",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.orgMembers=e.data,this.isLoadingMembers=!1})).catch((e=>{this.isLoadingMembers=!1,this.generalStore.errorSnackbar("Erro ao obter produtores.")}))},async getCrops(){this.isLoadingCrops=!0,await z.A.request({url:"api/crops",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.crops=e.data,this.isLoadingCrops=!1})).catch((e=>{console.error(e),this.isLoadingCrops=!1,this.generalStore.errorSnackbar("Erro ao obter culturas.")}))},refreshVarieties(){this.region.variety=null,this.$refs.form1.validate(),this.getVarieties()},async getVarieties(){this.isLoadingVarieties=!0,await z.A.request({url:"api/crops/"+this.region.crop.crop_id+"/varieties",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.varieties=e.data,this.isLoadingVarieties=!1})).catch((e=>{console.error(e),this.isLoadingVarieties=!1,this.generalStore.errorSnackbar("Erro ao obter variedades.")}))},async getPeriods(){this.isLoadingPeriods=!0,await z.A.request({url:"api/periods",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.periods=e.data.periods,this.isLoadingPeriods=!1,this.region.periods.push(this.getRecentPeriod(this.periods).period_id)})).catch((e=>{console.error(e),this.generalStore.errorSnackbar("Erro ao buscar períodos"),this.isLoadingPeriods=!1}))},getRecentPeriod(e){const t=e.reduce(((e,t)=>new Date(t.period_enddate)>new Date(e.period_enddate)?t:e),e[0]);return t},formatDate(e){return new Date(e).toLocaleDateString("pt-PT")},async getEnemies(){this.isLoadingEnemies=!0,await z.A.request({url:"api/enemies",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.enemies=e.data,this.isLoadingEnemies=!1})).catch((e=>{console.error(e),this.generalStore.errorSnackbar("Erro ao buscar inimigos"),this.isLoadingEnemies=!1}))},async postRegion(){this.isLoadingPost=!0;let e={regiontype_id:this.region.regiontype_id,owners:this.owners,region_code:this.region.region_code,region_name:this.region.region_name,crop:{...this.region.crop,variety:this.region.variety},region_description:this.region.region_description,local:this.region.local,geometry:this.region.geometry,regioninperiods:{periods:this.region.periods,enemies:this.region.enemies}};console.log(e),await z.A.request({url:"api/regions",method:"POST",headers:{Authorization:"Bearer "+this.accountStore.account.token},data:e}).then((e=>{this.isLoadingPost=!1,this.dialog=!1,this.generalStore.successSnackbar("Parcela adicionada com sucesso."),this.$emit("refreshRegions")})).catch((e=>{this.isLoadingPost=!1,console.log(e),this.generalStore.errorSnackbar(e.response.data.error)}))},async getNearestLocality(e){const t=this.getCenter(e);return console.log(t),await z.A.request({url:"https://api.mapbox.com/search/geocode/v6/reverse",method:"GET",params:{longitude:t[0],latitude:t[1],access_token:"pk.eyJ1IjoibXJiYWlhbyIsImEiOiJjbHYwczh3enUxajNvMmlyejE3YmxoaHN4In0.1BrZQAvQO5XSHkxl7HgINg"}}).then((e=>e.data.features[0].properties.context.region.name)).catch((e=>(console.log(e),null)))},getCenter(e){const t=e.coordinates[0],o=t.reduce(((e,[t,o])=>[e[0]+t,e[1]+o]),[0,0]),i=[o[0]/t.length,o[1]/t.length];return i},readFile(e){if(!e)return;const t=new FileReader;t.onload=async e=>{try{let t=JSON.parse(e.target.result);console.log(t);const o=t.features.find((e=>"Polygon"===e.geometry.type));console.log(o),this.region.region_code=o.properties?.code,this.region.region_name=o.properties?.name,this.region.region_description=o.properties?.description,this.region.geometry=o.geometry,this.region.local=await this.getNearestLocality(o.geometry)}catch(t){console.log(t),this.file=null,this.generalStore.errorSnackbar("Erro ao ler ficheiro GeoJSON.")}},t.readAsText(e)},reset(){this.owner_id=null,this.file=null,this.region={region_code:null,region_name:null,crop:null,variety:null,region_description:null,local:null,geometry:null,periods:[],enemies:[]},this.step=0}}};const Yi=(0,B.A)(Ki,[["render",Qi]]);var Hi=Yi,Zi={name:"RegionsView",components:{RegionsTable:q,RegionsDetail:Ji,AddRegion:Hi},setup(){const e=(0,R.E)();return{accountStore:e}},data(){return{regiontypes:[],isLoadingRegionTypes:!1,organizations:[],isLoadingOrganizations:!1,crops:[],isLoadingCrops:!1,isLoadingRegions:!1,isLoadingDetail:!1,drawer:!1,selectedRegion:null,regions:[],filter:{region_code:null,region_name:null,regiontype_id:null,local:null,crop:null,organization_id:null},limit:12,offset:0,hasMore:!1}},watch:{},computed:{},methods:{async getRegionTypes(){this.isLoadingRegionTypes=!0,await z.A.request({url:"api/regiontypes",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.regiontypes=e.data,this.isLoadingRegionTypes=!1})).catch((e=>{console.error(e),this.isLoadingRegionTypes=!1,this.generalStore.errorSnackbar("Erro ao obter tipos de região.")}))},async getOrganizations(){this.isLoadingOrganizations=!0,await z.A.request({url:"api/organizations",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.organizations=e.data.organizations,this.isLoadingOrganizations=!1})).catch((e=>{console.log(e)}))},async getCrops(){this.isLoadingCrops=!0,await z.A.request({url:"api/crops",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.crops=e.data,this.isLoadingCrops=!1})).catch((e=>{this.isLoadingCrops=!1,this.generalStore.errorSnackbar("Erro ao obter culturas.")}))},async getRegions(){this.isLoadingRegions=!0,await z.A.request({url:"api/regions",method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token},params:{region_code:this.filter.region_code,region_name:this.filter.region_name,regiontype_id:this.filter.regiontype_id,local:this.filter.local,crop:this.filter.crop,organization_id:this.filter.organization_id,limit:this.limit,offset:this.offset}}).then((e=>{this.regions.push(...e.data.regions),this.offset+=e.data.regions.length,this.hasMore=e.data.hasMore,this.isLoadingRegions=!1})).catch((e=>{console.log(e),this.isLoadingRegions=!1}))},async getRegionDetail(e){this.isLoadingDetail=!0,await z.A.request({url:"api/regions/"+e,method:"GET",headers:{Authorization:"Bearer "+this.accountStore.account.token}}).then((e=>{this.selectedRegion=e.data,this.isLoadingDetail=!1})).catch((e=>{console.log(e)}))},search(){this.offset=0,this.regions=[],this.getRegions()},showInfo(e){this.$refs.RegionDetail.openDrawer(e)}},mounted(){this.getRegionTypes(),this.getRegions(),this.getCrops(),this.accountStore.hasRole(["Administrador"])&&this.getOrganizations()}};const ea=(0,B.A)(Zi,[["render",m]]);var ta=ea}}]);
//# sourceMappingURL=regions.872413b0.js.map